<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Data Carpentry for Media Research: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav data"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dc-logo" alt="Data Carpentry" src="assets/images/data-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Data Carpentry for Media Research
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Data Carpentry for Media Research
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Data Carpentry for Media Research
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-intro.html">1. Before we Start</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-intro-to-r.html">2. Introduction to R</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-starting-with-data.html">3. Starting with Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-dplyr.html">4. Data Wrangling with dplyr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="04-tidyr.html">5. Data Wrangling with tidyr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="05-ggplot2.html">6. Data Visualisation with ggplot2</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="06-rmarkdown.html">7. Getting started with R Markdown (Optional)</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="07-json.html">8. Processing JSON data (Optional)</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="08-text-as-data.html">9. Text as data (Optional)</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-00-intro"><p>Content from <a href="00-intro.html">Before we Start</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/00-intro.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How to find your way around RStudio?</li>
<li>How to interact with R?</li>
<li>How to manage your environment?</li>
<li>How to install packages?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Install latest version of R.</li>
<li>Install latest version of RStudio.</li>
<li>Navigate the RStudio GUI.</li>
<li>Install additional packages using the packages tab.</li>
<li>Install additional packages using R code.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-r-what-is-rstudio">What is R? What is RStudio?<a class="anchor" aria-label="anchor" href="#what-is-r-what-is-rstudio"></a>
</h2>
<hr class="half-width">
<p>The term “<code>R</code>” is used to refer to both the programming
language and the software that interprets the scripts written using
it.</p>
<p><a href="https://rstudio.com" class="external-link">RStudio</a> is currently a very popular
way to not only write your R scripts but also to interact with the R
software. To function correctly, RStudio needs R and therefore both need
to be installed on your computer.</p>
<p>To make it easier to interact with R, we will use RStudio. RStudio is
the most popular IDE (Integrated Development Environment) for R. An IDE
is a piece of software that provides tools to make programming
easier.</p>
<p>You can also use the R Presentations feature to present your work in
an HTML5 presentation mixing Markdown and R code. You can display these
within R Studio or your browser. There are many options for customising
your presentation slides, including an option for showing LaTeX
equations. This can help you collaborate with others and also has an
application in teaching and classroom use.</p>
</section><section><h2 class="section-heading" id="why-learn-r">Why learn R?<a class="anchor" aria-label="anchor" href="#why-learn-r"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="r-does-not-involve-lots-of-pointing-and-clicking-and-thats-a-good-thing">R does not involve lots of pointing and clicking, and that’s a good
thing<a class="anchor" aria-label="anchor" href="#r-does-not-involve-lots-of-pointing-and-clicking-and-thats-a-good-thing"></a>
</h3>
<p>The learning curve might be steeper than with other software but with
R, the results of your analysis do not rely on remembering a succession
of pointing and clicking, but instead on a series of written commands,
and that’s a good thing! So, if you want to redo your analysis because
you collected more data, you don’t have to remember which button you
clicked in which order to obtain your results; you just have to run your
script again.</p>
<p>Working with scripts makes the steps you used in your analysis clear,
and the code you write can be inspected by someone else who can give you
feedback and spot mistakes.</p>
<p>Working with scripts forces you to have a deeper understanding of
what you are doing, and facilitates your learning and comprehension of
the methods you use.</p>
</div>
<div class="section level3">
<h3 id="r-code-is-great-for-reproducibility">R code is great for reproducibility<a class="anchor" aria-label="anchor" href="#r-code-is-great-for-reproducibility"></a>
</h3>
<p>Reproducibility is when someone else (including your future self) can
obtain the same results from the same dataset when using the same
analysis.</p>
<p>R integrates with other tools to generate manuscripts from your code.
If you collect more data, or fix a mistake in your dataset, the figures
and the statistical tests in your manuscript are updated
automatically.</p>
<p>An increasing number of journals and funding agencies expect analyses
to be reproducible, so knowing R will give you an edge with these
requirements.</p>
<p>To further support reproducibility and transparency, there are also
packages that help you with dependency management: keeping track of
which packages we are loading and how they depend on the package version
you are using. This helps you make sure existing workflows work
consistently and continue doing what they did before.</p>
<p>Packages like renv let you “save” and “load” the state of your
project library, also keeping track of the package version you use and
the source it can be retrieved from.</p>
</div>
<div class="section level3">
<h3 id="r-is-interdisciplinary-and-extensible">R is interdisciplinary and extensible<a class="anchor" aria-label="anchor" href="#r-is-interdisciplinary-and-extensible"></a>
</h3>
<p>With 10,000+ packages that can be installed to extend its
capabilities, R provides a framework that allows you to combine
statistical approaches from many scientific disciplines to best suit the
analytical framework you need to analyze your data. For instance, R has
packages for image analysis, GIS, time series, population genetics, and
a lot more.</p>
</div>
<div class="section level3">
<h3 id="r-works-on-data-of-all-shapes-and-sizes">R works on data of all shapes and sizes<a class="anchor" aria-label="anchor" href="#r-works-on-data-of-all-shapes-and-sizes"></a>
</h3>
<p>The skills you learn with R scale easily with the size of your
dataset. Whether your dataset has hundreds or millions of lines, it
won’t make much difference to you.</p>
<p>R is designed for data analysis. It comes with special data
structures and data types that make handling of missing data and
statistical factors convenient.</p>
<p>R can connect to spreadsheets, databases, and many other data
formats, on your computer or on the web.</p>
</div>
<div class="section level3">
<h3 id="r-produces-high-quality-graphics">R produces high-quality graphics<a class="anchor" aria-label="anchor" href="#r-produces-high-quality-graphics"></a>
</h3>
<p>The plotting functionalities in R are endless, and allow you to
adjust any aspect of your graph to convey most effectively the message
from your data.</p>
</div>
<div class="section level3">
<h3 id="r-has-a-large-and-welcoming-community">R has a large and welcoming community<a class="anchor" aria-label="anchor" href="#r-has-a-large-and-welcoming-community"></a>
</h3>
<p>Thousands of people use R daily. Many of them are willing to help you
through mailing lists and websites such as <a href="https://stackoverflow.com/" class="external-link">Stack Overflow</a>, or on the <a href="https://community.rstudio.com/" class="external-link">RStudio community</a>. Questions
which are backed up with <a href="https://www.tidyverse.org/help/" class="external-link">short, reproducible code
snippets</a> are more likely to attract knowledgeable responses.</p>
</div>
<div class="section level3">
<h3 id="not-only-is-r-free-but-it-is-also-open-source-and-cross-platform">Not only is R free, but it is also open-source and
cross-platform<a class="anchor" aria-label="anchor" href="#not-only-is-r-free-but-it-is-also-open-source-and-cross-platform"></a>
</h3>
<p>Anyone can inspect the source code to see how R works. Because of
this transparency, there is less chance for mistakes, and if you (or
someone else) find some, you can report and fix bugs.</p>
<p>Because R is open source and is supported by a large community of
developers and users, there is a very large selection of third-party
add-on packages which are freely available to extend R’s native
capabilities.</p>
<figure><div class="row">
<div class="col-md-6">
<figure><img src="fig/r-manual.jpeg" alt="RStudio extends what R can do, and makes it easier to write R code and interact with R." width="100%" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div class="col-md-6">
<figure><img src="fig/r-automatic.jpeg" alt="automatic car gear shift representing the ease of RStudio" width="100%" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
<figcaption><p>RStudio extends what R can do, and makes it easier to write R code
and interact with R.
<a href="https://unsplash.com/photos/D19rXKDUPYM" class="external-link">Left photo credit</a>;
<a href="https://unsplash.com/photos/Wec3M4dY_LE" class="external-link">Right photo
credit</a>.</p>
</figcaption></figure>
</div>
</section><section><h2 class="section-heading" id="a-tour-of-rstudio">A tour of RStudio<a class="anchor" aria-label="anchor" href="#a-tour-of-rstudio"></a>
</h2>
<hr class="half-width"></section><section><h2 class="section-heading" id="knowing-your-way-around-rstudio">Knowing your way around RStudio<a class="anchor" aria-label="anchor" href="#knowing-your-way-around-rstudio"></a>
</h2>
<hr class="half-width">
<p>Let’s start by learning about <a href="https://www.rstudio.com/" class="external-link">RStudio</a>, which is an Integrated
Development Environment (IDE) for working with R.</p>
<p>The RStudio IDE open-source product is free under the <a href="https://www.gnu.org/licenses/agpl-3.0.en.html" class="external-link">Affero General
Public License (AGPL) v3</a>. The RStudio IDE is also available with a
commercial license and priority email support from RStudio, Inc.</p>
<p>We will use the RStudio IDE to write code, navigate the files on our
computer, inspect the variables we create, and visualize the plots we
generate. RStudio can also be used for other things (e.g., version
control, developing packages, writing Shiny apps) that we will not cover
during the workshop.</p>
<p>One of the advantages of using RStudio is that all the information
you need to write code is available in a single window. Additionally,
RStudio provides many shortcuts, autocompletion, and highlighting for
the major file types you use while developing in R. RStudio makes typing
easier and less error-prone.</p>
</section><section><h2 class="section-heading" id="getting-set-up">Getting set up<a class="anchor" aria-label="anchor" href="#getting-set-up"></a>
</h2>
<hr class="half-width">
<p>It is good practice to keep a set of related data, analyses, and text
self-contained in a single folder called the <strong>working
directory</strong>. All of the scripts within this folder can then use
<em>relative paths</em> to files. Relative paths indicate where inside
the project a file is located (as opposed to absolute paths, which point
to where a file is on a specific computer). Working this way makes it a
lot easier to move your project around on your computer and share it
with others without having to directly modify file paths in the
individual scripts.</p>
<p>RStudio provides a helpful set of tools to do this through its
“Projects” interface, which not only creates a working directory for you
but also remembers its location (allowing you to quickly navigate to
it). The interface also (optionally) preserves custom settings and open
files to make it easier to resume work after a break.</p>
<div class="section level3">
<h3 id="create-a-new-project">Create a new project<a class="anchor" aria-label="anchor" href="#create-a-new-project"></a>
</h3>
<ul>
<li>Under the <code>File</code> menu, click on <code>New project</code>,
choose <code>New directory</code>, then <code>New project</code>
</li>
<li>Enter a name for this new folder (or “directory”) and choose a
convenient location for it. This will be your <strong>working
directory</strong> for the rest of the day (e.g.,
<code>~/data-carpentry</code>)</li>
<li>Click on <code>Create project</code>
</li>
<li>Create a new file where we will type our scripts. Go to File &gt;
New File &gt; R script. Click the save icon on your toolbar and save
your script as “<code>script.R</code>”.</li>
</ul>
<p>The simplest way to open an RStudio project once it has been created
is to navigate through your files to where the project was saved and
double click on the <code>.Rproj</code> (blue cube) file. This will open
RStudio and start your R session in the <strong>same</strong> directory
as the <code>.Rproj</code> file. All your data, plots and scripts will
now be relative to the project directory. RStudio projects have the
added benefit of allowing you to open multiple projects at the same time
each open to its own project directory. This allows you to keep multiple
projects open without them interfering with each other.</p>
</div>
<div class="section level3">
<h3 id="the-rstudio-interface">The RStudio Interface<a class="anchor" aria-label="anchor" href="#the-rstudio-interface"></a>
</h3>
<p>Let’s take a quick tour of RStudio.</p>
<figure><img src="fig/R_00_Rstudio_01.png" alt="Screenshot of the RStudio_startup screen" class="figure mx-auto d-block"></figure><p>RStudio is divided into four “panes”. The placement of these panes
and their content can be customized (see menu, Tools -&gt; Global
Options -&gt; Pane Layout).</p>
<p>The Default Layout is:</p>
<ul>
<li>Top Left - <strong>Source</strong>: your scripts and documents</li>
<li>Bottom Left - <strong>Console</strong>: what R would look and be
like without RStudio</li>
<li>Top Right - <strong>Environment/History</strong>: look here to see
what you have done</li>
<li>Bottom Right - <strong>Files</strong> and more: see the contents of
the project/working directory here, like your Script.R file</li>
</ul>
</div>
<div class="section level3">
<h3 id="organizing-your-working-directory">Organizing your working directory<a class="anchor" aria-label="anchor" href="#organizing-your-working-directory"></a>
</h3>
<p>Using a consistent folder structure across your projects will help
keep things organized and make it easy to find/file things in the
future. This can be especially helpful when you have multiple projects.
In general, you might create directories (folders) for
<strong>scripts</strong>, <strong>data</strong>, and
<strong>documents</strong>. Here are some examples of suggested
directories:</p>
<ul>
<li>
<strong><code>data/</code></strong> Use this folder to store your
raw data and intermediate datasets. For the sake of transparency and <a href="https://en.wikipedia.org/wiki/Provenance" class="external-link">provenance</a>, you
should <em>always</em> keep a copy of your raw data accessible and do as
much of your data cleanup and preprocessing programmatically (i.e., with
scripts, rather than manually) as possible.</li>
<li>
<strong><code>data_output/</code></strong> When you need to modify
your raw data, it might be useful to store the modified versions of the
datasets in a different folder.</li>
<li>
<strong><code>documents/</code></strong> Used for outlines, drafts,
and other text.</li>
<li>
<strong><code>fig_output/</code></strong> This folder can store the
graphics that are generated by your scripts.</li>
<li>
<strong><code>scripts/</code></strong> A place to keep your R
scripts for different analyses or plotting.</li>
</ul>
<p>You may want additional directories or subdirectories depending on
your project needs, but these should form the backbone of your working
directory.</p>
<figure><img src="fig/rstudio_project_files.jpeg" alt="Example of a working directory structure" class="figure mx-auto d-block"></figure>
</div>
<div class="section level3">
<h3 id="the-working-directory">The working directory<a class="anchor" aria-label="anchor" href="#the-working-directory"></a>
</h3>
<p>The working directory is an important concept to understand. It is
the place where R will look for and save files. When you write code for
your project, your scripts should refer to files in relation to the root
of your working directory and only to files within this structure.</p>
<p>Using RStudio projects makes this easy and ensures that your working
directory is set up properly. If you need to check it, you can use
<code>getwd()</code>. If for some reason your working directory is not
the same as the location of your RStudio project, it is likely that you
opened an R script or RMarkdown file <strong>not</strong> your
<code>.Rproj</code> file. You should close out of RStudio and open the
<code>.Rproj</code> file by double clicking on the blue cube! If you
ever need to modify your working directory in a script,
<code>setwd('my/path')</code> changes the working directory. This should
be used with caution since it makes analyses hard to share across
devices and with other users.</p>
</div>
<div class="section level3">
<h3 id="downloading-the-data-and-getting-set-up">Downloading the data and getting set up<a class="anchor" aria-label="anchor" href="#downloading-the-data-and-getting-set-up"></a>
</h3>
<p>For this lesson we will use the following folders in our working
directory: <strong><code>data/</code></strong>,
<strong><code>data_output/</code></strong> and
<strong><code>fig_output/</code></strong>. Let’s write them all in
lowercase to be consistent. We can create them using the RStudio
interface by clicking on the “New Folder” button in the file pane
(bottom right), or directly from R by typing at console:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"data_output"</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"fig_output"</span><span class="op">)</span></span></code></pre>
</div>
<p>You can either download the data used for this lesson from GitHub or
with R. You can copy the data from this <a href="https://raw.githubusercontent.com/marionwalton/media-test/main/episodes/data/youtube-27082024-open-refine-200-na.csv" class="external-link">GitHub
link</a> and paste it into a file called
<code>youtube-27082024-open-refine-200-na.csv</code> in the
<code>data/</code> directory you just created. Or you can do this
directly from R by copying and pasting this in your terminal (your
instructor can place this chunk of code in the Etherpad):</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/marionwalton/media-test/main/episodes/data/youtube-27082024-open-refine-200-na.csv"</span>,</span>
<span>  <span class="st">"youtube-27082024-open-refine-200-na.csv"</span>, mode <span class="op">=</span> <span class="st">"wb"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="interacting-with-r">Interacting with R<a class="anchor" aria-label="anchor" href="#interacting-with-r"></a>
</h2>
<hr class="half-width">
<p>The basis of programming is that we write down instructions for the
computer to follow, and then we tell the computer to follow those
instructions. We write, or <em>code</em>, instructions in R because it
is a common language that both the computer and we can understand. We
call the instructions <em>commands</em> and we tell the computer to
follow the instructions by <em>executing</em> (also called
<em>running</em>) those commands.</p>
<p>There are two main ways of interacting with R: by using the console
or by using script files (plain text files that contain your code). The
console pane (in RStudio, the bottom left panel) is the place where
commands written in the R language can be typed and executed immediately
by the computer. It is also where the results will be shown for commands
that have been executed. You can type commands directly into the console
and press <kbd>Enter</kbd> to execute those commands, but they will be
forgotten when you close the session.</p>
<p>Because we want our code and workflow to be reproducible, it is
better to type the commands we want in the script editor and save the
script. This way, there is a complete record of what we did, and anyone
(including our future selves!) can easily replicate the results on their
computer.</p>
<p>RStudio allows you to execute commands directly from the script
editor by using the <kbd>Ctrl</kbd> + <kbd>Enter</kbd> shortcut (on Mac,
<kbd>Cmd</kbd> + <kbd>Return</kbd> will work). The command on the
current line in the script (indicated by the cursor) or all of the
commands in selected text will be sent to the console and executed when
you press <kbd>Ctrl</kbd> + <kbd>Enter</kbd>. If there is information in
the console you do not need anymore, you can clear it with
<kbd>Ctrl</kbd> + <kbd>L</kbd>. You can find other keyboard shortcuts in
this <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/rstudio-ide.pdf" class="external-link">RStudio
cheatsheet about the RStudio IDE</a>.</p>
<p>At some point in your analysis, you may want to check the content of
a variable or the structure of an object without necessarily keeping a
record of it in your script. You can type these commands and execute
them directly in the console. RStudio provides the <kbd>Ctrl</kbd> +
<kbd>1</kbd> and <kbd>Ctrl</kbd> + <kbd>2</kbd> shortcuts allow you to
jump between the script and the console panes.</p>
<p>If R is ready to accept commands, the R console shows a
<code>&gt;</code> prompt. If R receives a command (by typing,
copy-pasting, or sent from the script editor using <kbd>Ctrl</kbd> +
<kbd>Enter</kbd>), R will try to execute it and, when ready, will show
the results and come back with a new <code>&gt;</code> prompt to wait
for new commands.</p>
<p>If R is still waiting for you to enter more text, the console will
show a <code>+</code> prompt. It means that you haven’t finished
entering a complete command. This is likely because you have not
‘closed’ a parenthesis or quotation, i.e. you don’t have the same number
of left-parentheses as right-parentheses or the same number of opening
and closing quotation marks. When this happens, and you thought you
finished typing your command, click inside the console window and press
<kbd>Esc</kbd>; this will cancel the incomplete command and return you
to the <code>&gt;</code> prompt. You can then proofread the command(s)
you entered and correct the error.</p>
</section><section><h2 class="section-heading" id="installing-additional-packages-using-the-packages-tab">Installing additional packages using the packages tab<a class="anchor" aria-label="anchor" href="#installing-additional-packages-using-the-packages-tab"></a>
</h2>
<hr class="half-width">
<p>In addition to the core R installation, there are in excess of 10,000
additional packages which can be used to extend the functionality of R.
Many of these have been written by R users and have been made available
in central repositories, like the one hosted at CRAN, for anyone to
download and install into their own R environment. You should have
already installed the packages ‘ggplot2’ and ’dplyr. If you have not,
please do so now using these instructions.</p>
<p>You can see if you have a package installed by looking in the
<code>packages</code> tab (on the lower-right by default). You can also
type the command <code>installed.packages()</code> into the console and
examine the output.</p>
<figure><img src="fig/packages_pane.png" alt="Screenshot of Packages pane" class="figure mx-auto d-block"></figure><p>Additional packages can be installed from the ‘packages’ tab. On the
packages tab, click the ‘Install’ icon and start typing the name of the
package you want in the text box. As you type, packages matching your
starting characters will be displayed in a drop-down list so that you
can select them.</p>
<figure><img src="fig/R_00_Rstudio_03.png" alt="Screenshot of Install Packages Window" class="figure mx-auto d-block"></figure><p>At the bottom of the Install Packages window is a check box to
‘Install’ dependencies. This is ticked by default, which is usually what
you want. Packages can (and do) make use of functionality built into
other packages, so for the functionality contained in the package you
are installing to work properly, there may be other packages which have
to be installed with them. The ‘Install dependencies’ option makes sure
that this happens.</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Use both the Console and the Packages tab to confirm that you have
the tidyverse installed.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Scroll through packages tab down to ‘tidyverse’. You can also type a
few characters into the searchbox. The ‘tidyverse’ package is really a
package of packages, including ‘ggplot2’ and ‘dplyr’, both of which
require other packages to run correctly. All of these packages will be
installed automatically. Depending on what packages have previously been
installed in your R environment, the install of ‘tidyverse’ could be
very quick or could take several minutes. As the install proceeds,
messages relating to its progress will be written to the console. You
will be able to see all of the packages which are actually being
installed.</p>
</div>
</div>
</div>
</div>
<p>Because the install process accesses the CRAN repository, you will
need an Internet connection to install packages.</p>
<p>It is also possible to install packages from other repositories, as
well as Github or the local file system, but we won’t be looking at
these options in this lesson.</p>
</section><section><h2 class="section-heading" id="installing-additional-packages-using-r-code">Installing additional packages using R code<a class="anchor" aria-label="anchor" href="#installing-additional-packages-using-r-code"></a>
</h2>
<hr class="half-width">
<p>If you were watching the console window when you started the install
of ‘tidyverse’, you may have noticed that the line</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre>
</div>
<p>was written to the console before the start of the installation
messages.</p>
<p>You could also have installed the
<strong><code>tidyverse</code></strong> packages by running this command
directly at the R terminal.</p>
<p>We will be using another package called
<strong><code>here</code></strong> throughout the workshop to manage
paths and directories. We will discuss it more detail in a later
episode, but we will install it now in the console:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"here"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use RStudio to write and run R programs.</li>
<li>Use <code>install.packages()</code> to install packages
(libraries).</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-01-intro-to-r"><p>Content from <a href="01-intro-to-r.html">Introduction to R</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/01-intro-to-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What data types are available in R?</li>
<li>What is an object?</li>
<li>How can values be initially assigned to variables of different data
types?</li>
<li>What arithmetic and logical operators can be used?</li>
<li>How can subsets be extracted from vectors?</li>
<li>How does R treat missing values?</li>
<li>How can we deal with missing values in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Define the following terms as they relate to R: object, assign,
call, function, arguments, options.</li>
<li>Assign values to objects in R.</li>
<li>Learn how to name objects.</li>
<li>Use comments to inform script.</li>
<li>Solve simple arithmetic operations in R.</li>
<li>Call functions and use arguments to change their default
options.</li>
<li>Inspect the content of vectors and manipulate their content.</li>
<li>Subset values from vectors.</li>
<li>Analyze vectors with missing data.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="creating-objects-in-r">Creating objects in R<a class="anchor" aria-label="anchor" href="#creating-objects-in-r"></a>
</h2>
<hr class="half-width">
<p>You can get output from R simply by typing math in the console:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 8</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">12</span> <span class="op">/</span> <span class="fl">7</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.714286</code></pre>
</div>
<p>However, to do useful and interesting things, we need to assign
<em>values</em> to <em>objects</em>.</p>
<p>Let’s start by imagining we are creating a tiny dataset by hand. To
do this we’ll store the information about three videos posted to
YouTube. Each video has associated information such as its:</p>
<ul>
<li>video id (a unique text identifying the video stored in the object
named video_id)</li>
<li>duration in seconds (a number stored in the object named
duration_sec)</li>
<li>view count (a number stored in the object named view_count)</li>
<li>comment count (a number stored in the object named
comment_count)</li>
<li>category label (a text label stored in the object named
category_label)</li>
</ul>
<p>To create an object, we need to give it a name followed by the
assignment operator <code>&lt;-</code>, and the value we want to give
it:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_sec</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></code></pre>
</div>
<p>In this case our first video is 1000 seconds in duration.</p>
<p>We set the duration by using <code>&lt;-</code> or the assignment
operator. It assigns values on the right to objects on the left.</p>
<p>So, after we execute <code>view_count &lt;- 1000</code>, the value of
<code>view_count</code> is set to <code>1000</code>.</p>
<p>The arrow can be read as 3 <strong>goes into</strong>
<code>view_count</code>. For historical reasons, you can also use
<code>=</code> for assignments, but not in every context. Because of the
<a href="https://blog.revolutionanalytics.com/2008/12/use-equals-or-arrow-for-assignment.html" class="external-link">slight
differences</a> in syntax, it is good practice to always use
<code>&lt;-</code> for assignments. More generally we prefer the
<code>&lt;-</code> syntax over <code>=</code> because it makes it clear
what direction the assignment is operating (left assignment), and it
increases the read-ability of the code.</p>
<p>In RStudio, typing <kbd>Alt</kbd> + <kbd>-</kbd> (push <kbd>Alt</kbd>
at the same time as the <kbd>-</kbd> key) will write <code>&lt;-</code>
in a single keystroke in a PC, while typing <kbd>Option</kbd> +
<kbd>-</kbd> (push <kbd>Option</kbd> at the same time as the
<kbd>-</kbd> key) does the same in a Mac.</p>
<p>Objects can be given any name such as <code>category_name</code>,
<code>view_count</code>, or <code>video_id</code>. You want your object
names to be explicit and not too long. They cannot start with a number
(<code>2x</code> is not valid, but <code>x2</code> is). R is case
sensitive (e.g., <code>age</code> is different from <code>Age</code>).
There are some names that cannot be used because they are the names of
fundamental objects in R (e.g., <code>if</code>, <code>else</code>,
<code>for</code>, see <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Reserved.html" class="external-link">here</a>
for a complete list). In general, even if it’s allowed, it’s best to not
use them (e.g., <code>c</code>, <code>T</code>, <code>mean</code>,
<code>data</code>, <code>df</code>, <code>weights</code>). If in doubt,
check the help to see if the name is already in use. It’s also best to
avoid dots (<code>.</code>) within an object name as in
<code>my.dataset</code>. There are many objects in R with dots in their
names for historical reasons, but because dots have a special meaning in
R (for methods) and other programming languages, it’s best to avoid
them. The recommended writing style is called snake_case, which implies
using only lowercaseletters and numbers and separating each word with
underscores (e.g., animals_weight, average_income). It is also
recommended to use nouns for object names, and verbs for function names.
It’s important to be consistent in the styling of your code (where you
put spaces, how you name objects, etc.). Using a consistent coding style
makes your code clearer to read for your future self and your
collaborators. In R, three popular style guides are <a href="https://google.github.io/styleguide/Rguide.xml" class="external-link">Google’s</a>, <a href="https://jef.works/R-style-guide/" class="external-link">Jean Fan’s</a> and the <a href="https://style.tidyverse.org/" class="external-link">tidyverse’s</a>. The tidyverse’s is
very comprehensive and may seem overwhelming at first. You can install
the <a href="https://github.com/jimhester/lintr" class="external-link"><strong><code>lintr</code></strong></a>
package to automatically check for issues in the styling of your
code.</p>
<div id="objects-vs.-variables" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="objects-vs.-variables" class="callout-inner">
<h3 class="callout-title">Objects vs. variables</h3>
<div class="callout-content">
<p>What are known as <code>objects</code> in <code>R</code> are known as
<code>variables</code> in many other programming languages. Depending on
the context, <code>object</code> and <code>variable</code> can have
drastically different meanings. However, in this lesson, the two words
are used synonymously. For more information see: <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Objects" class="external-link">https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Objects</a></p>
</div>
</div>
</div>
<p>When assigning a value to an object, R does not print anything. You
can force R to print the value by using parentheses or by typing the
object name:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_sec</span> <span class="op">&lt;-</span> <span class="fl">100</span>    <span class="co"># doesn't print anything</span></span>
<span><span class="op">(</span><span class="va">duration_sec</span> <span class="op">&lt;-</span> <span class="fl">100</span><span class="op">)</span>  <span class="co"># putting parenthesis around the call prints the value of `area_hectares`</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 100</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_sec</span>        <span class="co"># and so does typing the name of the object</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 100</code></pre>
</div>
<p>Now that R has a value for <code>duration_sec</code> in memory, we
can do arithmetic with it. For instance, we may want to convert the
seconds into minutes (minutes are the time in seconds divided by
60):</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_sec</span> <span class="op">/</span> <span class="fl">60</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.666667</code></pre>
</div>
<p>We can also change an object’s value by assigning it a new one:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_sec</span> <span class="op">&lt;-</span> <span class="fl">600</span></span>
<span><span class="va">duration_sec</span> <span class="op">/</span> <span class="fl">60</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 10</code></pre>
</div>
<p>This means that assigning a value to one object does not change the
values of other objects.</p>
<p>For example, let’s store the duration in minutes in a new object,
<code>duration_min</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_min</span> <span class="op">&lt;-</span> <span class="va">duration_sec</span><span class="op">/</span><span class="fl">60</span></span></code></pre>
</div>
<p>and then change <code>duration_sec</code> to 2400.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_sec</span> <span class="op">&lt;-</span> <span class="fl">2400</span></span></code></pre>
</div>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>What do you think is the current content of the object
<code>duration_min</code>? 40 or 10</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The value of <code>duration_min</code> is still 10 because you have
not re-run the line <code>duration_min &lt;- duration_sec/60</code>
since changing the value of <code>duration_min</code>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="comments">Comments<a class="anchor" aria-label="anchor" href="#comments"></a>
</h2>
<hr class="half-width">
<p>All programming languages allow the programmer to include comments in
their code. Including comments to your code has many advantages: it
helps you explain your reasoning and it forces you to be tidy. A
commented code is also a great tool not only to your collaborators, but
to your future self. Comments are the key to a reproducible
analysis.</p>
<p>To do this in R we use the <code>#</code> character. Anything to the
right of the <code>#</code> sign and up to the end of the line is
treated as a comment and is ignored by R. You can start lines with
comments or include them after any code on the line.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration_sec</span> <span class="op">&lt;-</span> <span class="fl">250</span>      <span class="co"># duration in seconds</span></span>
<span><span class="va">duration_min</span> <span class="op">&lt;-</span> <span class="va">duration_sec</span> <span class="op">/</span><span class="fl">60</span>  <span class="co"># convert to minutes</span></span>
<span><span class="va">duration_min</span>        <span class="co"># print duration in minutes</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4.166667</code></pre>
</div>
<p>RStudio makes it easy to comment or uncomment a paragraph: after
selecting the lines you want to comment, press at the same time on your
keyboard <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd>. If you only
want to comment out one line, you can put the cursor at any location of
that line (i.e. no need to select the whole line), then press
<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd>.</p>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Create two variables <code>like_count</code> and
<code>commment_count</code> and assign them values.</p>
<p>Create a third variable <code>ratio</code> and give it a value based
on the current values of <code>like_count</code> and
<code>comment_count</code>. Show that changing the values of either
<code>like_count</code> and <code>comment_count</code> does not affect
the value of <code>ratio</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">like_count</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">comment_count</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">like_count</span><span class="op">/</span><span class="va">comment_count</span></span>
<span><span class="va">ratio</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># change the values of like_count and comment_count</span></span>
<span><span class="va">like_count</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">comment_count</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="co"># the value of ratio isn't changed</span></span>
<span><span class="va">ratio</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.5</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="functions-and-their-arguments">Functions and their arguments<a class="anchor" aria-label="anchor" href="#functions-and-their-arguments"></a>
</h3>
<p>Functions are “canned scripts” that automate more complicated sets of
commands including operations assignments, etc. Many functions are
predefined, or can be made available by importing R <em>packages</em>
(more on that later). A function usually gets one or more inputs called
<em>arguments</em>. Functions often (but not always) return a
<em>value</em>. A typical example would be the function
<code>nchar()</code>, which returns the number of individual characters
in a word, sentence, or longer text. The input (the argument) must be a
string (text), and the return value (in fact, the output) is the number
of characters in the string. Executing a function (‘running it’) is
called <em>calling</em> the function. An example of a function call
is:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fu">nchar</span><span class="op">(</span><span class="st">"Tweebuffelsmeteenskootmorsdoodgeskietfontein"</span><span class="op">)</span></span>
<span><span class="va">length</span></span></code></pre>
</div>
<p>Here, the string
<code>Tweebuffelsmeteenskootmorsdoodgeskietfontein</code> is given to
the <code>nchar()</code> function, the <code>nchar()</code> function
counts the number of characters, and returns the value “44” which is
then assigned to the object <code>length</code>. This function has just
one argument.</p>
<p>The return ‘value’ of a function need not be numerical (like that of
<code>nchar()</code>), and it also does not need to be a single item: it
can be a set of things, or even a dataset. We’ll see that when we read
data files into R.</p>
<p>Arguments can be anything, not only numbers or filenames, but also
other objects. Exactly what each argument means differs per function,
and must be looked up in the documentation (see below). Some functions
take arguments which may either be specified by the user, or, if left
out, take on a <em>default</em> value: these are called
<em>options</em>. Options are typically used to alter the way the
function operates, such as whether it ignores ‘bad values’, or what
symbol to use in a plot. However, if you want something specific, you
can specify a value of your choice which will be used instead of the
default.</p>
<p>Let’s try a function that can take multiple arguments:
<code>paste()</code>.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="st">"🚙"</span>,<span class="st">"😊🕺"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "🚙 😊🕺"</code></pre>
</div>
<p>Here, we’ve called <code>paste()</code> with two arguments, “🚙” and
“😊🕺”, and it returns the string “🚙 😊🕺”. It has concatenated the
first argument (the car) with the second argument (the smiley and
dancing emoji). We can use <code>args(paste)</code> or look at the help
for this function using <code>?paste</code>.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">args</span><span class="op">(</span><span class="va">paste</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="kw">function</span> <span class="op">(</span><span class="va">...</span>, <span class="va">sep</span> <span class="op">=</span> <span class="st">" "</span>, <span class="va">collapse</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">recycle0</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="cn">NULL</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">paste</span></span></code></pre>
</div>
<p>We see that if we want to separate the terms with the | symbol, we
can type <code>sep=|</code> or any other separator.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="st">"🚙"</span>,<span class="st">"😊🕺"</span>,<span class="st">"😳"</span>,sep<span class="op">=</span><span class="st">"|"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "🚙|😊🕺|😳"</code></pre>
</div>
<p>It’s good practice to put the non-optional arguments (like the
strings you’re pasting) first in your function call, and to specify the
names of all optional arguments(like sep). If you don’t, someone reading
your code might have to look up the definition of a function with
unfamiliar arguments to understand what you’re doing.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste0</span><span class="op">(</span><span class="st">"🚙"</span>,<span class="st">"😊🕺"</span>,<span class="st">"😳"</span>,collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "🚙😊🕺😳"</code></pre>
</div>
<div id="exercise-2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Type in <code>?grepl</code> at the console and then look at the
output in the Help pane. What other functions exist that are similar to
<code>grepl</code>? How do you use the <code>ignore.case</code>
parameter in the grepl function?</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="vectors-and-data-types">Vectors and data types<a class="anchor" aria-label="anchor" href="#vectors-and-data-types"></a>
</h2>
<hr class="half-width">
<figure><img src="fig/R_01_vector.png" alt='A graphical representation of a vector named "audio_language" showing how each value stored in the vector corresponds to an index starting at 1.' class="figure mx-auto d-block"></figure><p>A vector is the most common and basic data type in R, and is pretty
much the workhorse of R. A vector is composed of a series of values,
which can be either numbers or characters. We can assign a series of
values to a vector using the <code>c()</code> function. For example we
can create a vector of the number of views of the videos we’re studying
and assign it to a new object <code>view_count</code>:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">view_count</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">120987</span>, <span class="fl">789</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">view_count</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 120987    789      1      2</code></pre>
</div>
<p>A vector can also contain characters. For example, we can have a
vector of the categories content creators have used to classify their
YouTube videos (<code>video_category_label</code>):</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">video_category_label</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"politics"</span>, <span class="st">"society"</span>, <span class="st">"business"</span><span class="op">)</span></span>
<span><span class="va">video_category_label</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "politics" "society"  "business"</code></pre>
</div>
<p>The quotes around “politics”, etc. are essential here. Without the
quotes R will assume there are objects called <code>politics</code>,
<code>society</code> and <code>business</code>. As these objects don’t
exist in R’s memory, there will be an error message.</p>
<p>There are many functions that allow you to inspect the content of a
vector. <code>length()</code> tells you how many elements are in a
particular vector:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">video_category_label</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<p>An important feature of a vector, is that all of the elements are the
same type of data. The function <code>typeof()</code> indicates the type
of an object:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "double"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">video_category_label</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<p>The function <code>str()</code> provides an overview of the structure
of an object and its elements. It is a useful function when working with
large and complex objects:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:4] 120987 789 1 2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">video_category_label</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "politics" "society" "business"</code></pre>
</div>
<p>You can use the <code>c()</code> function to add other elements to
your vector:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_l_audio_language</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"af"</span>, <span class="st">"zu"</span><span class="op">)</span></span>
<span><span class="va">default_l_audio_language</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">default_l_audio_language</span>, <span class="st">"fr"</span><span class="op">)</span> <span class="co"># add to the end of the vector</span></span>
<span><span class="va">default_l_audio_language</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"ar"</span>, <span class="va">default_l_audio_language</span><span class="op">)</span> <span class="co"># add to the beginning of the vector</span></span>
<span><span class="va">default_l_audio_language</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "ar" "en" "af" "zu" "fr"</code></pre>
</div>
<p>In the first line, we take the original vector
<code>default_l_audio_language</code>, add the value <code>"fr"</code>
to the end of it, and save the result back into
<code>default_l_audio_language</code>. Then we add the value
<code>"ar"</code> to the beginning, again saving the result back into
<code>default_l_audio_language</code>.</p>
<p>We can do this over and over again to grow a vector, or assemble a
dataset. As we program, this may be useful to add results that we are
collecting or calculating.</p>
<p>An <strong>atomic vector</strong> is the simplest R <strong>data
type</strong> and is a linear vector of a single type. Above, we saw 2
of the 6 main <strong>atomic vector</strong> types that R uses:
<code>"character"</code> and <code>"numeric"</code> (or
<code>"double"</code>). These are the basic building blocks that all R
objects are built from. The other 4 <strong>atomic vector</strong> types
are:</p>
<ul>
<li>
<code>"logical"</code> for <code>TRUE</code> and <code>FALSE</code>
(the boolean data type)</li>
<li>
<code>"integer"</code> for integer numbers (e.g., <code>2L</code>,
the <code>L</code> indicates to R that it’s an integer)</li>
<li>
<code>"complex"</code> to represent complex numbers with real and
imaginary parts (e.g., <code>1 + 4i</code>) and that’s all we’re going
to say about them</li>
<li>
<code>"raw"</code> for bitstreams that we won’t discuss further</li>
</ul>
<p>You can check the type of your vector using the <code>typeof()</code>
function and inputting your vector as the argument.</p>
<p>Vectors are one of the many <strong>data structures</strong> that R
uses. Other important ones are lists (<code>list</code>), matrices
(<code>matrix</code>), data frames (<code>data.frame</code>), factors
(<code>factor</code>) and arrays (<code>array</code>).</p>
<div id="exercise-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-3" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>We’ve seen that atomic vectors can be of type character, numeric (or
double), integer, and logical. But what happens if we try to mix these
types in a single vector?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>R implicitly converts them to all be the same type.</p>
</div>
</div>
</div>
</div>
<div id="exercise-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-3" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>What will happen in each of these examples? (hint: use
<code>class()</code> to check the data type of your objects):</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_char</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="va">num_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">char_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">tricky</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="st">"4"</span><span class="op">)</span></span></code></pre>
</div>
<p>Why do you think it happens?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>Vectors can be of only one data type. R tries to convert (coerce) the
content of this vector to find a “common denominator” that doesn’t lose
any information.</p>
</div>
</div>
</div>
</div>
<div id="exercise-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-3" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>How many values in <code>combined_logical</code> are
<code>"TRUE"</code> (as a character) in the following example:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">char_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">combined_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">num_logical</span>, <span class="va">char_logical</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>Only one. There is no memory of past data types, and the coercion
happens the first time the vector is evaluated. Therefore, the
<code>TRUE</code> in <code>num_logical</code> gets converted into a
<code>1</code> before it gets converted into <code>"1"</code> in
<code>combined_logical</code>.</p>
</div>
</div>
</div>
</div>
<div id="exercise-3" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-3" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>You’ve probably noticed that objects of different types get converted
into a single, shared type within a vector. In R, we call converting
objects from one class into another class <em>coercion</em>. These
conversions happen according to a hierarchy, whereby some types get
preferentially coerced into other types. Can you draw a diagram that
represents the hierarchy of how these data types are coerced?</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="subsetting-vectors">Subsetting vectors<a class="anchor" aria-label="anchor" href="#subsetting-vectors"></a>
</h2>
<hr class="half-width">
<p>Subsetting (sometimes referred to as extracting or indexing) involves
accessing out one or more values based on their numeric placement or
“index” within a vector. If we want to subset one or several values from
a vector, we must provide one index or several indices in square
brackets. For instance:</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">audio_language</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"af"</span>, <span class="st">"zu"</span><span class="op">)</span></span>
<span><span class="va">audio_language</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "af"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">audio_language</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "zu" "af"</code></pre>
</div>
<p>We can also repeat the indices to create an object with more elements
than the original one:</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extra_audio_language</span> <span class="op">&lt;-</span> <span class="va">audio_language</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">extra_audio_language</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "zu" "af" "af" "en" "zu" "af"</code></pre>
</div>
<p>R indices start at 1. Programming languages like Fortran, MATLAB,
Julia, and R start counting at 1, because that’s what human beings
typically do. Languages in the C family (including C++, Java, Perl, and
Python) count from 0 because that’s simpler for computers to do.</p>
<div class="section level3">
<h3 id="conditional-subsetting">Conditional subsetting<a class="anchor" aria-label="anchor" href="#conditional-subsetting"></a>
</h3>
<p>Another common way of subsetting is by using a logical vector.
<code>TRUE</code> will select the element with the same index, while
<code>FALSE</code> will not:</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">view_count</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">120987</span>, <span class="fl">789</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">view_count</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 120987      1</code></pre>
</div>
<p>Typically, these logical vectors are not typed by hand, but are the
output of other functions or logical tests. For instance, if you wanted
to select only the values above 5:</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">view_count</span> <span class="op">&gt;</span> <span class="fl">5</span>    <span class="co"># will return logicals with TRUE for the indices that meet the condition</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  TRUE  TRUE FALSE FALSE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## so we can use this to select only the values above 5</span></span>
<span><span class="va">view_count</span><span class="op">[</span><span class="va">view_count</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 120987    789</code></pre>
</div>
<p>You can combine multiple tests using</p>
<p>-<code>&amp;</code> (both conditions are true, AND) or -
<code>|</code> (at least one of the conditions is true, OR)</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">view_count</span><span class="op">[</span><span class="va">view_count</span> <span class="op">&gt;=</span> <span class="fl">10</span> <span class="op">|</span> <span class="va">view_count</span> <span class="op">&lt;=</span> <span class="fl">1000</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 120987    789      1      2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">view_count</span><span class="op">[</span><span class="va">view_count</span> <span class="op">&gt;=</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">view_count</span> <span class="op">&lt;=</span> <span class="fl">10000</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 789</code></pre>
</div>
<p>Here, <code>&lt;</code> stands for “less than”, <code>&gt;</code> for
“greater than”, <code>&gt;=</code> for “greater than or equal to”, and
<code>==</code> for “equal to”. The double equal sign <code>==</code> is
a test for numerical equality between the left and right hand sides, and
should not be confused with the single <code>=</code> sign, which
performs variable assignment (similar to <code>&lt;-</code>).</p>
<p>A common task is to search for certain strings in a vector. One could
use the “or” operator <code>|</code> to test for equality to multiple
values, but this can quickly become tedious.</p>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">audio_language</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"ar"</span>, <span class="st">"en"</span>, <span class="st">"af"</span>,<span class="st">"zu"</span>,<span class="st">"fr"</span><span class="op">)</span></span>
<span><span class="va">audio_language</span><span class="op">[</span><span class="va">audio_language</span> <span class="op">==</span> <span class="st">"zu"</span> <span class="op">|</span> <span class="va">audio_language</span> <span class="op">==</span> <span class="st">"af"</span><span class="op">]</span> <span class="co"># returns both zu and af</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "af" "zu"</code></pre>
</div>
<p>The function <code>%in%</code> allows you to test if any of the
elements of a search vector (on the left hand side) are found in the
target vector (on the right hand side):</p>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">audio_language</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"fr"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE  TRUE FALSE FALSE  TRUE</code></pre>
</div>
<p>Note that the output is the same length as the search vector on the
left hand side, because <code>%in%</code> checks whether each element of
the search vector is found somewhere in the target vector. Thus, you can
use <code>%in%</code> to select the elements in the search vector that
appear in your target vector:</p>
<div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">audio_language</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"af"</span>, <span class="st">"xh"</span>, <span class="st">"zu"</span>,<span class="st">"fr"</span>,<span class="st">"ar"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE TRUE TRUE TRUE TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">audio_language</span><span class="op">[</span><span class="va">audio_language</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"af"</span>, <span class="st">"xh"</span>, <span class="st">"zu"</span>, <span class="st">"fr"</span>, <span class="st">"ar"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "ar" "en" "af" "zu" "fr"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">audio_language</span><span class="op">[</span><span class="va">audio_language</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"fr"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "en" "fr"</code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="missing-data">Missing data<a class="anchor" aria-label="anchor" href="#missing-data"></a>
</h2>
<hr class="half-width">
<p>As R was designed to analyze datasets, it includes the concept of
missing data (which is uncommon in other programming languages). Missing
data are represented in vectors as <code>NA</code>.</p>
<p>When doing operations on numbers, most functions will return
<code>NA</code> if the data you are working with include missing values.
This feature makes it harder to overlook the cases where you are dealing
with missing data. You can add the argument <code>na.rm=TRUE</code> to
calculate the result while ignoring the missing values.</p>
<div class="codewrapper sourceCode" id="cb78">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comment_count</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu">mean</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] NA</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb80">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] NA</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb82">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">comment_count</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2.75</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb84">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="va">comment_count</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 7</code></pre>
</div>
<p>If your data include missing values, you may want to become familiar
with the functions <code>is.na()</code>, <code>na.omit()</code>, and
<code>complete.cases()</code>. See below for examples.</p>
<div class="codewrapper sourceCode" id="cb86">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract those elements which are not missing values.</span></span>
<span><span class="co">## The ! character is also called the NOT operator</span></span>
<span><span class="va">comment_count</span><span class="op">[</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 1 1 7</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb88">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Count the number of missing values.</span></span>
<span><span class="co">## The output of is.na() is a logical vector (TRUE/FALSE equivalent to 1/0) so the sum() function here is effectively counting</span></span>
<span><span class="fu">sum</span><span class="op">(</span><span class="fu">is.na</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb90">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Returns the object with incomplete cases removed. The returned object is an atomic vector of type `"numeric"` (or `"double"`).</span></span>
<span><span class="fu">na.omit</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 1 1 7
attr(,"na.action")
[1] 4
attr(,"class")
[1] "omit"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb92">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract those elements which are complete cases. The returned object is an atomic vector of type `"numeric"` (or `"double"`).</span></span>
<span><span class="va">comment_count</span><span class="op">[</span><span class="fu">complete.cases</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 1 1 7</code></pre>
</div>
<p>Recall that you can use the <code>typeof()</code> function to find
the type of your atomic vector.</p>
<div id="exercise-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-4" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Using this vector of comments, create a new vector with the NAs
removed.</li>
</ol>
<div class="codewrapper sourceCode" id="cb94">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comment_count</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">2</span>, <span class="fl">19</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1999</span>, <span class="fl">1</span>, <span class="fl">89</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li><p>Use the function <code>median()</code> to calculate the median of
the <code>comment_count</code> vector.</p></li>
<li><p>Use R to figure out how many videos in the set received more than
two comments.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb95">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comment_count</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">2</span>, <span class="fl">19</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1999</span>, <span class="fl">1</span>, <span class="fl">89</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">comments_no_na</span> <span class="op">&lt;-</span> <span class="va">comment_count</span><span class="op">[</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># or</span></span>
<span><span class="va">comments_no_na</span> <span class="op">&lt;-</span> <span class="fu">na.omit</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span></span>
<span><span class="co"># 2.</span></span>
<span><span class="fu">median</span><span class="op">(</span><span class="va">comment_count</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2.5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb97">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3.</span></span>
<span><span class="va">comments_above_2</span> <span class="op">&lt;-</span> <span class="va">comments_no_na</span><span class="op">[</span><span class="va">comments_no_na</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">]</span></span>
<span><span class="fu">length</span><span class="op">(</span><span class="va">comments_above_2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 7</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now that we have learned how to write scripts, and the basics of R’s
data structures, we are ready to start working with the YouTube dataset
we have been using in the other lessons, and learn about data
frames.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Access individual values by location using <code>[]</code>.</li>
<li>Access arbitrary sets of data using <code>[c(...)]</code>.</li>
<li>Use logical operations and logical vectors to access subsets of
data.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-02-starting-with-data"><p>Content from <a href="02-starting-with-data.html">Starting with Data</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/02-starting-with-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a data.frame?</li>
<li>How can I read a complete csv file into R?</li>
<li>How can I get basic summary information about my dataset?</li>
<li>How are dates represented in R and how can I change the format?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe what a data frame is.</li>
<li>Load external data from a .csv file into a data frame.</li>
<li>Summarize the contents of a data frame.</li>
<li>Subset values from data frames.</li>
<li>Change how character strings are handled in a data frame.</li>
<li>Examine and change date formats.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-are-data-frames">What are data frames?<a class="anchor" aria-label="anchor" href="#what-are-data-frames"></a>
</h2>
<hr class="half-width">
<p>Data frames are the <em>de facto</em> data structure for tabular data
in <code>R</code>, and what we use for data processing, statistics, and
plotting.</p>
<p>A data frame is the representation of data in the format of a table
where the columns are vectors that all have the same length. Data frames
are analogous to the more familiar spreadsheet in programs such as
Excel, with one key difference. Because columns are vectors, each column
must contain a single type of data (e.g., characters, integers,
factors). For example, here is a figure depicting a data frame
comprising a numeric, a character, and a logical vector.</p>
<figure><img src="fig/data-frame.svg" alt="A 3 by 3 data frame with columns showing numeric, character and logical values." class="figure mx-auto d-block"></figure><p>Data frames can be created by hand, but most commonly they are
generated by the functions <code>read_csv()</code> or
<code>read_table()</code>; in other words, when importing spreadsheets
from your hard drive (or the web). We will now demonstrate how to import
tabular data using <code>read_csv()</code>.</p>
</section><section><h2 class="section-heading" id="presentation-of-the-clicks-youtube-data">Presentation of the Clicks YouTube data<a class="anchor" aria-label="anchor" href="#presentation-of-the-clicks-youtube-data"></a>
</h2>
<hr class="half-width">
<p>We will be working with a dataset of 200 Youtube posts. Here is some
background to the dataset.</p>
<p>An initial dataset of 314 posts were returned by the YouTube API in
response to the following query: “Query: clicks south africa* hair (ad
OR advertisement) -click” covering videos posted during the period 2020
- 2023 The dataset was prepared using a spreadsheet and OpenRefine to
identify missing values, change variable names to “snake case”, change
tags and topics to lowercase, and to use semicolons to separate tags and
topics. Owing to the ambiguity of the keyword “clicks”, many irrelevant
results were returned. The dataset was reviewed and any posts which were
not related to the controversy, or which did not relate to issues about
body politics and racism were excluded. This resulted in a dataset of
200 posts selected for computational analysis. In case you need a
refresher, here are some details about how YouTube API derives the <a href="https://supermetrics.com/docs/integration-youtube-public-data-fields/" class="external-link">variables
in this dataset</a>.</p>
<p>We will be using a subset of the dataset that was prepared in
OpenRefine (<code>data/youtube-27082024-open-refine-200-na.csv</code>).
In this dataset, the missing data is encoded as “na”, each row holds
information for a single YouTube video, and the columns represent |</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="86%">
</colgroup>
<thead><tr class="header">
<th>column_name</th>
<th>description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>‘position’</td>
<td></td>
</tr>
<tr class="even">
<td>‘randomise’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘channel_id’</td>
<td></td>
</tr>
<tr class="even">
<td>‘channel_title’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘video_id’</td>
<td></td>
</tr>
<tr class="even">
<td>‘url’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘published_at’</td>
<td></td>
</tr>
<tr class="even">
<td>‘published_at_sql’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘year’</td>
<td></td>
</tr>
<tr class="even">
<td>‘month’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘day’</td>
<td></td>
</tr>
<tr class="even">
<td>‘video_title’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘video_description’</td>
<td></td>
</tr>
<tr class="even">
<td>‘tags’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘video_category_label’</td>
<td></td>
</tr>
<tr class="even">
<td>‘topic_categories’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘duration_sec’</td>
<td></td>
</tr>
<tr class="even">
<td>‘definition’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘caption’</td>
<td></td>
</tr>
<tr class="even">
<td>‘default_language’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘default_l_audio_language’</td>
<td></td>
</tr>
<tr class="even">
<td>‘thumbnail_maxres’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘licensed_content’</td>
<td></td>
</tr>
<tr class="even">
<td>‘location_description’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘view_count’</td>
<td></td>
</tr>
<tr class="even">
<td>‘like_count’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘favorite_count’</td>
<td></td>
</tr>
<tr class="even">
<td>‘comment_count’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘controversy’</td>
<td></td>
</tr>
<tr class="even">
<td>‘clicks’</td>
<td></td>
</tr>
<tr class="odd">
<td>‘body_politics’</td>
<td></td>
</tr>
<tr class="even">
<td>‘eff_lead’</td>
<td></td>
</tr>
</tbody>
</table></section><section><h2 class="section-heading" id="importing-data">Importing data<a class="anchor" aria-label="anchor" href="#importing-data"></a>
</h2>
<hr class="half-width">
<p>You are going to load the data in R’s memory using the function
<code>read_csv()</code> from the <strong><code>readr</code></strong>
package, which is part of the <strong><code>tidyverse</code></strong>;
learn more about the <strong><code>tidyverse</code></strong> collection
of packages <a href="https://www.tidyverse.org/" class="external-link">here</a>.
<strong><code>readr</code></strong> gets installed as part as the
<strong><code>tidyverse</code></strong> installation. When you load the
<strong><code>tidyverse</code></strong>
(<code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>), the core packages (the packages used
in most data analyses) get loaded, including
<strong><code>readr</code></strong>.</p>
<p>Before proceeding, however, this is a good opportunity to talk about
conflicts. Certain packages we load can end up introducing function
names that are already in use by pre-loaded R packages. For instance,
when we load the tidyverse package below, we will introduce two
conflicting functions: <code>filter()</code> and <code>lag()</code>.
This happens because <code>filter</code> and <code>lag</code> are
already functions used by the stats package (already pre-loaded in R).
What will happen now is that if we, for example, call the
<code>filter()</code> function, R will use the
<code>dplyr::filter()</code> version and not the
<code>stats::filter()</code> one. This happens because, if conflicted,
by default R uses the function from the most recently loaded package.
Conflicted functions may cause you some trouble in the future, so it is
important that we are aware of them so that we can properly handle them,
if we want.</p>
<p>To do so, we just need the following functions from the conflicted
package:</p>
<ul>
<li>
<code>conflicted::conflict_scout()</code>: Shows us any conflicted
functions.<br>
</li>
<li>
<code>conflict_prefer("function", "package_prefered")</code>: Allows
us to choose the default function we want from now on.</li>
</ul>
<p>It is also important to know that we can, at any time, just call the
function directly from the package we want, such as
<code>stats::filter()</code>.</p>
<p>Even with the use of an RStudio project, it can be difficult to learn
how to specify paths to file locations. Enter the <strong>here</strong>
package! The here package creates paths relative to the top-level
directory (your RStudio project). These relative paths work
<em>regardless</em> of where the associated source file lives inside
your project, like analysis projects with data and reports in different
subdirectories. This is an important contrast to using
<code>setwd()</code>, which depends on the way you order your files on
your computer.</p>
<figure><img src="fig/here_horst.png" alt="Monsters at a fork in the road, with signs saying here, and not here. One direction, not here, leads to a scary dark forest with spiders and absolute filepaths, while the other leads to a sunny, green meadow, and a city below a rainbow and a world free of absolute filepaths. Art by Allison Horst" width="100%" style="display: block; margin: auto;" class="figure"><figcaption>
Image credit:
<a href="https://github.com/allisonhorst/stats-illustrations" class="external-link">Allison
Horst</a>
</figcaption></figure><p>Before we can use the <code>read_csv()</code> and <code>here()</code>
functions, we need to load the tidyverse and here packages.</p>
<p>Also, if you recall, the missing data is encoded as “na” in the
dataset. We’ll tell it to the function, so R will automatically convert
all the “na” entries in the dataset into <code>NA</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">here</span><span class="op">)</span></span>
<span></span>
<span><span class="va">videos</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"youtube-27082024-open-refine-200-na.csv"</span><span class="op">)</span>, </span>
<span>  na <span class="op">=</span> <span class="st">"na"</span><span class="op">)</span></span></code></pre>
</div>
<p>In the above code, we notice the <code>here()</code> function takes
folder and file names as inputs (e.g., <code>"data"</code>,
<code>"youtube-27082024-open-refine-200-na.csv"</code>), each enclosed
in quotations (<code>""</code>) and separated by a comma. The
<code>here()</code> will accept as many names as are necessary to
navigate to a particular file (e.g.,
<code>here("analysis", "data", "surveys", "clean", "youtube-27082024-open-refine-200-na.csv")</code>).</p>
<p>The <code>here()</code> function can accept the folder and file names
in an alternate format, using a slash (“/”) rather than commas to
separate the names. The two methods are equivalent, so that
<code>here("data", "youtube-27082024-open-refine-200-na.csv")</code> and
<code>here("data/youtube-27082024-open-refine-200-na.csv")</code>
produce the same result. (The slash is used on all operating systems;
backslashes are not used.)</p>
<p>If you were to type in the code above, it is likely that the
<code>read.csv()</code> function would appear in the automatically
populated list of functions. This function is different from the
<code>read_csv()</code> function, as it is included in the “base”
packages that come pre-installed with R. Overall,
<code>read.csv()</code> behaves similar to <code>read_csv()</code>, with
a few notable differences. First, <code>read.csv()</code> coerces column
names with spaces and/or special characters to different names
(e.g. <code>interview date</code> becomes <code>interview.date</code>).
Second, <code>read.csv()</code> stores data as a
<code>data.frame</code>, where <code>read_csv()</code> stores data as a
different kind of data frame called a <code>tibble</code>. We prefer
tibbles because they have nice printing properties among other desirable
qualities. Read more about tibbles <a href="https://tibble.tidyverse.org/" class="external-link">here</a>.</p>
<p>The second statement in the code above creates a data frame but
doesn’t output any data because, as you might recall, assignments
(<code>&lt;-</code>) don’t display anything. (Note, however, that
<code>read_csv</code> may show informational text about the data frame
that is created.) If we want to check that our data has been loaded, we
can see the contents of the data frame by typing its name:
<code>videos</code> in the console.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span></span>
<span><span class="co">## Try also</span></span>
<span><span class="co">## view(videos)</span></span>
<span><span class="co">## head(videos)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 32
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA               iPUAl1j… http…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA               YUmIAd_… http…
 3      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 4      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 5      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 6      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 7      145       452 UCaCcVtl9O3h5en4m-_edhZg Celeb LaLa Land    1l5GZ0N… http…
 8      315       276 UCAurTjb6Ewz21vjfTs1wZxw NOSIPHO NZAMA      j4Y022C… http…
 9      190       321 UCBlX1mnsIFZRqsyRNvpW_rA Zandile Mhlambi    gf2YNN6… http…
10      214       762 UClY87IoUANFZtswyC9GeecQ Beauty recipes     AGJmRd4… http…
# ℹ 190 more rows
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
<div id="note" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note" class="callout-inner">
<h3 class="callout-title">Note</h3>
<div class="callout-content">
<p><code>read_csv()</code> assumes that fields are delimited by commas.
However, in several countries, the comma is used as a decimal separator
and the semicolon (;) is used as a field delimiter. If you want to read
in this type of files in R, you can use the <code>read_csv2</code>
function. It behaves exactly like <code>read_csv</code> but uses
different parameters for the decimal and the field separators. If you
are working with another format, they can be both specified by the user.
Check out the help for <code>read_csv()</code> by typing
<code>?read_csv</code> to learn more. There is also the
<code>read_tsv()</code> for tab-separated data files, and
<code>read_delim()</code> allows you to specify more details about the
structure of your file.</p>
</div>
</div>
</div>
<p>Note that <code>read_csv()</code> actually loads the data as a
tibble. A tibble is an extension of <code>R</code> data frames used by
the <strong><code>tidyverse</code></strong>. When the data is read using
<code>read_csv()</code>, it is stored in an object of class
<code>tbl_df</code>, <code>tbl</code>, and <code>data.frame</code>. You
can see the class of an object with</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">videos</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" </code></pre>
</div>
<p>As a <code>tibble</code>, the type of data included in each column is
listed in an abbreviated fashion below the column names. For instance,
here <code>key_ID</code> is a column of floating point numbers
(abbreviated <code>&lt;dbl&gt;</code> for the word ‘double’),
<code>channel_title</code> is a column of characters
(<code>&lt;chr&gt;</code>) and the <code>published_at</code> is a column
in the “date and time” format (<code>&lt;dttm&gt;</code>).</p>
</section><section><h2 class="section-heading" id="inspecting-data-frames">Inspecting data frames<a class="anchor" aria-label="anchor" href="#inspecting-data-frames"></a>
</h2>
<hr class="half-width">
<p>When calling a <code>tbl_df</code> object (like <code>videos</code>
here), there is already a lot of information about our data frame being
displayed such as the number of rows, the number of columns, the names
of the columns, and as we just saw the class of data stored in each
column. However, there are functions to extract this information from
data frames. Here is a non-exhaustive list of some of these functions.
Let’s try them out!</p>
<p>Size:</p>
<ul>
<li>
<code>dim(videos)</code> - returns a vector with the number of rows
as the first element, and the number of columns as the second element
(the <strong>dim</strong>ensions of the object)</li>
<li>
<code>nrow(videos)</code> - returns the number of rows</li>
<li>
<code>ncol(videos)</code> - returns the number of columns</li>
</ul>
<p>Content:</p>
<ul>
<li>
<code>head(videos)</code> - shows the first 6 rows</li>
<li>
<code>tail(videos)</code> - shows the last 6 rows</li>
</ul>
<p>Names:</p>
<ul>
<li>
<code>names(videos)</code> - returns the column names (synonym of
<code>colnames()</code> for <code>data.frame</code> objects)</li>
</ul>
<p>Summary:</p>
<ul>
<li>
<code>str(videos)</code> - structure of the object and information
about the class, length and content of each column</li>
<li>
<code>summary(videos)</code> - summary statistics for each
column</li>
<li>
<code>glimpse(videos)</code> - returns the number of columns and
rows of the tibble, the names and class of each column, and previews as
many values will fit on the screen. Unlike the other inspecting
functions listed above, <code>glimpse()</code> is not a “base R”
function so you need to have the <code>dplyr</code> or
<code>tibble</code> packages loaded to be able to execute it.</li>
</ul>
<p>Note: most of these functions are “generic.” They can be used on
other types of objects besides data frames or tibbles.</p>
</section><section><h2 class="section-heading" id="subsetting-data-frames">Subsetting data frames<a class="anchor" aria-label="anchor" href="#subsetting-data-frames"></a>
</h2>
<hr class="half-width">
<p>Our <code>videos</code> data frame has rows and columns (it has 2
dimensions). In practice, we may not need the entire data frame; for
instance, we may only be interested in a subset of the observations (the
rows) or a particular set of variables (the columns). If we want to
access some specific data from it, we need to specify the “coordinates”
(i.e., indices) we want from it. Row numbers come first, followed by
column numbers.</p>
<div id="tip" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip" class="callout-inner">
<h3 class="callout-title">Tip</h3>
<div class="callout-content">
<p>Subsetting a <code>tibble</code> with <code>[</code> always results
in a <code>tibble</code>. However, note this is not true in general for
data frames, so be careful! Different ways of specifying these
coordinates can lead to results with different classes. This is covered
in the Software Carpentry lesson <a href="https://swcarpentry.github.io/r-novice-gapminder/" class="external-link">R for
Reproducible Scientific Analysis</a>.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first element in the first column of the tibble</span></span>
<span><span class="va">videos</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 1
  position
     &lt;dbl&gt;
1      112</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first element in the 6th column of the tibble </span></span>
<span><span class="va">videos</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 1
  url
  &lt;chr&gt;
1 https://www.youtube.com/watch?v=iPUAl1jywdU</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first column of the tibble (as a vector)</span></span>
<span><span class="va">videos</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  [1] 112  50 149 167 195 213 145 315 190 214 263  30  63  65   2   3   4   7
 [19]   9  13  14  16  17  24  36  66  72 132 118 299  40  43  46  54  58  80
 [37]  88  93  99 103 123 124 152 169 174 181 200 215 217 218 227 236 244 250
 [55] 253 272 282 284 291 257   1  29  38  92 135 139 144 153 170 176 183 187
 [73] 194 197 207 221 226 262 271 273 278 290 294 295 306 307 311  11  44  57
 [91]  60  64  69  70  78  96 107 121 130 308   5   8  10  21  23  25  28  34
[109]  52  56  61  62  71  73  74  81  86  91  98 100 110 120 126 131 133 136
[127] 141 142 143 146 150 154 159 161 164 166 173 178 182 184 191 192 202 208
[145] 210 219 220 223 231 233 234 238 243 245 261 264 275 276 277 283 285 288
[163] 292 300 304 305 309 313   6  15  18  19  22  27  31  33  35  37  39  41
[181]  42  67  77  82  83  85  87  94 158 168 193 254 293 104 155 162 204 209
[199] 246 255</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first column of the tibble</span></span>
<span><span class="va">videos</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 1
   position
      &lt;dbl&gt;
 1      112
 2       50
 3      149
 4      167
 5      195
 6      213
 7      145
 8      315
 9      190
10      214
# ℹ 190 more rows</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first three elements in the 7th column of the tibble</span></span>
<span><span class="va">videos</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 1
  published_at
  &lt;dttm&gt;
1 2020-09-14 16:16:44
2 2020-09-11 05:34:52
3 2020-09-10 11:59:51</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## the 3rd row of the tibble</span></span>
<span><span class="va">videos</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 32
  position randomise channel_id channel_title video_id url   published_at
     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt; &lt;dttm&gt;
1      149       313 UCMwDXpWE… Stellenbosch… v8XfpOi… http… 2020-09-10 11:59:51
# ℹ 25 more variables: published_at_sql &lt;chr&gt;, year &lt;dbl&gt;, month &lt;dbl&gt;,
#   day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;, tags &lt;chr&gt;,
#   video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;, duration_sec &lt;dbl&gt;,
#   definition &lt;chr&gt;, caption &lt;lgl&gt;, default_language &lt;chr&gt;,
#   default_l_audio_language &lt;chr&gt;, thumbnail_maxres &lt;chr&gt;,
#   licensed_content &lt;dbl&gt;, location_description &lt;chr&gt;, view_count &lt;dbl&gt;,
#   like_count &lt;dbl&gt;, favorite_count &lt;dbl&gt;, comment_count &lt;dbl&gt;, …</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## equivalent to head_videos &lt;- head(videos)</span></span>
<span><span class="va">head_videos</span> <span class="op">&lt;-</span> <span class="va">videos</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="op">]</span></span></code></pre>
</div>
<p><code>:</code> is a special function that creates numeric vectors of
integers in increasing or decreasing order, test <code>1:10</code> and
<code>10:1</code> for instance.</p>
<p>You can also exclude certain indices of a data frame using the
“<code>-</code>” sign:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>          <span class="co"># The whole tibble, except the first column</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 31
   randomise channel_id         channel_title video_id url   published_at
       &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt; &lt;dttm&gt;
 1       409 UCI3RT5PGmdi1KVp9… eNCA          iPUAl1j… http… 2020-09-14 16:16:44
 2       702 UCI3RT5PGmdi1KVp9… eNCA          YUmIAd_… http… 2020-09-11 05:34:52
 3       313 UCMwDXpWEVQVw4ZF7… Stellenbosch… v8XfpOi… http… 2020-09-10 11:59:51
 4       384 UCsqKkYLOaJ9oBwq9… SOUTH AFRICA… lnLdo2k… http… 2020-09-07 11:08:43
 5       606 UC5G5Dy8-mmp27jo6… Umgosi Enter… XN6toca… http… 2020-09-08 12:45:36
 6       423 UCC1udUghY9dloGMu… The Tea World rh2Nz78… http… 2020-09-09 15:03:43
 7       452 UCaCcVtl9O3h5en4m… Celeb LaLa L… 1l5GZ0N… http… 2020-09-08 18:43:58
 8       276 UCAurTjb6Ewz21vjf… NOSIPHO NZAMA j4Y022C… http… 2021-06-22 10:18:51
 9       321 UCBlX1mnsIFZRqsyR… Zandile Mhla… gf2YNN6… http… 2020-09-07 18:50:42
10       762 UClY87IoUANFZtswy… Beauty recip… AGJmRd4… http… 2022-11-26 09:08:54
# ℹ 190 more rows
# ℹ 25 more variables: published_at_sql &lt;chr&gt;, year &lt;dbl&gt;, month &lt;dbl&gt;,
#   day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;, tags &lt;chr&gt;,
#   video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;, duration_sec &lt;dbl&gt;,
#   definition &lt;chr&gt;, caption &lt;lgl&gt;, default_language &lt;chr&gt;,
#   default_l_audio_language &lt;chr&gt;, thumbnail_maxres &lt;chr&gt;,
#   licensed_content &lt;dbl&gt;, location_description &lt;chr&gt;, view_count &lt;dbl&gt;, …</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span><span class="op">[</span><span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">131</span><span class="op">)</span>, <span class="op">]</span>   <span class="co"># Equivalent to head(videos)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 75 × 32
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA               iPUAl1j… http…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA               YUmIAd_… http…
 3      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 4      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 5      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 6      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 7      154       806 UCzvl9exW-o8IsySPU-ezgoQ TheKingzRSA        m4KitiL… http…
 8      159       496 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… QigpfXd… http…
 9      161       678 UCFnUvf-Lg1nIc5wvl9lx8zQ Mzansi Hotspot     cuXJVNI… http…
10      164       181 UCITau47AeZDY9sO77TA3OUA ITV News           aqSmGuy… http…
# ℹ 65 more rows
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
<p><code>tibble</code>s can be subset by calling indices (as shown
previously), but also by calling their column names directly:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span><span class="op">[</span><span class="st">"channel_title"</span><span class="op">]</span>       <span class="co"># Result is a tibble</span></span>
<span></span>
<span><span class="va">videos</span><span class="op">[</span>, <span class="st">"channel_title"</span><span class="op">]</span>     <span class="co"># Result is a tibble</span></span>
<span></span>
<span><span class="va">videos</span><span class="op">[[</span><span class="st">"channel_title"</span><span class="op">]</span><span class="op">]</span>     <span class="co"># Result is a vector</span></span>
<span></span>
<span><span class="va">videos</span><span class="op">$</span><span class="va">channel_title</span>          <span class="co"># Result is a vector</span></span></code></pre>
</div>
<p>In RStudio, you can use the autocompletion feature to get the full
and correct names of the columns.</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Create a tibble (<code>videos_100</code>) containing only the data
in row 100 of the <code>videos</code> dataset.</li>
</ol>
<p>Now, continue using <code>videos</code> for each of the following
activities:</p>
<ol start="2" style="list-style-type: decimal">
<li>Notice how <code>nrow()</code> gave you the number of rows in the
tibble?</li>
</ol>
<ul>
<li>Use that number to pull out just that last row in the tibble.</li>
<li>Compare that with what you see as the last row using
<code>tail()</code> to make sure it’s meeting expectations.</li>
<li>Pull out that last row using <code>nrow()</code> instead of the row
number.</li>
<li>Create a new tibble (<code>videos_last</code>) from that last
row.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>Using the number of rows in the videos dataset that you found in
question 2, extract the row that is in the middle of the dataset. Store
the content of this middle row in an object named
<code>videos_middle</code>. (hint: This dataset has an odd number of
rows, so finding the middle is a bit trickier than dividing n_rows by 2.
Use the median( ) function and what you’ve learned about sequences in R
to extract the middle row!</p></li>
<li><p>Combine <code>nrow()</code> with the <code>-</code> notation
above to reproduce the behavior of <code>head(videos)</code>, keeping
just the first through 6th rows of the videos dataset.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 1.</span></span>
<span><span class="va">videos_100</span> <span class="op">&lt;-</span> <span class="va">videos</span><span class="op">[</span><span class="fl">100</span>, <span class="op">]</span></span>
<span><span class="co">## 2.</span></span>
<span><span class="co"># Saving `n_rows` to improve readability and reduce duplication</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="fu">nrow</span><span class="op">(</span><span class="va">videos</span><span class="op">)</span></span>
<span><span class="va">videos_last</span> <span class="op">&lt;-</span> <span class="va">videos</span><span class="op">[</span><span class="va">n_rows</span>, <span class="op">]</span></span>
<span><span class="co">## 3.</span></span>
<span><span class="va">videos_middle</span> <span class="op">&lt;-</span> <span class="va">videos</span><span class="op">[</span><span class="fu">median</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_rows</span><span class="op">)</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in `videos[median(1:n_rows), ]`:
! Can't subset rows with `median(1:n_rows)`.
✖ Can't convert from `i` &lt;double&gt; to &lt;integer&gt; due to loss of precision.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 4.</span></span>
<span><span class="va">videos_head</span> <span class="op">&lt;-</span> <span class="va">videos</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="va">n_rows</span><span class="op">)</span>, <span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="formatting-dates">Formatting Dates<a class="anchor" aria-label="anchor" href="#formatting-dates"></a>
</h2>
<hr class="half-width">
<p>One of the most common issues that new (and experienced!) R users
have is converting date and time information into a variable that is
appropriate and usable during analyses. A best practice for dealing with
date data is to ensure that each component of your date is available as
a separate variable. In our dataset, we have a column
<code>published_at</code> which contains information about the year,
month, and day that the interview was conducted. Let’s convert those
dates into three separate columns.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">videos</span><span class="op">)</span></span></code></pre>
</div>
<p>We are going to use the package
<strong><code>lubridate</code></strong>, , which is included in the
<strong><code>tidyverse</code></strong> installation and should be
loaded by default. However, if we deal with older versions of tidyverse
(2022 and ealier), we can manually load it by typing
<code><a href="https://lubridate.tidyverse.org" class="external-link">library(lubridate)</a></code>.</p>
<p>If necessary, start by loading the required package:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span></span></code></pre>
</div>
<p>The lubridate function <code>ymd()</code> takes a vector representing
year, month, and day, and converts it to a <code>Date</code> vector.
<code>Date</code> is a class of data recognized by R as being a date and
can be manipulated as such. The argument that the function requires is
flexible, but, as a best practice, is a character vector formatted as
“YYYY-MM-DD”.</p>
<p>Let’s extract our <code>published_at</code> column and inspect the
structure:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="va">videos</span><span class="op">$</span><span class="va">published_at</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> POSIXct[1:200], format: "2020-09-14 16:16:44" "2020-09-11 05:34:52" "2020-09-10 11:59:51" ...</code></pre>
</div>
<p>When we imported the data in R, <code>read_csv()</code> recognized
that this column contained date information. We can now use the
<code>day()</code>, <code>month()</code> and <code>year()</code>
functions to extract this information from the date, and create new
columns in our data frame to store it:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu">day</span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span>
<span><span class="va">videos</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="fu">month</span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span>
<span><span class="va">videos</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu">year</span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span>
<span><span class="va">videos</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 32
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA               iPUAl1j… http…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA               YUmIAd_… http…
 3      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 4      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 5      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 6      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 7      145       452 UCaCcVtl9O3h5en4m-_edhZg Celeb LaLa Land    1l5GZ0N… http…
 8      315       276 UCAurTjb6Ewz21vjfTs1wZxw NOSIPHO NZAMA      j4Y022C… http…
 9      190       321 UCBlX1mnsIFZRqsyRNvpW_rA Zandile Mhlambi    gf2YNN6… http…
10      214       762 UClY87IoUANFZtswyC9GeecQ Beauty recipes     AGJmRd4… http…
# ℹ 190 more rows
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;int&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
<p>Notice the three new columns at the end of our data frame.</p>
<p>In our example above, the <code>published_at</code> column was read
in correctly as a <code>Date</code> variable but generally that is not
the case. Date columns are often read in as <code>character</code>
variables and one can use the <code>as_date()</code> function to convert
them to the appropriate <code>Date/POSIXct</code>format.</p>
<p>Let’s say we have a vector of dates in character format:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">char_dates</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"7/31/2012"</span>, <span class="st">"8/9/2014"</span>, <span class="st">"4/30/2016"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">char_dates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "7/31/2012" "8/9/2014" "4/30/2016"</code></pre>
</div>
<p>We can convert this vector to dates as :</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as_date</span><span class="op">(</span><span class="va">char_dates</span>, format <span class="op">=</span> <span class="st">"%m/%d/%Y"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "2012-07-31" "2014-08-09" "2016-04-30"</code></pre>
</div>
<p>Argument <code>format</code> tells the function the order to parse
the characters and identify the month, day and year. The format above is
the equivalent of mm/dd/yyyy. A wrong format can lead to parsing errors
or incorrect results.</p>
<p>For example, observe what happens when we use a lower case y instead
of upper case Y for the year.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as_date</span><span class="op">(</span><span class="va">char_dates</span>, format <span class="op">=</span> <span class="st">"%m/%d/%y"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: 3 failed to parse.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] NA NA NA</code></pre>
</div>
<p>Here, the <code>%y</code> part of the format stands for a two-digit
year instead of a four-digit year, and this leads to parsing errors.</p>
<p>Or in the following example, observe what happens when the month and
day elements of the format are switched.</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as_date</span><span class="op">(</span><span class="va">char_dates</span>, format <span class="op">=</span> <span class="st">"%d/%m/%y"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: 3 failed to parse.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] NA NA NA</code></pre>
</div>
<p>Since there is no month numbered 30 or 31, the first and third dates
cannot be parsed.</p>
<p>We can also use functions <code>ymd()</code>, <code>mdy()</code> or
<code>dmy()</code> to convert character variables to date.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mdy</span><span class="op">(</span><span class="va">char_dates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "2012-07-31" "2014-08-09" "2016-04-30"</code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use read_csv to read tabular data in R.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03-dplyr"><p>Content from <a href="03-dplyr.html">Data Wrangling with dplyr</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/03-dplyr.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I select specific rows and/or columns from a dataframe?</li>
<li>How can I combine multiple commands into a single command?</li>
<li>How can I create new columns or remove existing columns from a
dataframe?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe the purpose of an R package and the
<strong><code>dplyr</code></strong> package.</li>
<li>Select certain columns in a dataframe with the
<strong><code>dplyr</code></strong> function <code>select</code>.</li>
<li>Select certain rows in a dataframe according to filtering conditions
with the <strong><code>dplyr</code></strong> function
<code>filter</code>.</li>
<li>Link the output of one <strong><code>dplyr</code></strong> function
to the input of another function with the ‘pipe’ operator
<code>%&gt;%</code>.</li>
<li>Add new columns to a dataframe that are functions of existing
columns with <code>mutate</code>.</li>
<li>Use the split-apply-combine concept for data analysis.</li>
<li>Use <code>summarize</code>, <code>group_by</code>, and
<code>count</code> to split a dataframe into groups of observations,
apply a summary statistics for each group, and then combine the
results.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p><strong><code>dplyr</code></strong> is a package for making tabular
data wrangling easier by using a limited set of functions that can be
combined to extract and summarize insights from your data.</p>
<p>Like <strong><code>readr</code></strong>,
<strong><code>dplyr</code></strong> is a part of the tidyverse. These
packages were loaded in R’s memory when we called
<code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code> earlier.</p>
<div id="note" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note" class="callout-inner">
<h3 class="callout-title">Note</h3>
<div class="callout-content">
<p>The packages in the tidyverse, namely
<strong><code>dplyr</code></strong>, <strong><code>tidyr</code></strong>
and <strong><code>ggplot2</code></strong> accept both the British
(e.g. <em>summarise</em>) and American (e.g. <em>summarize</em>)
spelling variants of different function and option names. For this
lesson, we utilize the American spellings of different functions;
however, feel free to use the regional variant for where you are
teaching.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-an-r-package">What is an R package?<a class="anchor" aria-label="anchor" href="#what-is-an-r-package"></a>
</h2>
<hr class="half-width">
<p>The package <strong><code>dplyr</code></strong> provides easy tools
for the most common data wrangling tasks. It is built to work directly
with dataframes, with many common tasks optimized by being written in a
compiled language (C++) (not all R packages are written in R!).</p>
<p>There are also packages available for a wide range of tasks including
building plots (<strong><code>ggplot2</code></strong>, which we’ll see
later), downloading data from the NCBI database, or performing
statistical analysis on your data set. Many packages such as these are
housed on, and downloadable from, the <strong>C</strong>omprehensive
<strong>R</strong> <strong>A</strong>rchive <strong>N</strong>etwork
(CRAN) using <code>install.packages</code>. This function makes the
package accessible by your R installation with the command
<code>library()</code>, as you did with <code>tidyverse</code>
earlier.</p>
<p>To easily access the documentation for a package within R or RStudio,
use <code><a href="https://rdrr.io/pkg/package_name/man" class="external-link">help(package = "package_name")</a></code>.</p>
<p>To learn more about <strong><code>dplyr</code></strong> after the
workshop, you may want to check out this <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf" class="external-link">handy
data transformation with <strong><code>dplyr</code></strong>
cheatsheet</a>.</p>
<div id="note-1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note-1" class="callout-inner">
<h3 class="callout-title">Note</h3>
<div class="callout-content">
<p>There are alternatives to the <code>tidyverse</code> packages for
data wrangling, including the package <a href="https://rdatatable.gitlab.io/data.table/" class="external-link"><code>data.table</code></a>.
See this <a href="https://mgimond.github.io/rug_2019_12/Index.html" class="external-link">comparison</a>
for example to get a sense of the differences between using
<code>base</code>, <code>tidyverse</code>, and
<code>data.table</code>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="learning-dplyr">Learning <strong><code>dplyr</code></strong>
<a class="anchor" aria-label="anchor" href="#learning-dplyr"></a>
</h2>
<hr class="half-width">
<p>To make sure everyone will use the same dataset for this lesson,
we’ll read again the SAFI dataset that we downloaded earlier.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">here</span><span class="op">)</span></span>
<span></span>
<span><span class="va">videos</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"youtube-27082024-open-refine-200-na.csv"</span><span class="op">)</span>, </span>
<span>  na <span class="op">=</span> <span class="st">"na"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect the data</span></span>
<span><span class="va">videos</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 32
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA               iPUAl1j… http…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA               YUmIAd_… http…
 3      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 4      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 5      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 6      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 7      145       452 UCaCcVtl9O3h5en4m-_edhZg Celeb LaLa Land    1l5GZ0N… http…
 8      315       276 UCAurTjb6Ewz21vjfTs1wZxw NOSIPHO NZAMA      j4Y022C… http…
 9      190       321 UCBlX1mnsIFZRqsyRNvpW_rA Zandile Mhlambi    gf2YNN6… http…
10      214       762 UClY87IoUANFZtswyC9GeecQ Beauty recipes     AGJmRd4… http…
# ℹ 190 more rows
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## preview the data</span></span>
<span><span class="co"># view(videos)</span></span></code></pre>
</div>
<p>We’re going to learn some of the most common
<strong><code>dplyr</code></strong> functions:</p>
<ul>
<li>
<code>select()</code>: subset columns</li>
<li>
<code>filter()</code>: subset rows on conditions</li>
<li>
<code>mutate()</code>: create new columns by using information from
other columns</li>
<li>
<code>group_by()</code> and <code>summarize()</code>: create summary
statistics on grouped data</li>
<li>
<code>arrange()</code>: sort results</li>
<li>
<code>count()</code>: count discrete values</li>
</ul></section><section><h2 class="section-heading" id="selecting-columns-and-filtering-rows">Selecting columns and filtering rows<a class="anchor" aria-label="anchor" href="#selecting-columns-and-filtering-rows"></a>
</h2>
<hr class="half-width">
<p>To select columns of a dataframe, use <code>select()</code>. The
first argument to this function is the dataframe (<code>videos</code>),
and the subsequent arguments are the columns to keep, separated by
commas. Alternatively, if you are selecting columns adjacent to each
other, you can use a <code>:</code> to select a range of columns, read
as “select columns from ___ to ___.” You may have done something similar
in the past using subsetting. <code>select()</code> is essentially doing
the same thing as subsetting, using a package (<code>dplyr</code>)
instead of R’s base functions.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to select columns throughout the dataframe</span></span>
<span><span class="fu">select</span><span class="op">(</span><span class="va">videos</span>, <span class="va">channel_title</span>, <span class="va">view_count</span>, <span class="op">)</span></span>
<span><span class="co"># to do the same thing with subsetting</span></span>
<span><span class="va">videos</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="st">"channel_title"</span>,<span class="st">"view_count"</span>,<span class="st">"comment_count"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># to select a series of connected columns</span></span>
<span><span class="fu">select</span><span class="op">(</span><span class="va">videos</span>,<span class="st">"view_count"</span><span class="op">:</span><span class="st">"comment_count"</span><span class="op">)</span></span>
<span><span class="co"># to select columns by name as well as a series of connected columns</span></span>
<span><span class="fu">select</span><span class="op">(</span><span class="va">videos</span>,<span class="st">"channel_title"</span>,<span class="st">"published_at_sql"</span>,<span class="st">"view_count"</span><span class="op">:</span><span class="st">"comment_count"</span><span class="op">)</span></span></code></pre>
</div>
<p>To choose rows based on specific criteria, we can use the
<code>filter()</code> function. The argument after the dataframe is the
condition we want our final dataframe to adhere to (e.g. channel_title
name is SABC News):</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filters observations where channel title is "SABC News"</span></span>
<span><span class="fu">filter</span><span class="op">(</span><span class="va">videos</span>, <span class="va">channel_title</span> <span class="op">==</span> <span class="st">"SABC News"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 22 × 32
   position randomise channel_id               channel_title video_id    url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;
 1       30       785 UC8yH-uI81UUtEMDsowQyx1g SABC News     PNom9RIla7o https:…
 2       63       418 UC8yH-uI81UUtEMDsowQyx1g SABC News     EZDazXhf-Pk https:…
 3       65       486 UC8yH-uI81UUtEMDsowQyx1g SABC News     9ewtc8eUY7k https:…
 4        9       380 UC8yH-uI81UUtEMDsowQyx1g SABC News     naLVyfMrFGs https:…
 5       14       500 UC8yH-uI81UUtEMDsowQyx1g SABC News     pO8dkGtjxQc https:…
 6       17       647 UC8yH-uI81UUtEMDsowQyx1g SABC News     rRg8J3lqaPc https:…
 7       36       663 UC8yH-uI81UUtEMDsowQyx1g SABC News     TLAxmusluVw https:…
 8       66       541 UC8yH-uI81UUtEMDsowQyx1g SABC News     P82g09FOSQ0 https:…
 9       72       810 UC8yH-uI81UUtEMDsowQyx1g SABC News     N2d1eBI5Zjc https:…
10      132       404 UC8yH-uI81UUtEMDsowQyx1g SABC News     JXz_3WWo3ew https:…
# ℹ 12 more rows
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
<p>We can also specify multiple conditions within the
<code>filter()</code> function. We can combine conditions using either
“and” or “or” statements. In an “and” statement, an observation (row)
must meet <strong>every</strong> criteria to be included in the
resulting dataframe. To form “and” statements within dplyr, we can pass
our desired conditions as arguments in the <code>filter()</code>
function, separated by commas:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filters observations with "and" operator (comma)</span></span>
<span><span class="co"># output dataframe satisfies ALL specified conditions</span></span>
<span><span class="fu">filter</span><span class="op">(</span><span class="va">videos</span>, <span class="va">channel_title</span> <span class="op">==</span> <span class="st">"SABC News"</span>,</span>
<span>                   <span class="va">view_count</span> <span class="op">&gt;</span> <span class="fl">1000</span>,</span>
<span>                   <span class="va">comment_count</span> <span class="op">&gt;</span> <span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 16 × 32
   position randomise channel_id               channel_title video_id    url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;
 1       30       785 UC8yH-uI81UUtEMDsowQyx1g SABC News     PNom9RIla7o https:…
 2       65       486 UC8yH-uI81UUtEMDsowQyx1g SABC News     9ewtc8eUY7k https:…
 3        9       380 UC8yH-uI81UUtEMDsowQyx1g SABC News     naLVyfMrFGs https:…
 4       36       663 UC8yH-uI81UUtEMDsowQyx1g SABC News     TLAxmusluVw https:…
 5       66       541 UC8yH-uI81UUtEMDsowQyx1g SABC News     P82g09FOSQ0 https:…
 6       72       810 UC8yH-uI81UUtEMDsowQyx1g SABC News     N2d1eBI5Zjc https:…
 7       11       209 UC8yH-uI81UUtEMDsowQyx1g SABC News     752qt6_0J0k https:…
 8        5       636 UC8yH-uI81UUtEMDsowQyx1g SABC News     AqQ-ukdgnWc https:…
 9       23       628 UC8yH-uI81UUtEMDsowQyx1g SABC News     CAwHz26tboE https:…
10       34       569 UC8yH-uI81UUtEMDsowQyx1g SABC News     I5Qra7UUnJs https:…
11       62       461 UC8yH-uI81UUtEMDsowQyx1g SABC News     mTfSl9KnNPo https:…
12       73       659 UC8yH-uI81UUtEMDsowQyx1g SABC News     _aH8qJLdKtI https:…
13       18       597 UC8yH-uI81UUtEMDsowQyx1g SABC News     B2SsMOgP8sQ https:…
14       22       769 UC8yH-uI81UUtEMDsowQyx1g SABC News     dGDBWhcPTuI https:…
15       67        33 UC8yH-uI81UUtEMDsowQyx1g SABC News     fs_xxqx70mA https:…
16       85       574 UC8yH-uI81UUtEMDsowQyx1g SABC News     FIgI7GIcsuc https:…
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, location_description &lt;chr&gt;,
#   view_count &lt;dbl&gt;, like_count &lt;dbl&gt;, favorite_count &lt;dbl&gt;, …</code></pre>
</div>
<p>We can also form “and” statements with the <code>&amp;</code>
operator instead of commas:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filters observations with "&amp;" logical operator</span></span>
<span><span class="co"># output dataframe satisfies ALL specified conditions</span></span>
<span><span class="fu">filter</span><span class="op">(</span><span class="va">videos</span>, <span class="va">channel_title</span> <span class="op">==</span> <span class="st">"SABC News"</span> <span class="op">&amp;</span></span>
<span>                   <span class="va">view_count</span> <span class="op">&gt;</span> <span class="fl">1000</span> <span class="op">&amp;</span></span>
<span>                   <span class="va">comment_count</span> <span class="op">&gt;</span> <span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 16 × 32
   position randomise channel_id               channel_title video_id    url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;
 1       30       785 UC8yH-uI81UUtEMDsowQyx1g SABC News     PNom9RIla7o https:…
 2       65       486 UC8yH-uI81UUtEMDsowQyx1g SABC News     9ewtc8eUY7k https:…
 3        9       380 UC8yH-uI81UUtEMDsowQyx1g SABC News     naLVyfMrFGs https:…
 4       36       663 UC8yH-uI81UUtEMDsowQyx1g SABC News     TLAxmusluVw https:…
 5       66       541 UC8yH-uI81UUtEMDsowQyx1g SABC News     P82g09FOSQ0 https:…
 6       72       810 UC8yH-uI81UUtEMDsowQyx1g SABC News     N2d1eBI5Zjc https:…
 7       11       209 UC8yH-uI81UUtEMDsowQyx1g SABC News     752qt6_0J0k https:…
 8        5       636 UC8yH-uI81UUtEMDsowQyx1g SABC News     AqQ-ukdgnWc https:…
 9       23       628 UC8yH-uI81UUtEMDsowQyx1g SABC News     CAwHz26tboE https:…
10       34       569 UC8yH-uI81UUtEMDsowQyx1g SABC News     I5Qra7UUnJs https:…
11       62       461 UC8yH-uI81UUtEMDsowQyx1g SABC News     mTfSl9KnNPo https:…
12       73       659 UC8yH-uI81UUtEMDsowQyx1g SABC News     _aH8qJLdKtI https:…
13       18       597 UC8yH-uI81UUtEMDsowQyx1g SABC News     B2SsMOgP8sQ https:…
14       22       769 UC8yH-uI81UUtEMDsowQyx1g SABC News     dGDBWhcPTuI https:…
15       67        33 UC8yH-uI81UUtEMDsowQyx1g SABC News     fs_xxqx70mA https:…
16       85       574 UC8yH-uI81UUtEMDsowQyx1g SABC News     FIgI7GIcsuc https:…
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, location_description &lt;chr&gt;,
#   view_count &lt;dbl&gt;, like_count &lt;dbl&gt;, favorite_count &lt;dbl&gt;, …</code></pre>
</div>
<p>In an “or” statement, observations must meet <em>at least one</em> of
the specified conditions. To form “or” statements we use the logical
operator for “or,” which is the vertical bar (|):</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filters observations with "|" logical operator</span></span>
<span><span class="co"># output dataframe satisfies AT LEAST ONE of the specified conditions</span></span>
<span><span class="fu">filter</span><span class="op">(</span><span class="va">videos</span>, <span class="va">channel_title</span> <span class="op">==</span> <span class="st">"SABC News"</span> <span class="op">|</span> <span class="va">channel_title</span> <span class="op">==</span> <span class="st">"eNCA"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 42 × 32
   position randomise channel_id               channel_title video_id    url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA          iPUAl1jywdU https:…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA          YUmIAd_O0U4 https:…
 3       30       785 UC8yH-uI81UUtEMDsowQyx1g SABC News     PNom9RIla7o https:…
 4       63       418 UC8yH-uI81UUtEMDsowQyx1g SABC News     EZDazXhf-Pk https:…
 5       65       486 UC8yH-uI81UUtEMDsowQyx1g SABC News     9ewtc8eUY7k https:…
 6        2       944 UCI3RT5PGmdi1KVp9FG_CneA eNCA          li3_91gCQHc https:…
 7        3       269 UCI3RT5PGmdi1KVp9FG_CneA eNCA          kvQRfnD1h64 https:…
 8        4       518 UCI3RT5PGmdi1KVp9FG_CneA eNCA          3BkmO0M56lA https:…
 9        7       417 UCI3RT5PGmdi1KVp9FG_CneA eNCA          hZBwMrCCp4A https:…
10        9       380 UC8yH-uI81UUtEMDsowQyx1g SABC News     naLVyfMrFGs https:…
# ℹ 32 more rows
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
</section><section><h2 class="section-heading" id="pipes">Pipes<a class="anchor" aria-label="anchor" href="#pipes"></a>
</h2>
<hr class="half-width">
<p>What if you want to select and filter at the same time? There are
three ways to do this: use intermediate steps, nested functions, or
pipes.</p>
<p>With intermediate steps, you create a temporary dataframe and use
that as input to the next function, like this:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos2</span> <span class="op">&lt;-</span> <span class="fu">filter</span><span class="op">(</span><span class="va">videos</span>, <span class="va">channel_title</span> <span class="op">==</span> <span class="st">"SABC News"</span><span class="op">)</span></span>
<span><span class="va">videos_SABC_metrics</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">videos2</span>, <span class="va">channel_title</span>,<span class="va">view_count</span><span class="op">:</span><span class="va">comment_count</span><span class="op">)</span></span></code></pre>
</div>
<p>This is readable, but can clutter up your workspace with lots of
objects that you have to name individually. With multiple steps, that
can be hard to keep track of.</p>
<p>You can also nest functions (i.e. one function inside of another),
like this:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_SABC_metrics</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="fu">filter</span><span class="op">(</span><span class="va">videos</span>, <span class="va">channel_title</span> <span class="op">==</span> <span class="st">"SABC News"</span><span class="op">)</span>,</span>
<span>                         <span class="va">channel_title</span>,<span class="va">view_count</span><span class="op">:</span><span class="va">comment_count</span><span class="op">)</span></span>
<span><span class="va">videos_SABC_metrics</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 22 × 5
   channel_title view_count like_count favorite_count comment_count
   &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;
 1 SABC News          22079        125              0           105
 2 SABC News           3339         18              0             7
 3 SABC News          20674        122              0           100
 4 SABC News          19715         68              0           132
 5 SABC News          14485         52              0            19
 6 SABC News           2329         18              0             7
 7 SABC News          25313        133              0           131
 8 SABC News          11466         55              0            28
 9 SABC News           7297         74              0            34
10 SABC News           3147         12              0             2
# ℹ 12 more rows</code></pre>
</div>
<p>This is handy, but can be difficult to read if too many functions are
nested, as R evaluates the expression from the inside out (in this case,
filtering, then selecting).</p>
<p>The last option, <em>pipes</em>, are a recent addition to R. Pipes
let you take the output of one function and send it directly to the
next, which is useful when you need to do many things to the same
dataset. There are two Pipes in R: 1) <code>%&gt;%</code> (called
magrittr pipe; made available via the
<strong><code>magrittr</code></strong> package, installed automatically
with <strong><code>dplyr</code></strong>) or 2) <code>|&gt;</code>
(called native R pipe and it comes preinstalled with R v4.1.0 onwards).
Both the pipes are, by and large, function similarly with a few
differences (For more information, check: <a href="https://www.tidyverse.org/blog/2023/04/base-vs-magrittr-pipe/" class="external-link uri">https://www.tidyverse.org/blog/2023/04/base-vs-magrittr-pipe/</a>).
The choice of which pipe to be used can be changed in the Global
settings in R studio and once that is done, you can type the pipe
with:</p>
<ul>
<li>
<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>M</kbd> if you have a PC
or <kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>M</kbd> if you have a
Mac.</li>
</ul>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the following example is run using magrittr pipe but the output will be same with the native pipe</span></span>
<span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">channel_title</span> <span class="op">==</span> <span class="st">"SABC News"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">channel_title</span>,<span class="va">view_count</span><span class="op">:</span><span class="va">comment_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 22 × 5
   channel_title view_count like_count favorite_count comment_count
   &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;
 1 SABC News          22079        125              0           105
 2 SABC News           3339         18              0             7
 3 SABC News          20674        122              0           100
 4 SABC News          19715         68              0           132
 5 SABC News          14485         52              0            19
 6 SABC News           2329         18              0             7
 7 SABC News          25313        133              0           131
 8 SABC News          11466         55              0            28
 9 SABC News           7297         74              0            34
10 SABC News           3147         12              0             2
# ℹ 12 more rows</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#videos |&gt;</span></span>
<span><span class="co">#   filter(channel_title == "SABC News") |&gt;</span></span>
<span><span class="co">#   select(channel_title,view_count:comment_count)</span></span></code></pre>
</div>
<p>In the above code, we use the pipe to send the <code>videos</code>
dataset first through <code>filter()</code> to keep rows where
<code>channel_title</code> is “SABC News”, then through
<code>select()</code> to keep only the columns from
<code>channel_title</code> to <code>respondent_wall_type</code>. Since
<code>%&gt;%</code> takes the object on its left and passes it as the
first argument to the function on its right, we don’t need to explicitly
include the dataframe as an argument to the <code>filter()</code> and
<code>select()</code> functions any more.</p>
<p>Some may find it helpful to read the pipe like the word “then”. For
instance, in the above example, we take the dataframe
<code>videos</code>, <em>then</em> we <code>filter</code> for rows with
<code>channel_title == "SABC News"</code>, <em>then</em> we
<code>select</code> columns <code>view_count:comment_count</code>. The
<strong><code>dplyr</code></strong> functions by themselves are somewhat
simple, but by combining them into linear workflows with the pipe, we
can accomplish more complex data wrangling operations.</p>
<p>If we want to create a new object with this smaller version of the
data, we can assign it a new name:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_SABC_metrics</span> <span class="op">&lt;-</span> <span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">channel_title</span> <span class="op">==</span> <span class="st">"SABC News"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">view_count</span><span class="op">:</span><span class="va">comment_count</span><span class="op">)</span></span>
<span></span>
<span><span class="va">videos_SABC_metrics</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 22 × 4
   view_count like_count favorite_count comment_count
        &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;
 1      22079        125              0           105
 2       3339         18              0             7
 3      20674        122              0           100
 4      19715         68              0           132
 5      14485         52              0            19
 6       2329         18              0             7
 7      25313        133              0           131
 8      11466         55              0            28
 9       7297         74              0            34
10       3147         12              0             2
# ℹ 12 more rows</code></pre>
</div>
<p>Note that the final dataframe (<code>videos_SABC_metrics</code>) is
the leftmost part of this expression.</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Using pipes, subset the <code>videos</code> data to include videos
where the video is categorised as “News &amp; Politics” and retain only
the metrics columns with values (views, likes and comments).</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">video_category_label</span> <span class="op">==</span> <span class="st">"News &amp; Politics"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">view_count</span>,<span class="va">like_count</span>,<span class="va">comment_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 85 × 3
   view_count like_count comment_count
        &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
 1        939         12            NA
 2        910          7            NA
 3        213          6             2
 4      22079        125           105
 5       3339         18             7
 6      20674        122           100
 7       6745         10            NA
 8       6087         47             0
 9      11359         84             0
10      34911        299            NA
# ℹ 75 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="mutate">Mutate<a class="anchor" aria-label="anchor" href="#mutate"></a>
</h2>
<hr class="half-width">
<p>Frequently you’ll want to create new columns based on the values in
existing columns, for example to do unit conversions, or to find the
ratio of values in two columns. For this we’ll use
<code>mutate()</code>.</p>
<p>We might be interested in the ratio of likes to comments:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>ratio <span class="op">=</span> <span class="va">like_count</span> <span class="op">/</span> <span class="va">comment_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 33
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA               iPUAl1j… http…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA               YUmIAd_… http…
 3      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 4      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 5      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 6      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 7      145       452 UCaCcVtl9O3h5en4m-_edhZg Celeb LaLa Land    1l5GZ0N… http…
 8      315       276 UCAurTjb6Ewz21vjfTs1wZxw NOSIPHO NZAMA      j4Y022C… http…
 9      190       321 UCBlX1mnsIFZRqsyRNvpW_rA Zandile Mhlambi    gf2YNN6… http…
10      214       762 UClY87IoUANFZtswyC9GeecQ Beauty recipes     AGJmRd4… http…
# ℹ 190 more rows
# ℹ 27 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
<p>We may be interested in investigating whether mentioning the EFF in
the video title had any effect on the ratio of likes to comments.</p>
<p>To look at this relationship, we will first remove data from our
dataset where comments were not recorded. These cases are recorded as
“NA” in the dataset.</p>
<p>To remove these cases, we could insert a <code>filter()</code> in the
chain:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>ratio <span class="op">=</span> <span class="va">like_count</span> <span class="op">/</span> <span class="va">comment_count</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 184 × 33
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 2      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 3      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 4      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 5      145       452 UCaCcVtl9O3h5en4m-_edhZg Celeb LaLa Land    1l5GZ0N… http…
 6      315       276 UCAurTjb6Ewz21vjfTs1wZxw NOSIPHO NZAMA      j4Y022C… http…
 7      190       321 UCBlX1mnsIFZRqsyRNvpW_rA Zandile Mhlambi    gf2YNN6… http…
 8      214       762 UClY87IoUANFZtswyC9GeecQ Beauty recipes     AGJmRd4… http…
 9      263       952 UCYeHXDmIJDiF1DVQM0qfNWQ Mama Shirat        19uG9pR… http…
10       30       785 UC8yH-uI81UUtEMDsowQyx1g SABC News          PNom9RI… http…
# ℹ 174 more rows
# ℹ 27 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
<p>The <code>!</code> symbol negates the result of the
<code>is.na()</code> function. Thus, if <code>is.na()</code> returns a
value of <code>TRUE</code> (because the <code>comment_count</code> is
missing), the <code>!</code> symbol negates this and says we only want
values of <code>FALSE</code>, where `comment_count <strong>is
not</strong> missing.</p>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Create a new dataframe from the <code>videos</code> data that meets
the following criteria: contains only the <code>channel_title</code>
column and, for all the videos which received at least one comment, a
new column called <code>ratio</code> containing a value that is equal to
the likes divided by the comments. Only the rows where
<code>ratio</code> is greater than 20 should be shown in the final
dataframe.</p>
<p><strong>Hint</strong>: think about how the commands should be ordered
to produce this data frame!</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_ratio</span> <span class="op">&lt;-</span> <span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">comment_count</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>ratio <span class="op">=</span>  <span class="va">view_count</span><span class="op">/</span><span class="va">comment_count</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">ratio</span> <span class="op">&gt;</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">channel_title</span>, <span class="va">ratio</span><span class="op">)</span></span>
<span><span class="va">videos_ratio</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 120 × 2
   channel_title   ratio
   &lt;chr&gt;           &lt;dbl&gt;
 1 The Tea World    143.
 2 Celeb LaLa Land  260.
 3 Zandile Mhlambi  106.
 4 Beauty recipes  3707.
 5 Mama Shirat      650.
 6 SABC News        210.
 7 SABC News        477
 8 SABC News        207.
 9 SABC News        149.
10 SABC News        762.
# ℹ 110 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="split-apply-combine-data-analysis-and-the-summarize-function">Split-apply-combine data analysis and the summarize() function<a class="anchor" aria-label="anchor" href="#split-apply-combine-data-analysis-and-the-summarize-function"></a>
</h2>
<hr class="half-width">
<p>Many data analysis tasks can be approached using the
<em>split-apply-combine</em> paradigm: split the data into groups, apply
some analysis to each group, and then combine the results.
<strong><code>dplyr</code></strong> makes this very easy through the use
of the <code>group_by()</code> function.</p>
<div class="section level3">
<h3 id="the-summarize-function">The <code>summarize()</code> function<a class="anchor" aria-label="anchor" href="#the-summarize-function"></a>
</h3>
<p><code>group_by()</code> is often used together with
<code>summarize()</code>, which collapses each group into a single-row
summary of that group. <code>group_by()</code> takes as arguments the
column names that contain the <strong>categorical</strong> variables for
which you want to calculate the summary statistics. So to compute the
average household size by channel_title:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 119 × 2
   channel_title                 mean_views
   &lt;chr&gt;                              &lt;dbl&gt;
 1 2nacheki                         54470.
 2 Absolute Controversy               102
 3 African Diaspora News Channel    18255
 4 Al Jazeera English              113704
 5 Ayanda Mafuyeka                     29.5
 6 Azana Jezile                     65647
 7 BANELE NOCUZE                      210
 8 Banetsi Tshetlo                      7
 9 Beauty recipes                  263208
10 Blackish Blue TV                   281
# ℹ 109 more rows</code></pre>
</div>
<p>You may also have noticed that the output from these calls doesn’t
run off the screen anymore. It’s one of the advantages of
<code>tbl_df</code> over dataframe.</p>
<p>You can also group by multiple columns:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span>, <span class="va">video_category_label</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'channel_title'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 120 × 3
# Groups:   channel_title [119]
   channel_title                 video_category_label mean_views
   &lt;chr&gt;                         &lt;chr&gt;                     &lt;dbl&gt;
 1 2nacheki                      News &amp; Politics         54470.
 2 Absolute Controversy          People &amp; Blogs            102
 3 African Diaspora News Channel News &amp; Politics         18255
 4 Al Jazeera English            News &amp; Politics        113704
 5 Ayanda Mafuyeka               People &amp; Blogs             29.5
 6 Azana Jezile                  Howto &amp; Style           65647
 7 BANELE NOCUZE                 People &amp; Blogs            210
 8 Banetsi Tshetlo               Entertainment               7
 9 Beauty recipes                Howto &amp; Style          263208
10 Blackish Blue TV              News &amp; Politics           281
# ℹ 110 more rows</code></pre>
</div>
<p>Note that the output is a grouped tibble. To obtain an ungrouped
tibble, use the <code>ungroup</code> function:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span>, <span class="va">video_category_label</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'channel_title'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 120 × 3
   channel_title                 video_category_label mean_views
   &lt;chr&gt;                         &lt;chr&gt;                     &lt;dbl&gt;
 1 2nacheki                      News &amp; Politics         54470.
 2 Absolute Controversy          People &amp; Blogs            102
 3 African Diaspora News Channel News &amp; Politics         18255
 4 Al Jazeera English            News &amp; Politics        113704
 5 Ayanda Mafuyeka               People &amp; Blogs             29.5
 6 Azana Jezile                  Howto &amp; Style           65647
 7 BANELE NOCUZE                 People &amp; Blogs            210
 8 Banetsi Tshetlo               Entertainment               7
 9 Beauty recipes                Howto &amp; Style          263208
10 Blackish Blue TV              News &amp; Politics           281
# ℹ 110 more rows</code></pre>
</div>
<p>When grouping both by <code>channel_title</code> and
<code>default_l_audio_language</code>, we see rows in our table for
videos where the creator did not specify their default audio language.
We can exclude those data from our table using a filter step.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">default_l_audio_language</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span>, <span class="va">default_l_audio_language</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'channel_title'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 59 × 3
# Groups:   channel_title [59]
   channel_title                               default_l_audio_lang…¹ mean_views
   &lt;chr&gt;                                       &lt;chr&gt;                       &lt;dbl&gt;
 1 2nacheki                                    en-US                      54470.
 2 African Diaspora News Channel               en                         18255
 3 Azana Jezile                                en-US                      65647
 4 Beauty recipes                              en                        263208
 5 Buhle N                                     en-GB                        405
 6 By.MonaLisa                                 zxx                         3802
 7 DoRo Lungani                                zu                         19648
 8 Duke University - The Fuqua School of Busi… en                          4932
 9 E News Mzansi                               en                          2876.
10 Economic Freedom Fighters                   en-US                       7164
# ℹ 49 more rows
# ℹ abbreviated name: ¹​default_l_audio_language</code></pre>
</div>
<p>Once the data are grouped, you can also summarize multiple variables
at the same time (and not necessarily on the same variable). For
instance, we could add a column indicating the minimum household size
for each channel_title for each group (members of an irrigation
association vs not):</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">default_l_audio_language</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span>, <span class="va">default_l_audio_language</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span>,</span>
<span>              max_views <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'channel_title'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 59 × 4
# Groups:   channel_title [59]
   channel_title                     default_l_audio_lang…¹ mean_views max_views
   &lt;chr&gt;                             &lt;chr&gt;                       &lt;dbl&gt;     &lt;dbl&gt;
 1 2nacheki                          en-US                      54470.     98894
 2 African Diaspora News Channel     en                         18255      18255
 3 Azana Jezile                      en-US                      65647      65647
 4 Beauty recipes                    en                        263208     263208
 5 Buhle N                           en-GB                        405        405
 6 By.MonaLisa                       zxx                         3802       3802
 7 DoRo Lungani                      zu                         19648      39223
 8 Duke University - The Fuqua Scho… en                          4932       4932
 9 E News Mzansi                     en                          2876.      5066
10 Economic Freedom Fighters         en-US                       7164      10996
# ℹ 49 more rows
# ℹ abbreviated name: ¹​default_l_audio_language</code></pre>
</div>
<p>It is sometimes useful to rearrange the result of a query to inspect
the values. For instance, we can sort on <code>max_views</code> to put
the group with the smallest household first:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">default_l_audio_language</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span>, <span class="va">default_l_audio_language</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span>,</span>
<span>              max_views <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">max_views</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'channel_title'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 59 × 4
# Groups:   channel_title [59]
   channel_title                     default_l_audio_lang…¹ mean_views max_views
   &lt;chr&gt;                             &lt;chr&gt;                       &lt;dbl&gt;     &lt;dbl&gt;
 1 Lit News                          en-GB                          19        19
 2 Peppers Echo                      en                             23        23
 3 GOLDGATOR TV                      en-GB                          30        30
 4 TalkOutLoud                       en-GB                          67        67
 5 Ile Eko Omoluabi                  en                            103       103
 6 Papa Khwatsi TOPIC                en-GB                         105       105
 7 The Upright Man                   en                            113       113
 8 Fresh Trendz                      en                            130       130
 9 Hidden Truth State of Decay Sout… en-GB                         151       151
10 Newcastle Advertiser              en-GB                         172       172
# ℹ 49 more rows
# ℹ abbreviated name: ¹​default_l_audio_language</code></pre>
</div>
<p>To sort in descending order, we need to add the <code>desc()</code>
function. If we want to sort the results by decreasing order of views,
or reverse alphabetical order of the audio language to see languages
other than english:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">default_l_audio_language</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span>, <span class="va">default_l_audio_language</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span>,</span>
<span>              max_views <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">max_views</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'channel_title'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 59 × 4
# Groups:   channel_title [59]
   channel_title   default_l_audio_language mean_views max_views
   &lt;chr&gt;           &lt;chr&gt;                         &lt;dbl&gt;     &lt;dbl&gt;
 1 SABC News       en                           38085.    487961
 2 Beauty recipes  en                          263208     263208
 3 eNCA            en                           46485.    138612
 4 Eyewitness News en-GB                       103949     103949
 5 2nacheki        en-US                        54470.     98894
 6 Morexskinglow   en                           91347      91347
 7 News24          en-GB                        72606.     73622
 8 Azana Jezile    en-US                        65647      65647
 9 Renaldo Gouws   en                           50694      56890
10 Mama Shirat     en-US                        41626      41626
# ℹ 49 more rows</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">default_l_audio_language</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span>, <span class="va">default_l_audio_language</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span>,</span>
<span>              max_views <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">default_l_audio_language</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'channel_title'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 59 × 4
# Groups:   channel_title [59]
   channel_title             default_l_audio_language mean_views max_views
   &lt;chr&gt;                     &lt;chr&gt;                         &lt;dbl&gt;     &lt;dbl&gt;
 1 By.MonaLisa               zxx                           3802       3802
 2 DoRo Lungani              zu                           19648      39223
 3 NOSIPHO NZAMA             zu                             597        597
 4 2nacheki                  en-US                        54470.     98894
 5 Azana Jezile              en-US                        65647      65647
 6 Economic Freedom Fighters en-US                         7164      10996
 7 Gemini Baby               en-US                          435        435
 8 Grey Net                  en-US                         2619       2619
 9 KHATHA WORLDWIDE          en-US                          490        490
10 Mama Shirat               en-US                        41626      41626
# ℹ 49 more rows</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="counting">Counting<a class="anchor" aria-label="anchor" href="#counting"></a>
</h3>
<p>When working with data, we often want to know the number of
observations found for each factor or combination of factors. For this
task, <strong><code>dplyr</code></strong> provides <code>count()</code>.
For example, if we wanted to count the number of rows of data for each
channel_title, we would do:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">channel_title</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 119 × 2
   channel_title                     n
   &lt;chr&gt;                         &lt;int&gt;
 1 2nacheki                          2
 2 Absolute Controversy              1
 3 African Diaspora News Channel     1
 4 Al Jazeera English                1
 5 Ayanda Mafuyeka                   2
 6 Azana Jezile                      1
 7 BANELE NOCUZE                     3
 8 Banetsi Tshetlo                   1
 9 Beauty recipes                    1
10 Blackish Blue TV                  1
# ℹ 109 more rows</code></pre>
</div>
<p>For convenience, <code>count()</code> provides the <code>sort</code>
argument to get results in decreasing order:</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">channel_title</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 119 × 2
   channel_title                 n
   &lt;chr&gt;                     &lt;int&gt;
 1 SABC News                    22
 2 eNCA                         20
 3 Newzroom Afrika              13
 4 Umgosi Entertainment          5
 5 StellenboschNews Com          4
 6 BANELE NOCUZE                 3
 7 Economic Freedom Fighters     3
 8 Renaldo Gouws                 3
 9 Trade with Free Money         3
10 2nacheki                      2
# ℹ 109 more rows</code></pre>
</div>
<div id="exercise-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Which YouTube video categories are used to describe the videos in the
sample? (Use the video_category_label column.) Create a tibble of these
categories and the number of videos in each of them, arranged in
descending order.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">count</span><span class="op">(</span><span class="va">video_category_label</span>, sort<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 2
   video_category_label      n
   &lt;chr&gt;                 &lt;int&gt;
 1 News &amp; Politics          85
 2 People &amp; Blogs           62
 3 Entertainment            23
 4 Howto &amp; Style            14
 5 Comedy                    6
 6 Education                 4
 7 Film &amp; Animation          3
 8 Autos &amp; Vehicles          1
 9 Nonprofits &amp; Activism     1
10 Science &amp; Technology      1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="exercise-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>Use <code>group_by()</code> and <code>summarize()</code> to find the
mean, min, and max number of views for each YouTube channel
(channel_title). Also add the number of observations (hint: see
<code>?n</code>). Arrange the channels in descending order by the
channel’s maximum views.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>      mean_views <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span>,</span>
<span>      min_views <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span>,</span>
<span>      max_views <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">view_count</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>  <span class="op">)</span><span class="op">%&gt;%</span></span>
<span>      <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">max_views</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 119 × 5
   channel_title      mean_views min_views max_views     n
   &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
 1 SABC News              36450.      2329    487961    22
 2 Beauty recipes        263208     263208    263208     1
 3 SamupertyZuluTV       144836     144836    144836     1
 4 eNCA                   36810.       910    138612    20
 5 Al Jazeera English    113704     113704    113704     1
 6 Eyewitness News       103949     103949    103949     1
 7 2nacheki               54470.     10047     98894     2
 8 Morexskinglow          91347      91347     91347     1
 9 Newzroom Afrika         9501.       246     83542    13
10 Kay Monqo              81906      81906     81906     1
# ℹ 109 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="exercise-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>Excluding those videos that were set to not allow comments
(comment_count =NA), what was the total number of comments posted on the
videos in each month?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># if not already included, add month, year, and day columns</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span> <span class="co"># load lubridate if not already loaded</span></span>
<span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">published_at_sql</span><span class="op">)</span>,</span>
<span>           day <span class="op">=</span> <span class="fu">day</span><span class="op">(</span><span class="va">published_at_sql</span><span class="op">)</span>,</span>
<span>           year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">published_at_sql</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>total_comments <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">comment_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">year</span>,<span class="va">month</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 20 × 3
# Groups:   year [4]
    year month total_comments
   &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;
 1  2020     1             33
 2  2020     2              0
 3  2020     4            168
 4  2020     7            466
 5  2020     8             29
 6  2020     9          11215
 7  2020    10              1
 8  2020    11              1
 9  2021     6              0
10  2021     9             17
11  2021    12             64
12  2022     1             14
13  2022     2            386
14  2022     3              4
15  2022     4              8
16  2022     7             76
17  2022    11             71
18  2023     1              7
19  2023     3              6
20  2023     6            241</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the <code>dplyr</code> package to manipulate dataframes.</li>
<li>Use <code>select()</code> to choose variables from a dataframe.</li>
<li>Use <code>filter()</code> to choose data based on values.</li>
<li>Use <code>group_by()</code> and <code>summarize()</code> to work
with subsets of data.</li>
<li>Use <code>mutate()</code> to create new variables.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-04-tidyr"><p>Content from <a href="04-tidyr.html">Data Wrangling with tidyr</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/04-tidyr.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I reformat a data frame to meet my needs?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe the concept of a wide and a long table format and for which
purpose those formats are useful.</li>
<li>Describe the roles of variable names and their associated values
when a table is reshaped.</li>
<li>Reshape a dataframe from long to wide format and back with the
<code>pivot_wider</code> and <code>pivot_longer</code> commands from the
<strong><code>tidyr</code></strong> package.</li>
<li>Export a dataframe to a csv file.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p><strong><code>dplyr</code></strong> pairs nicely with
<strong><code>tidyr</code></strong> which enables you to swiftly convert
between different data formats (long vs. wide) for plotting and
analysis. To learn more about <strong><code>tidyr</code></strong> after
the workshop, you may want to check out this <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf" class="external-link">handy
data tidying with <strong><code>tidyr</code></strong>
cheatsheet</a>.</p>
<p>To make sure everyone will use the same dataset for this lesson,
we’ll read again the SAFI dataset that we downloaded earlier.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">here</span><span class="op">)</span></span>
<span></span>
<span><span class="va">videos</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"youtube-27082024-open-refine-200-na.csv"</span><span class="op">)</span>, </span>
<span>  na <span class="op">=</span> <span class="st">"na"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect the data</span></span>
<span><span class="va">videos</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 32
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA               iPUAl1j… http…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA               YUmIAd_… http…
 3      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 4      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 5      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 6      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 7      145       452 UCaCcVtl9O3h5en4m-_edhZg Celeb LaLa Land    1l5GZ0N… http…
 8      315       276 UCAurTjb6Ewz21vjfTs1wZxw NOSIPHO NZAMA      j4Y022C… http…
 9      190       321 UCBlX1mnsIFZRqsyRNvpW_rA Zandile Mhlambi    gf2YNN6… http…
10      214       762 UClY87IoUANFZtswyC9GeecQ Beauty recipes     AGJmRd4… http…
# ℹ 190 more rows
# ℹ 26 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, topic_categories &lt;chr&gt;,
#   duration_sec &lt;dbl&gt;, definition &lt;chr&gt;, caption &lt;lgl&gt;,
#   default_language &lt;chr&gt;, default_l_audio_language &lt;chr&gt;,
#   thumbnail_maxres &lt;chr&gt;, licensed_content &lt;dbl&gt;, …</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## preview the data</span></span>
<span><span class="co"># view(videos)</span></span></code></pre>
</div>
<section><h2 class="section-heading" id="reshaping-with-pivot_wider-and-pivot_longer">Reshaping with pivot_wider() and pivot_longer()<a class="anchor" aria-label="anchor" href="#reshaping-with-pivot_wider-and-pivot_longer"></a>
</h2>
<hr class="half-width">
<p>There are essentially three rules that define a “tidy” dataset:</p>
<ol style="list-style-type: decimal">
<li>Each variable has its own column</li>
<li>Each observation has its own row</li>
<li>Each value must have its own cell</li>
</ol>
<p>This graphic visually represents the three rules that define a “tidy”
dataset:</p>
<p><img src="fig/tidy-data-wickham.png" class="figure"><em>R for Data Science</em>,
Wickham H and Grolemund G (<a href="https://r4ds.had.co.nz/index.html" class="external-link">https://r4ds.had.co.nz/index.html</a>)
© Wickham, Grolemund 2017 This image is licenced under
Attribution-NonCommercial-NoDerivs 3.0 United States (CC-BY-NC-ND 3.0
US)</p>
<p>In this section we will explore how these rules are linked to the
different data formats researchers are often interested in: “wide” and
“long”. This tutorial will help you efficiently transform your data
shape regardless of original format. First we will explore qualities of
the <code>videos</code> data and how they relate to these different
types of data formats.</p>
<div class="section level3">
<h3 id="long-and-wide-data-formats">Long and wide data formats<a class="anchor" aria-label="anchor" href="#long-and-wide-data-formats"></a>
</h3>
<p>In the <code>videos</code> data, each row contains the values of
variables associated with each record collected (each interview in the
villages). The <code>video_id</code> identifier is a unique identifier
for each YouTube video.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">video_id</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1   200</code></pre>
</div>
<p>As seen in the code below, for each time of publication in each
channel no video_id`s are the same. Thus, this format is what is called
a “long” data format, where each observation occupies only one row in
the dataframe.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">channel_title</span> <span class="op">==</span> <span class="st">"eNCA"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">video_id</span>, <span class="va">channel_title</span>, <span class="va">published_at_sql</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">sample_n</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 3
   video_id    channel_title published_at_sql
   &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;
 1 hZBwMrCCp4A eNCA          2020-09-08 16:49:28
 2 3EtH4eDceFY eNCA          2020-09-10 9:11:44
 3 oYpXigYPY34 eNCA          2020-09-07 13:12:02
 4 RGXqGXPQNVE eNCA          2020-09-07 13:18:00
 5 _Mz-QydrFMs eNCA          2020-09-07 7:17:10
 6 iPUAl1jywdU eNCA          2020-09-14 16:16:44
 7 Ra0hdT2gsxU eNCA          2020-09-07 14:20:04
 8 tVJ1JF-eIoQ eNCA          2021-09-28 13:51:41
 9 qvd3C1ZAAmQ eNCA          2020-09-08 16:57:47
10 EH0RpWcq66w eNCA          2020-09-08 12:50:32</code></pre>
</div>
<p>We notice that the layout or format of the <code>videos</code> data
is in a format that adheres to rules 1-3, where</p>
<ul>
<li>each column is a variable</li>
<li>each row is an observation</li>
<li>each value has its own cell</li>
</ul>
<p>This is called a “long” data format. But, we notice that each column
represents a different variable. In the “longest” data format there
would only be three columns, one for the id variable, one for the
observed variable, and one for the observed value (of that variable).
This data format is quite unsightly and difficult to work with, so you
will rarely see it in use.</p>
<p>Alternatively, in a “wide” data format we see modifications to rule
1, where each column no longer represents a single variable. Instead,
columns can represent different levels/values of a variable. For
instance, in some data you encounter the researchers may have chosen for
every survey date to be a different column.</p>
<p>These may sound like dramatically different data layouts, but there
are some tools that make transitions between these layouts much simpler
than you might think! The gif below shows how these two formats relate
to each other, and gives you an idea of how we can use R to shift from
one format to the other.</p>
<p><img src="fig/tidyr-pivot_wider_longer.gif" class="figure"> Long and wide
dataframe layouts mainly affect readability. You may find that visually
you may prefer the “wide” format, since you can see more of the data on
the screen. However, all of the R functions we have used thus far expect
for your data to be in a “long” data format. This is because the long
format is more machine readable and is closer to the formatting of
databases.</p>
</div>
<div class="section level3">
<h3 id="questions-which-warrant-different-data-formats">Questions which warrant different data formats<a class="anchor" aria-label="anchor" href="#questions-which-warrant-different-data-formats"></a>
</h3>
<p>In our dataset of YouTube videos, each row contains the values of
variables associated with each record (the unit), values such as the
title of the channel which posted the video, the number of views, or the
title and description for the video. This format allows for us to make
comparisons across individual videos, but what if we wanted to look at
differences in videos grouped by different topics or tags associated
with the video?</p>
<p>To facilitate this comparison we would need to create a new table
where each row (the unit) was comprised of values of variables
associated with topics or tags (i.e., the columns
<code>topic_categories</code> or <code>tags</code> in the dataset). In
practical terms this means the values of the topics in
<code>topic_categories</code> (e.g. politics, health, business, society,
etc.) would become the names of column variables and the cells would
contain values of <code>TRUE</code> or <code>FALSE</code>, for whether
the video fitted into that category or not.</p>
<p>Once we we’ve created this new table, we can explore the relationship
within and between videos. The key point here is that we are still
following a tidy data structure, but we have <strong>reshaped</strong>
the data according to the observations of interest.</p>
<p>Alternatively, consider what we would do if the interview dates were
spread across multiple columns, and we were interested in visualizing
how the controversy changed over time.</p>
<p>This would require for the interview date to be included in a single
column rather than spread across multiple columns. Thus, we would need
to transform the column names into values of a single variable.</p>
<p>We can do both of these transformations with two <code>tidyr</code>
functions, <code>pivot_wider()</code> and
<code>pivot_longer()</code>.</p>
</div>
</section><section><h2 class="section-heading" id="pivoting-wider">Pivoting wider<a class="anchor" aria-label="anchor" href="#pivoting-wider"></a>
</h2>
<hr class="half-width">
<p><code>pivot_wider()</code> takes three principal arguments:</p>
<ol style="list-style-type: decimal">
<li>the data</li>
<li>the <em>names_from</em> column variable whose values will become new
column names.</li>
<li>the <em>values_from</em> column variable whose values will fill the
new column variables.</li>
</ol>
<p>Further arguments include <code>values_fill</code> which, if set,
fills in missing values with the value provided.</p>
<p>Let’s use <code>pivot_wider()</code> to transform videos to create
new columns for each topic category allocated to a video. There are a
couple of new concepts in this transformation, so let’s walk through it
line by line. First we create a new object (<code>videos_topics</code>)
based on the <code>videos</code> data frame.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>videos_topics <span class="ot">&lt;-</span> videos <span class="sc">%&gt;%</span></span></code></pre>
</div>
<p>Then we will actually need to make our data frame longer, because we
have multiple items in a single cell. We will use a new function,
<code>separate_longer_delim()</code>, from the
<strong><code>tidyr</code></strong> package to separate the values of
<code>topic_categories</code> based on the presence of semi-colons
(<code>;</code>). The values of this variable were multiple items
separated by semi-colons, so this action creates a row for each item
listed in a household’s possession. Thus, we end up with a long format
version of the dataset, with multiple rows for each respondent. For
example, if a respondent has a television and a solar panel, that
respondent will now have two rows, one with “television” and the other
with “solar panel” in the <code>topic_categories</code> column.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">separate_longer_delim</span>(topic_categories, <span class="at">delim =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span></code></pre>
</div>
<p>After this transformation, you may notice that the
<code>topic_categories</code> column contains <code>NA</code> values.
This is because some of the respondents did not own any of the items
that was in the interviewer’s list. We can use the
<code>replace_na()</code> function to change these <code>NA</code>
values to something more meaningful. The <code>replace_na()</code>
function expects for you to give it a <code>list()</code> of columns
that you would like to replace the <code>NA</code> values in, and the
value that you would like to replace the <code>NA</code>s. This ends up
looking like this:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">topic_categories =</span> <span class="st">"no_categories"</span>)) <span class="sc">%&gt;%</span></span></code></pre>
</div>
<p>Next, we create a new variable named
<code>topic_categories_logical</code>, which has one value
(<code>TRUE</code>) for every row. This makes sense, since each item in
every row was owned by that household. We are constructing this variable
so that when we spread the <code>topic_categories</code> across multiple
columns, we can fill the values of those columns with logical values
describing whether the household did (<code>TRUE</code>) or didn’t
(<code>FALSE</code>) own that particular item.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">topic_categories_logical =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span></code></pre>
</div>
<figure><img src="fig/separate_longer.png" alt="Two tables shown side-by-side. The first row of the left table is highlighted in blue, and the first four rows of the right table are also highlighted in blue to show how each of the values of 'items owned' are given their own row with the separate longer delim function. The 'items owned logical' column is highlighted in yellow on the right table to show how the mutate function adds a new column." class="figure mx-auto d-block"></figure><p>Lastly, we use <code>pivot_wider()</code> to switch from long format
to wide format. This creates a new column for each of the unique values
in the <code>topic_categories</code> column, and fills those columns
with the values of <code>topic_categories_logical</code>. We also
declare that for topics that are missing, we want to fill those cells
with the value of <code>FALSE</code> instead of <code>NA</code>.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">topic_categories</span>,</span>
<span>            values_from <span class="op">=</span> <span class="va">topic_categories_logical</span>,</span>
<span>            values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>topic_categories_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/pivot_wider.png" alt="Two tables shown side-by-side. The 'items owned' column is highlighted in blue on the left table, and the column names are highlighted in blue on the right table to show how the values of the 'items owned' become the column names in the output of the pivot wider function. The 'items owned logical' column is highlighted in yellow on the left table, and the values of the bicycle, television, and solar panel columns are highlighted in yellow on the right table to show how the values of the 'items owned logical' column became the values of all three of the aforementioned columns." class="figure mx-auto d-block"></figure><p>Combining the above steps, the chunk looks like this:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_topics</span> <span class="op">&lt;-</span> <span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate_longer_delim</span><span class="op">(</span><span class="va">topic_categories</span>, delim <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">replace_na</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>topic_categories <span class="op">=</span> <span class="st">"no_topics"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>topic_categories_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">topic_categories</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">topic_categories_logical</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>topic_categories_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">videos_topics</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 41
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA               iPUAl1j… http…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA               YUmIAd_… http…
 3      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 4      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 5      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 6      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 7      145       452 UCaCcVtl9O3h5en4m-_edhZg Celeb LaLa Land    1l5GZ0N… http…
 8      315       276 UCAurTjb6Ewz21vjfTs1wZxw NOSIPHO NZAMA      j4Y022C… http…
 9      190       321 UCBlX1mnsIFZRqsyRNvpW_rA Zandile Mhlambi    gf2YNN6… http…
10      214       762 UClY87IoUANFZtswyC9GeecQ Beauty recipes     AGJmRd4… http…
# ℹ 190 more rows
# ℹ 35 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, duration_sec &lt;dbl&gt;,
#   definition &lt;chr&gt;, caption &lt;lgl&gt;, default_language &lt;chr&gt;,
#   default_l_audio_language &lt;chr&gt;, thumbnail_maxres &lt;chr&gt;,
#   licensed_content &lt;dbl&gt;, location_description &lt;chr&gt;, view_count &lt;dbl&gt;, …</code></pre>
</div>
<p>View the <code>videos_topics</code> data frame. It should have 200
rows (the same number of rows you had originally), but extra columns for
each item. How many columns were added? Notice that there is no longer a
column titled <code>topic_categories</code>. This is because there is a
default parameter in <code>pivot_wider()</code> that drops the original
column. The values that were in that column have now become columns
named <code>politics</code>, <code>health</code>, <code>business</code>,
etc. You can use <code>dim(videos)</code> and
<code>dim(videos_wide)</code> to see how the number of columns has
changed between the two datasets.</p>
<p>This format of the data allows us to do interesting things, like make
a table showing the number of videos in each video category on a
particular topic:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_topics</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">politics</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">video_category_label</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">politics</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 4 × 3
# Groups:   video_category_label [4]
  video_category_label politics     n
  &lt;chr&gt;                &lt;lgl&gt;    &lt;int&gt;
1 Comedy               TRUE         1
2 Entertainment        TRUE         5
3 News &amp; Politics      TRUE        24
4 People &amp; Blogs       TRUE        10</code></pre>
</div>
<p>Or below we calculate the average number of topics addressed by each
channel. This code uses the <code>rowSums()</code> function to count the
number of <code>TRUE</code> values in the <code>business</code> to
<code>politics</code> columns for each row, hence its name. Note that we
replaced <code>NA</code> values with the value <code>no_topics</code>,
so we must exclude this value in the aggregation. We then group the data
by channel and calculate the mean number of topics, so each average is
grouped by channel.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_topics</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">no_topics</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>number_topics <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">business</span><span class="op">:</span><span class="va">politics</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_topics <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">number_topics</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 119 × 2
   channel_title                 mean_topics
   &lt;chr&gt;                               &lt;dbl&gt;
 1 2nacheki                              1.5
 2 Absolute Controversy                  1
 3 African Diaspora News Channel         1
 4 Al Jazeera English                    2
 5 Ayanda Mafuyeka                       1
 6 Azana Jezile                          1
 7 BANELE NOCUZE                         1
 8 Banetsi Tshetlo                       1
 9 Beauty recipes                        2
10 Blackish Blue TV                      2
# ℹ 109 more rows</code></pre>
</div>
</section><section><h2 class="section-heading" id="pivoting-longer">Pivoting longer<a class="anchor" aria-label="anchor" href="#pivoting-longer"></a>
</h2>
<hr class="half-width">
<p>The opposing situation could occur if we had been provided with data
in the form of <code>videos_wide</code>, where the items owned are
column names, but we wish to treat them as values of an
<code>topic_categories</code> variable instead.</p>
<p>In this situation we are gathering these columns turning them into a
pair of new variables. One variable includes the column names as values,
and the other variable contains the values in each cell previously
associated with the column names. We will do this in two steps to make
this process a bit clearer.</p>
<p><code>pivot_longer()</code> takes four principal arguments:</p>
<ol style="list-style-type: decimal">
<li>the data</li>
<li>
<em>cols</em> are the names of the columns we use to fill the new
values variable (or to drop).</li>
<li>the <em>names_to</em> column variable we wish to create from the
<em>cols</em> provided.</li>
<li>the <em>values_to</em> column variable we wish to create and fill
with values associated with the <em>cols</em> provided.</li>
</ol>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_long</span> <span class="op">&lt;-</span> <span class="va">videos_topics</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">business</span><span class="op">:</span><span class="va">politics</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"topic_categories"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"topic_categories_logical"</span><span class="op">)</span></span></code></pre>
</div>
<p>View both <code>videos_long</code> and <code>videos_topics</code> and
compare their structure.</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>We created some summary tables on <code>videos_topics</code> using
<code>count</code> and <code>summarise</code>. We can create the same
tables on <code>videos_long</code>, but this will require a different
process.</p>
<ol style="list-style-type: decimal">
<li>Make a table showing showing the number of videos from each channel
categorised as a particular topic, and include all items. The difference
between this format and the wide format is that you can now
<code>count</code> all the topics using the
<code>topic_categories</code> variable.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">topic_categories_logical</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">topic_categories</span>, sort<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 171 × 3
# Groups:   channel_title [114]
   channel_title   topic_categories       n
   &lt;chr&gt;           &lt;chr&gt;              &lt;int&gt;
 1 SABC News       society               22
 2 eNCA            society               20
 3 eNCA            television_program    19
 4 SABC News       television_program    14
 5 Newzroom Afrika society               13
 6 Newzroom Afrika television_program    11
 7 SABC News       health                10
 8 eNCA            health                 8
 9 eNCA            politics               6
10 Newzroom Afrika politics               5
# ℹ 161 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<ol start="2" style="list-style-type: decimal">
<li>Calculate the average number of items from the list owned by
respondents in each village. If you remove rows where
<code>topic_categories_logical</code> is <code>FALSE</code> you will
have a data frame where the number of rows per household is equal to the
number of items owned. You can use that to calculate the mean number of
items per village.</li>
</ol>
<p>Remember, you need to make sure we don’t count
<code>no_listed_items</code>, since this is not an actual item, but
rather the absence thereof.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_long</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">topic_categories_logical</span>,</span>
<span>         <span class="va">topic_categories</span> <span class="op">!=</span> <span class="st">"no_topics"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># to keep information per video, we count video_id</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">video_id</span>, <span class="va">channel_title</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># we want to also keep the channel variable</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">channel_title</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_topics <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 114 × 2
   channel_title                 mean_topics
   &lt;chr&gt;                               &lt;dbl&gt;
 1 2nacheki                              1.5
 2 Absolute Controversy                  1
 3 African Diaspora News Channel         1
 4 Al Jazeera English                    2
 5 Ayanda Mafuyeka                       2
 6 Azana Jezile                          1
 7 BANELE NOCUZE                         1
 8 Banetsi Tshetlo                       1
 9 Beauty recipes                        2
10 Blackish Blue TV                      2
# ℹ 104 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="applying-what-we-learned-to-clean-our-data">Applying what we learned to clean our data<a class="anchor" aria-label="anchor" href="#applying-what-we-learned-to-clean-our-data"></a>
</h2>
<hr class="half-width">
<p>Now we have simultaneously learned about <code>pivot_longer()</code>
and <code>pivot_wider()</code>, and fixed a problem in the way our data
is structured. In the spreadsheets lesson, we learned that it’s best
practice to have only a single piece of information in each cell of your
spreadsheet. In this dataset, we have another column that stores
multiple values in a single cell. Some of the cells in the
<code>tags</code> column contain multiple months which, as before, are
separated by semi-colons (<code>;</code>).</p>
<p>To create a data frame where each of the columns contain only one
value per cell, we can repeat the steps we applied to
<code>topic_categories</code> and apply them to <code>tags</code>. Since
we will be using this data frame for the next episode, we will call it
<code>videos_plotting</code>.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">videos_plotting</span> <span class="op">&lt;-</span> <span class="va">videos</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## pivot wider by topic_categories</span></span>
<span>  <span class="fu">separate_longer_delim</span><span class="op">(</span><span class="va">topic_categories</span>, delim <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## if there were no topics listed, changing NA to no_listed_items</span></span>
<span>  <span class="fu">replace_na</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>topic_categories <span class="op">=</span> <span class="st">"no_topics"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>topic_categories_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">topic_categories</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">topic_categories_logical</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>topic_categories_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="co">#%&gt;%</span></span>
<span>  <span class="co">## pivot wider by tags</span></span>
<span>  <span class="co">#separate_longer_delim(tags, delim = ";") %&gt;%</span></span>
<span>  <span class="co">#mutate(tags_logical = TRUE) %&gt;%</span></span>
<span>  <span class="co">#pivot_wider(names_from = tags,</span></span>
<span>  <span class="co">#           values_from = tags_logical</span></span>
<span>  <span class="co">#          values_fill = list(tags_logical = FALSE)) %&gt;%</span></span>
<span>  <span class="co">## add some summary columns</span></span>
<span>  <span class="co">#mutate(number_tags = rowSums(select(., Jan:May))) %&gt;% #replace with start and end tags</span></span>
<span>  <span class="co">#mutate(number_topics = rowSums(select(., business:politics)))</span></span>
<span></span>
<span>  <span class="va">videos_plotting</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 200 × 41
   position randomise channel_id               channel_title      video_id url
      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;
 1      112       409 UCI3RT5PGmdi1KVp9FG_CneA eNCA               iPUAl1j… http…
 2       50       702 UCI3RT5PGmdi1KVp9FG_CneA eNCA               YUmIAd_… http…
 3      149       313 UCMwDXpWEVQVw4ZF7z-E4NoA StellenboschNews … v8XfpOi… http…
 4      167       384 UCsqKkYLOaJ9oBwq9rxFyZMw SOUTH AFRICAN POL… lnLdo2k… http…
 5      195       606 UC5G5Dy8-mmp27jo6Frht7iQ Umgosi Entertainm… XN6toca… http…
 6      213       423 UCC1udUghY9dloGMuvZzZEzA The Tea World      rh2Nz78… http…
 7      145       452 UCaCcVtl9O3h5en4m-_edhZg Celeb LaLa Land    1l5GZ0N… http…
 8      315       276 UCAurTjb6Ewz21vjfTs1wZxw NOSIPHO NZAMA      j4Y022C… http…
 9      190       321 UCBlX1mnsIFZRqsyRNvpW_rA Zandile Mhlambi    gf2YNN6… http…
10      214       762 UClY87IoUANFZtswyC9GeecQ Beauty recipes     AGJmRd4… http…
# ℹ 190 more rows
# ℹ 35 more variables: published_at &lt;dttm&gt;, published_at_sql &lt;chr&gt;, year &lt;dbl&gt;,
#   month &lt;dbl&gt;, day &lt;dbl&gt;, video_title &lt;chr&gt;, video_description &lt;chr&gt;,
#   tags &lt;chr&gt;, video_category_label &lt;chr&gt;, duration_sec &lt;dbl&gt;,
#   definition &lt;chr&gt;, caption &lt;lgl&gt;, default_language &lt;chr&gt;,
#   default_l_audio_language &lt;chr&gt;, thumbnail_maxres &lt;chr&gt;,
#   licensed_content &lt;dbl&gt;, location_description &lt;chr&gt;, view_count &lt;dbl&gt;, …</code></pre>
</div>
</section><section><h2 class="section-heading" id="exporting-data">Exporting data<a class="anchor" aria-label="anchor" href="#exporting-data"></a>
</h2>
<hr class="half-width">
<p>Now that you have learned how to use
<strong><code>dplyr</code></strong> and
<strong><code>tidyr</code></strong> to wrangle your raw data, you may
want to export these new datasets to share them with your collaborators
or for archival purposes.</p>
<p>Similar to the <code>read_csv()</code> function used for reading CSV
files into R, there is a <code>write_csv()</code> function that
generates CSV files from data frames.</p>
<p>Before using <code>write_csv()</code>, we are going to create a new
folder, <code>data_output</code>, in our working directory that will
store this generated dataset. We don’t want to write generated datasets
in the same directory as our raw data. It’s good practice to keep them
separate. The <code>data</code> folder should only contain the raw,
unaltered data, and should be left alone to make sure we don’t delete or
modify it. In contrast, our script will generate the contents of the
<code>data_output</code> directory, so even if the files it contains are
deleted, we can always re-generate them.</p>
<p>In preparation for our next lesson on plotting, we created a version
of the dataset where each of the columns includes only one data value.
Now we can save this data frame to our <code>data_output</code>
directory.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv</span> <span class="op">(</span><span class="va">videos_plotting</span>, file <span class="op">=</span> <span class="st">"data_output/videos_plotting.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the <code>tidyr</code> package to change the layout of data
frames.</li>
<li>Use <code>pivot_wider()</code> to go from long to wide format.</li>
<li>Use <code>pivot_longer()</code> to go from wide to long format.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-05-ggplot2"><p>Content from <a href="05-ggplot2.html">Data Visualisation with ggplot2</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/05-ggplot2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the components of a ggplot?</li>
<li>How do I create scatterplots, boxplots, and barplots?</li>
<li>How can I change the aesthetics (ex. colour, transparency) of my
plot?</li>
<li>How can I create multiple plots at once?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Produce scatter plots, boxplots, and barplots using ggplot.</li>
<li>Set universal plot settings.</li>
<li>Describe what faceting is and apply faceting in ggplot.</li>
<li>Modify the aesthetics of an existing ggplot plot (including axis
labels and colour).</li>
<li>Build complex and customized plots from data in a data frame.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We start by loading the required package.
<strong><code>ggplot2</code></strong> is also included in the
<strong><code>tidyverse</code></strong> package.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<p>If not still in the workspace, load the data we saved in the previous
lesson.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_output/interviews_plotting.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 131 Columns: 45
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (5): village, respondent_wall_type, memb_assoc, affect_conflicts, inst...
dbl   (8): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals, number_...
lgl  (31): bicycle, television, solar_panel, table, cow_cart, radio, cow_plo...
dttm  (1): interview_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<p>If you were unable to complete the previous lesson or did not save
the data, then you can create it now.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Not run, but can be used to load in data from previous lesson!</span></span>
<span><span class="va">interviews_plotting</span> <span class="op">&lt;-</span> <span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## pivot wider by items_owned</span></span>
<span>  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">items_owned</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## if there were no items listed, changing NA to no_listed_items</span></span>
<span>  <span class="fu">replace_na</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>items_owned <span class="op">=</span> <span class="st">"no_listed_items"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">items_owned</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">items_owned_logical</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## pivot wider by months_lack_food</span></span>
<span>  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">months_lack_food</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>months_lack_food_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">months_lack_food</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">months_lack_food_logical</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>months_lack_food_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## add some summary columns</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>number_months_lack_food <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">Jan</span><span class="op">:</span><span class="va">May</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>number_items <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">bicycle</span><span class="op">:</span><span class="va">car</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<section><h2 class="section-heading" id="plotting-with-ggplot2">Plotting with <strong><code>ggplot2</code></strong>
<a class="anchor" aria-label="anchor" href="#plotting-with-ggplot2"></a>
</h2>
<hr class="half-width">
<p><strong><code>ggplot2</code></strong> is a plotting package that
makes it simple to create complex plots from data stored in a data
frame. It provides a programmatic interface for specifying what
variables to plot, how they are displayed, and general visual
properties. Therefore, we only need minimal changes if the underlying
data change or if we decide to change from a bar plot to a scatterplot.
This helps in creating publication quality plots with minimal amounts of
adjustments and tweaking.</p>
<p><strong><code>ggplot2</code></strong> functions work best with data
in the ‘long’ format, i.e., a column for every dimension, and a row for
every observation. Well-structured data will save you lots of time when
making figures with <strong><code>ggplot2</code></strong></p>
<p>ggplot graphics are built step by step by adding new elements. Adding
layers in this fashion allows for extensive flexibility and
customization of plots.</p>
<p>Each chart built with ggplot2 must include the following</p>
<ul>
<li><p>Data</p></li>
<li>
<p>Aesthetic mapping (aes)</p>
<ul>
<li>Describes how variables are mapped onto graphical attributes</li>
<li>Visual attribute of data including x-y axes, color, fill, shape, and
alpha</li>
</ul>
</li>
<li>
<p>Geometric objects (geom)</p>
<ul>
<li>Determines how values are rendered graphically, as bars
(<code>geom_bar</code>), scatterplot (<code>geom_point</code>), line
(<code>geom_line</code>), etc.</li>
</ul>
</li>
</ul>
<p>Thus, the template for graphic in ggplot2 is:</p>
<pre><code>&lt;DATA&gt; %&gt;%
    ggplot(aes(&lt;MAPPINGS&gt;)) +
    &lt;GEOM_FUNCTION&gt;()</code></pre>
<p>Remember from the last lesson that the pipe operator
<code>%&gt;%</code> places the result of the previous line(s) into the
first argument of the function. <strong><code>ggplot</code></strong> is
a function that expects a data frame to be the first argument. This
allows for us to change from specifying the <code>data =</code> argument
within the <code>ggplot</code> function and instead pipe the data into
the function.</p>
<ul>
<li>use the <code>ggplot()</code> function and bind the plot to a
specific data frame.</li>
</ul>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>define a mapping (using the aesthetic (<code>aes</code>) function),
by selecting the variables to be plotted and specifying how to present
them in the graph, e.g. as x/y positions or characteristics such as
size, shape, color, etc.</li>
</ul>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>
<p>add ‘geoms’ – graphical representations of the data in the plot
(points, lines, bars). <strong><code>ggplot2</code></strong> offers many
different geoms; we will use some common ones today, including:</p>
<ul>
<li>
<code>geom_point()</code> for scatter plots, dot plots, etc.</li>
<li>
<code>geom_boxplot()</code> for, well, boxplots!</li>
<li>
<code>geom_line()</code> for trend lines, time series, etc.</li>
</ul>
</li>
</ul>
<p>To add a geom to the plot use the <code>+</code> operator. Because we
have two continuous variables, let’s use <code>geom_point()</code>
first:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-first-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The <code>+</code> in the <strong><code>ggplot2</code></strong>
package is particularly useful because it allows you to modify existing
<code>ggplot</code> objects. This means you can easily set up plot
templates and conveniently explore different types of plots, so the
above plot can also be generated with code like this, similar to the
“intermediate steps” approach in the previous lesson:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign plot to a variable</span></span>
<span><span class="va">interviews_plot</span> <span class="op">&lt;-</span> <span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw the plot as a dot plot</span></span>
<span><span class="va">interviews_plot</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div id="notes" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="notes" class="callout-inner">
<h3 class="callout-title">Notes</h3>
<div class="callout-content">
<ul>
<li>Anything you put in the <code>ggplot()</code> function can be seen
by any geom layers that you add (i.e., these are universal plot
settings). This includes the x- and y-axis mapping you set up in
<code>aes()</code>.</li>
<li>You can also specify mappings for a given geom independently of the
mapping defined globally in the <code>ggplot()</code> function.</li>
<li>The <code>+</code> sign used to add new layers must be placed at the
end of the line containing the <em>previous</em> layer. If, instead, the
<code>+</code> sign is added at the beginning of the line containing the
new layer, <strong><code>ggplot2</code></strong> will not add the new
layer and will return an error message.</li>
</ul>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## This is the correct syntax for adding layers</span></span>
<span><span class="va">interviews_plot</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## This will not add the new layer and will return an error message</span></span>
<span><span class="va">interviews_plot</span></span>
<span><span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="building-your-plots-iteratively">Building your plots iteratively<a class="anchor" aria-label="anchor" href="#building-your-plots-iteratively"></a>
</h2>
<hr class="half-width">
<p>Building plots with <strong><code>ggplot2</code></strong> is
typically an iterative process. We start by defining the dataset we’ll
use, lay out the axes, and choose a geom:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-create-ggplot-object-1.png" alt="Scatter plot of number of items owned versus number of household members." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Then, we start modifying this plot to extract more information from
it. For instance, when inspecting the plot we notice that points only
appear at the intersection of whole numbers of <code>no_membrs</code>
and <code>number_items</code>. Also, from a rough estimate, it looks
like there are far fewer dots on the plot than there rows in our
dataframe. This should lead us to believe that there may be multiple
observations plotted on top of each other (e.g. three observations where
<code>no_membrs</code> is 3 and <code>number_items</code> is 1).</p>
<p>There are two main ways to alleviate overplotting issues:</p>
<ol style="list-style-type: decimal">
<li>changing the transparency of the points</li>
<li>jittering the location of the points</li>
</ol>
<p>Let’s first explore option 1, changing the transparency of the
points. What we mean when we say “transparency” we mean the opacity of
point, or your ability to see through the point. We can control the
transparency of the points with the <code>alpha</code> argument to
<code>geom_point</code>. Values of <code>alpha</code> range from 0 to 1,
with lower values corresponding to more transparent colors (an
<code>alpha</code> of 1 is the default value). Specifically, an alpha of
0.1, would make a point one-tenth as opaque as a normal point. Stated
differently ten points stacked on top of each other would correspond to
a normal point.</p>
<p>Here, we change the <code>alpha</code> to 0.5, in an attempt to help
fix the overplotting. While the overplotting isn’t solved, adding
transparency begins to address this problem, as the points where there
are overlapping observations are darker (as opposed to lighter
gray):</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-adding-transparency-1.png" alt="Scatter plot of number of items owned versus number of household members, with transparency added to points." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>That only helped a little bit with the overplotting problem, so let’s
try option two. We can jitter the points on the plot, so that we can see
each point in the locations where there are overlapping points.
Jittering introduces a little bit of randomness into the position of our
points. You can think of this process as taking the overplotted graph
and giving it a tiny shake. The points will move a little bit
side-to-side and up-and-down, but their position from the original plot
won’t dramatically change. Note that this solution is suitable for
plotting integer figures, while for numeric figures with decimals,
geom_jitter() becomes inappropriate because it obscures the true value
of the observation.</p>
<p>We can jitter our points using the <code>geom_jitter()</code>
function instead of the <code>geom_point()</code> function, as seen
below:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-adding-jitter-1.png" alt="Scatter plot of number of items owned versus number of household members, showing jitter." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The <code>geom_jitter()</code> function allows for us to specify the
amount of random motion in the jitter, using the <code>width</code> and
<code>height</code> arguments. When we don’t specify values for
<code>width</code> and <code>height</code>, <code>geom_jitter()</code>
defaults to 40% of the resolution of the data (the smallest change that
can be measured). Hence, if we would like <em>less</em> spread in our
jitter than was default, we should pick values between 0.1 and 0.4.
Experiment with the values to see how your plot changes.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-adding-width-height-1.png" alt="Scatter plot of number of items owned versus number of household members, with jitter and transparency." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>For our final change, we can also add colours for all the points by
specifying a <code>color</code> argument inside the
<code>geom_jitter()</code> function:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-adding-colors-1.png" alt="Scatter plot of number of items owned versus number of household members, showing points as blue." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>To colour each village in the plot differently, you could use a
vector as an input to the argument <strong><code>color</code></strong>.
However, because we are now mapping features of the data to a colour,
instead of setting one colour for all points, the colour of the points
now needs to be set inside a call to the
<strong><code>aes</code></strong> function. When we map a variable in
our data to the colour of the points,
<strong><code>ggplot2</code></strong> will provide a different colour
corresponding to the different values of the variable. We will continue
to specify the value of <strong><code>alpha</code></strong>,
<strong><code>width</code></strong>, and
<strong><code>height</code></strong> outside of the
<strong><code>aes</code></strong> function because we are using the same
value for every point. ggplot2 understands both the Commonwealth English
and American English spellings for colour, i.e., you can use either
<code>color</code> or <code>colour</code>. Here is an example where we
color points by the <strong><code>village</code></strong> of the
observation:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">village</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, width <span class="op">=</span> <span class="fl">0.2</span>, height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-color-by-species-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>There appears to be a positive trend between number of household
members and number of items owned (from the list provided).
Additionally, this trend does not appear to be different by village.</p>
<div id="notes-1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="notes-1" class="callout-inner">
<h3 class="callout-title">Notes</h3>
<div class="callout-content">
<p>As you will learn, there are multiple ways to plot the a relationship
between variables. Another way to plot data with overlapping points is
to use the <code>geom_count</code> plotting function. The
<code>geom_count()</code> function makes the size of each point
representative of the number of data items of that type and the legend
gives point sizes associated to particular numbers of items.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">no_membrs</span>, y <span class="op">=</span> <span class="va">number_items</span>, color <span class="op">=</span> <span class="va">village</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_count</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-color-by-species-notes-1.png" alt="Previous plot with dots colored by village." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Use what you just learned to create a scatter plot of
<code>rooms</code> by <code>village</code> with the
<code>respondent_wall_type</code> showing in different colours. Does
this seem like a good way to display the relationship between these
variables? What other kinds of plots might you use to show this type of
data?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">rooms</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">respondent_wall_type</span><span class="op">)</span>,</span>
<span>      alpha <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>        height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-scatter-challenge-1.png" alt="Scatter plot showing positive trend between number of household members and number of items owned." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This is not a great way to show this type of data because it is
difficult to distinguish between villages. What other plot types could
help you visualize this relationship better?</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="boxplot">Boxplot<a class="anchor" aria-label="anchor" href="#boxplot"></a>
</h2>
<hr class="half-width">
<p>We can use boxplots to visualize the distribution of rooms for each
wall type:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span>, y <span class="op">=</span> <span class="va">rooms</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-boxplot-1.png" alt="Box plot of number of rooms by wall type." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>By adding points to a boxplot, we can have a better idea of the
number of measurements and of their distribution:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span>, y <span class="op">=</span> <span class="va">rooms</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"tomato"</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>        height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-boxplot-with-jitter-1.png" alt="Previous plot with dot plot added as additional layer to show individual values. Boxplot layer is transparent." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can see that muddaub houses and sunbrick houses tend to be smaller
than burntbrick houses.</p>
<p>Notice how the boxplot layer is behind the jitter layer? What do you
need to change in the code to put the boxplot layer in front of the
jitter layer?</p>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Boxplots are useful summaries, but hide the <em>shape</em> of the
distribution. For example, if the distribution is bimodal, we would not
see it in a boxplot. An alternative to the boxplot is the violin plot,
where the shape (of the density of points) is drawn.</p>
<ul>
<li>Replace the box plot with a violin plot; see
<code>geom_violin()</code>.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span>, y <span class="op">=</span> <span class="va">rooms</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.</code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-violin-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>So far, we’ve looked at the distribution of room number within wall
type. Try making a new plot to explore the distribution of another
variable within wall type.</p>
<ul>
<li>Create a boxplot for <code>liv_count</code> for each wall type.
Overlay the boxplot layer on a jitter layer to show actual
measurements.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span>, y <span class="op">=</span> <span class="va">liv_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, width <span class="op">=</span> <span class="fl">0.2</span>, height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-boxplot-exercise-1.png" alt="Box plot of number of livestock owned by wall type, with dot plot added as additional layer to show individual values." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<ul>
<li>Add colour to the data points on your boxplot according to whether
the respondent is a member of an irrigation association
(<code>memb_assoc</code>).</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span>, y <span class="op">=</span> <span class="va">liv_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">memb_assoc</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, width <span class="op">=</span> <span class="fl">0.2</span>, height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-boxplot-exercise-factor-1.png" alt="Previous plot with dots colored based on whether respondent was a member of an irrigation association." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="barplots">Barplots<a class="anchor" aria-label="anchor" href="#barplots"></a>
</h2>
<hr class="half-width">
<p>Barplots are also useful for visualizing categorical data. By
default, <code>geom_bar</code> accepts a variable for x, and plots the
number of instances each value of x (in this case, wall type) appears in
the dataset.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-barplot-1-1.png" alt="Bar plot showing counts of respondent wall types." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can use the <code>fill</code> aesthetic for the
<code>geom_bar()</code> geom to colour bars by the portion of each count
that is from each village.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">village</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-barplot-stack-1.png" alt="Stacked bar plot of wall types showing each village as a different color." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This creates a stacked bar chart. These are generally more difficult
to read than side-by-side bars. We can separate the portions of the
stacked bar that correspond to each village and put them side-by-side by
using the <code>position</code> argument for <code>geom_bar()</code> and
setting it to “dodge”.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">village</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-barplot-dodge-1.png" alt="Bar plot of respondent wall types with each village as a separate bar." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This is a nicer graphic, but we’re more likely to be interested in
the proportion of each housing type in each village than in the actual
count of number of houses of each type (because we might have sampled
different numbers of households in each village). To compare
proportions, we will first create a new data frame
(<code>percent_wall_type</code>) with a new column named “percent”
representing the percent of each house type in each village. We will
remove houses with cement walls, as there was only one in the
dataset.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_wall_type</span> <span class="op">&lt;-</span> <span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">respondent_wall_type</span> <span class="op">!=</span> <span class="st">"cement"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">village</span>, <span class="va">respondent_wall_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">village</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>percent <span class="op">=</span> <span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fu">sum</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can use this new data frame to create our plot showing the
percentage of each house type in each village.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_wall_type</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span>, fill <span class="op">=</span> <span class="va">respondent_wall_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-barplot-wall-type-1.png" alt="Side by side bar plot showing percent of respondents in each village with each wall type." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="exercise-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Create a bar plot showing the proportion of respondents in each
village who are or are not part of an irrigation association
(<code>memb_assoc</code>). Include only respondents who answered that
question in the calculations and plot. Which village had the lowest
proportion of respondents in an irrigation association?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_memb_assoc</span> <span class="op">&lt;-</span> <span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">memb_assoc</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">village</span>, <span class="va">memb_assoc</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">village</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>percent <span class="op">=</span> <span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fu">sum</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">percent_memb_assoc</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span>, fill <span class="op">=</span> <span class="va">memb_assoc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-barplot-memb-assoc-1.png" alt="Bar plot showing percent of respondents in each village who were part of association." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Ruaca had the lowest proportion of members in an irrigation
association.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="adding-labels-and-titles">Adding Labels and Titles<a class="anchor" aria-label="anchor" href="#adding-labels-and-titles"></a>
</h2>
<hr class="half-width">
<p>By default, the axes labels on a plot are determined by the name of
the variable being plotted. However,
<strong><code>ggplot2</code></strong> offers lots of customization
options, like specifying the axes labels, and adding a title to the plot
with relatively few lines of code. We will add more informative x-and
y-axis labels to our plot, a more explanatory label to the legend, and a
plot title.</p>
<p>The <code>labs</code> function takes the following arguments:</p>
<ul>
<li>
<code>title</code> – to produce a plot title</li>
<li>
<code>subtitle</code> – to produce a plot subtitle (smaller text
placed beneath the title)</li>
<li>
<code>caption</code> – a caption for the plot</li>
<li>
<code>...</code> – any pair of name and value for aesthetics used in
the plot (e.g., <code>x</code>, <code>y</code>, <code>fill</code>,
<code>color</code>, <code>size</code>)</li>
</ul>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_wall_type</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span>, fill <span class="op">=</span> <span class="va">respondent_wall_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportion of wall type by village"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Type of Wall in Home"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Village"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Percent"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-barplot-wall-types-labeled-1.png" alt="Previous plot with plot title and labells added." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="faceting">Faceting<a class="anchor" aria-label="anchor" href="#faceting"></a>
</h2>
<hr class="half-width">
<p>Rather than creating a single plot with side-by-side bars for each
village, we may want to create multiple plot, where each plot shows the
data for a single village. This would be especially useful if we had a
large number of villages that we had sampled, as a large number of
side-by-side bars will become more difficult to read.</p>
<p><strong><code>ggplot2</code></strong> has a special technique called
<em>faceting</em> that allows the user to split one plot into multiple
plots based on a factor included in the dataset. We will use it to split
our barplot of housing type proportion by village so that each village
has its own panel in a multi-panel plot:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_wall_type</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span>, y <span class="op">=</span> <span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Proportion of wall type by village"</span>,</span>
<span>         x<span class="op">=</span><span class="st">"Wall Type"</span>,</span>
<span>         y<span class="op">=</span><span class="st">"Percent"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">village</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-barplot-faceting-1.png" alt="Bar plot showing percent of each wall type in each village." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Click the “Zoom” button in your RStudio plots pane to view a larger
version of this plot.</p>
<p>Usually plots with white background look more readable when printed.
We can set the background to white using the function
<code>theme_bw()</code>. Additionally, you can remove the grid:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_wall_type</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span>, y <span class="op">=</span> <span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Proportion of wall type by village"</span>,</span>
<span>         x<span class="op">=</span><span class="st">"Wall Type"</span>,</span>
<span>         y<span class="op">=</span><span class="st">"Percent"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">village</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-barplot-theme-bw-1.png" alt="Bar plot showing percent of each wall type in each village, with black and white theme applied." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>What if we wanted to see the proportion of respondents in each
village who owned a particular item? We can calculate the percent of
people in each village who own each item and then create a faceted
series of bar plots where each plot is a particular item. First we need
to calculate the percentage of people in each village who own each
item:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_items</span> <span class="op">&lt;-</span> <span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">village</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">bicycle</span><span class="op">:</span><span class="va">no_listed_items</span>, <span class="op">~</span> <span class="fu">sum</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">/</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">bicycle</span><span class="op">:</span><span class="va">no_listed_items</span>, names_to <span class="op">=</span> <span class="st">"items"</span>, values_to <span class="op">=</span> <span class="st">"percent"</span><span class="op">)</span></span></code></pre>
</div>
<p>To calculate this percentage data frame, we needed to use the
<code>across()</code> function within a <code>summarize()</code>
operation. Unlike the previous example with a single wall type variable,
where each response was exactly one of the types specified, people can
(and do) own more than one item. So there are multiple columns of data
(one for each item), and the percentage calculation needs to be repeated
for each column.</p>
<p>Combining <code>summarize()</code> with <code>across()</code> allows
us to specify first, the columns to be summarized
(<code>bicycle:no_listed_items</code>) and then the calculation. Because
our calculation is a bit more complex than is available in a built-in
function, we define a new formula:</p>
<ul>
<li>
<code>~</code> indicates that we are defining a formula,</li>
<li>
<code>sum(.x)</code> gives the number of people owning that item by
counting the number of <code>TRUE</code> values (<code>.x</code> is
shorthand for the column being operated on),</li>
<li>and <code>n()</code> gives the current group size.</li>
</ul>
<p>After the <code>summarize()</code> operation, we have a table of
percentages with each item in its own column, so a
<code>pivot_longer()</code> is required to transform the table into an
easier format for plotting. Using this data frame, we can now create a
multi-paneled bar plot.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_items</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">items</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-percent-items-barplot-1.png" alt="Multi-panel bar chart showing percent  of respondents in each village and who owned each item, with no grids behid bars." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="ggplot2-themes">
<strong><code>ggplot2</code></strong> themes<a class="anchor" aria-label="anchor" href="#ggplot2-themes"></a>
</h2>
<hr class="half-width">
<p>In addition to <code>theme_bw()</code>, which changes the plot
background to white, <strong><code>ggplot2</code></strong> comes with
several other themes which can be useful to quickly change the look of
your visualization. The complete list of themes is available at <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">https://ggplot2.tidyverse.org/reference/ggtheme.html</a>.
<code>theme_minimal()</code> and <code>theme_light()</code> are popular,
and <code>theme_void()</code> can be useful as a starting point to
create a new hand-crafted theme.</p>
<p>The <a href="https://jrnold.github.io/ggthemes/reference/index.html" class="external-link">ggthemes</a>
package provides a wide variety of options (including an Excel 2003
theme). The <a href="https://exts.ggplot2.tidyverse.org/" class="external-link"><strong><code>ggplot2</code></strong>
extensions website</a> provides a list of packages that extend the
capabilities of <strong><code>ggplot2</code></strong>, including
additional themes.</p>
<div id="exercise-3" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-3" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Experiment with at least two different themes. Build the previous
plot using each of those themes. Which do you like best?</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="customization">Customization<a class="anchor" aria-label="anchor" href="#customization"></a>
</h2>
<hr class="half-width">
<p>Take a look at the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf" class="external-link"><strong><code>ggplot2</code></strong>
cheat sheet</a>, and think of ways you could improve the plot.</p>
<p>Now, let’s change names of axes to something more informative than
‘village’ and ‘percent’ and add a title to the figure:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_items</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">items</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Percent of respondents in each village who owned each item"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Village"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Percent of Respondents"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-ggplot-customization-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The axes have more informative names, but their readability can be
improved by increasing the font size:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_items</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">items</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Percent of respondents in each village who owned each item"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Village"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Percent of Respondents"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-ggplot-customization-font-size-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Note that it is also possible to change the fonts of your plots. If
you are on Windows, you may have to install the <a href="https://github.com/wch/extrafont" class="external-link"><strong><code>extrafont</code></strong>
package</a>, and follow the instructions included in the README for this
package.</p>
<p>After our manipulations, you may notice that the values on the x-axis
are still not properly readable. Let’s change the orientation of the
labels and adjust them vertically and horizontally so they don’t
overlap. You can use a 90-degree angle, or experiment to find the
appropriate angle for diagonally oriented labels. With a larger font,
the title also runs off. We can add “\n” in the string for the title to
insert a new line:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percent_items</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">items</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Percent of respondents in each village \n who owned each item"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Village"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Percent of Respondents"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span>, angle <span class="op">=</span> <span class="fl">45</span>,</span>
<span>                                     hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>          text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-ggplot-customization-label-orientation-1.png" alt="Multi-panel bar charts showing percent of respondents in each village and who owned each item, with grids behind the bars." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If you like the changes you created better than the default theme,
you can save them as an object to be able to easily apply them to other
plots you may create. We can also add
<code>plot.title = element_text(hjust = 0.5)</code> to centre the
title:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grey_theme</span> <span class="op">&lt;-</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                                               angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                               vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>                    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">percent_items</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">items</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Percent of respondents in each village \n who owned each item"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Village"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Percent of Respondents"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">grey_theme</span></span></code></pre>
</div>
<figure><img src="fig/05-ggplot2-rendered-ggplot-custom-themes-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="exercise-4" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-4" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>With all of this information in hand, please take another five
minutes to either improve one of the plots generated in this exercise or
create a beautiful graph of your own. Use the RStudio <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf" class="external-link"><strong><code>ggplot2</code></strong>
cheat sheet</a> for inspiration. Here are some ideas:</p>
<ul>
<li>See if you can make the bars white with black outline.</li>
<li>Try using a different colour palette (see <a href="https://www.cookbook-r.com/Graphs/Colors_(ggplot2)/" class="external-link">http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/</a>).</li>
</ul>
</div>
</div>
</div>
<p>After creating your plot, you can save it to a file in your favourite
format. The Export tab in the <strong>Plot</strong> pane in RStudio will
save your plots at low resolution, which will not be accepted by many
journals and will not scale well for posters.</p>
<p>Instead, use the <code>ggsave()</code> function, which allows you to
easily change the dimension and resolution of your plot by adjusting the
appropriate arguments (<code>width</code>, <code>height</code> and
<code>dpi</code>).</p>
<p>Make sure you have the <code>fig_output/</code> folder in your
working directory.</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="va">percent_items</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">village</span>, y <span class="op">=</span> <span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">items</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Percent of respondents in each village \n who owned each item"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Village"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Percent of Respondents"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span>, angle <span class="op">=</span> <span class="fl">45</span>,</span>
<span>                                     hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>          text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"fig_output/name_of_file.png"</span>, <span class="va">my_plot</span>, width <span class="op">=</span> <span class="fl">15</span>, height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<p>Note: The parameters <code>width</code> and <code>height</code> also
determine the font size in the saved plot.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>
<code>ggplot2</code> is a flexible and useful tool for creating
plots in R.</li>
<li>The data set and coordinate system can be defined using the
<code>ggplot</code> function.</li>
<li>Additional layers, including geoms, are added using the
<code>+</code> operator.</li>
<li>Boxplots are useful for visualizing the distribution of a continuous
variable.</li>
<li>Barplots are useful for visualizing categorical data.</li>
<li>Faceting allows you to generate multiple plots based on a
categorical variable.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-06-rmarkdown"><p>Content from <a href="06-rmarkdown.html">Getting started with R Markdown (Optional)</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/06-rmarkdown.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is R Markdown?</li>
<li>How can I integrate my R code with text and plots?</li>
<li>How can I convert .Rmd files to .html?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create a .Rmd document containing R code, text, and plots</li>
<li>Create a YAML header to control output</li>
<li>Understand basic syntax of (R)Markdown</li>
<li>Customise code chunks to control formatting</li>
<li>Use code chunks and in-line code to create dynamic, reproducible
documents</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="r-markdown">R Markdown<a class="anchor" aria-label="anchor" href="#r-markdown"></a>
</h2>
<hr class="half-width">
<p>R Markdown is a flexible type of document that allows you to
seamlessly combine executable R code, and its output, with text in a
single document. These documents can be readily converted to multiple
static and dynamic output formats, including PDF (.pdf), Word (.docx),
and HTML (.html).</p>
<p>The benefit of a well-prepared R Markdown document is full
reproducibility. This also means that, if you notice a data
transcription error, or you are able to add more data to your analysis,
you will be able to recompile the report without making any changes in
the actual document.</p>
<p>The <strong>rmarkdown</strong> package comes pre-installed with
RStudio, so no action is necessary.</p>
<figure><img src="fig/rmarkdown_wizards.png" alt="R Markdown wizard monsters creating a R Markdown document from a recipe. Art by Allison Horst" width="100%" style="display: block; margin: auto;" class="figure"><figcaption>
Image credit:
<a href="https://github.com/allisonhorst/stats-illustrations" class="external-link">Allison
Horst</a>
</figcaption></figure></section><section><h2 class="section-heading" id="creating-an-r-markdown-file">Creating an R Markdown file<a class="anchor" aria-label="anchor" href="#creating-an-r-markdown-file"></a>
</h2>
<hr class="half-width">
<p>To create a new R Markdown document in RStudio, click File -&gt; New
File -&gt; R Markdown:</p>
<figure><img src="fig/new-rmd.png" alt="Screenshot of the New R Markdown file dialogue box in RStudio" class="figure mx-auto d-block"></figure><p>Then click on ‘Create Empty Document’. Normally you could enter the
title of your document, your name (Author), and select the type of
output, but we will be learning how to start from a blank document.</p>
</section><section><h2 class="section-heading" id="basic-components-of-r-markdown">Basic components of R Markdown<a class="anchor" aria-label="anchor" href="#basic-components-of-r-markdown"></a>
</h2>
<hr class="half-width">
<p>To control the output, a YAML (YAML Ain’t Markup Language) header is
needed:</p>
<pre><code>---
title: "My Awesome Report"
author: "Emmet Brickowski"
date: ""
output: html_document
---</code></pre>
<p>The header is defined by the three hyphens at the beginning
(<code>---</code>) and the three hyphens at the end
(<code>---</code>).</p>
<p>In the YAML, the only required field is the <code>output:</code>,
which specifies the type of output you want. This can be an
<code>html_document</code>, a <code>pdf_document</code>, or a
<code>word_document</code>. We will start with an HTML doument and
discuss the other options later.</p>
<p>The rest of the fields can be deleted, if you don’t need them. After
the header, to begin the body of the document, you start typing after
the end of the YAML header (i.e. after the second <code>---</code>).</p>
</section><section><h2 class="section-heading" id="markdown-syntax">Markdown syntax<a class="anchor" aria-label="anchor" href="#markdown-syntax"></a>
</h2>
<hr class="half-width">
<p>Markdown is a popular markup language that allows you to add
formatting elements to text, such as <strong>bold</strong>,
<em>italics</em>, and <code>code</code>. The formatting will not be
immediately visible in a markdown (.md) document, like you would see in
a Word document. Rather, you add Markdown syntax to the text, which can
then be converted to various other files that can translate the Markdown
syntax. Markdown is useful because it is lightweight, flexible, and
platform independent.</p>
<p>Some platforms provide a real time preview of the formatting, like
RStudio’s visual markdown editor (available from version 1.4).</p>
<p>First, let’s create a heading! A <code>#</code> in front of text
indicates to Markdown that this text is a heading. Adding more
<code>#</code>s make the heading smaller, i.e. one <code>#</code> is a
first level heading, two <code>##</code>s is a second level heading,
etc. upto the 6th level heading.</p>
<pre><code><span><span class="co"># Title</span></span>
<span><span class="co">## Section</span></span>
<span><span class="co">### Sub-section</span></span>
<span><span class="co">#### Sub-sub section</span></span>
<span><span class="co">##### Sub-sub-sub section</span></span>
<span><span class="co">###### Sub-sub-sub-sub section</span></span></code></pre>
<p>(only use a level if the one above is also in use)</p>
<p>Since we have already defined our title in the YAML header, we will
use a section heading to create an Introduction section.</p>
<pre><code><span><span class="co">## Introduction</span></span></code></pre>
<p>You can make things <strong>bold</strong> by surrounding the word
with double asterisks, <code>**bold**</code>, or double underscores,
<code>__bold__</code>; and <em>italicize</em> using single asterisks,
<code>*italics*</code>, or single underscores,
<code>_italics_</code>.</p>
<p>You can also combine <strong>bold</strong> and <em>italics</em> to
write something <strong><em>really</em></strong> important with
triple-asterisks, <code>***really***</code>, or underscores,
<code>___really___</code>; and, if you’re feeling bold (pun intended),
you can also use a combination of asterisks and underscores,
<code>**_really_**</code>, <code>**_really_**</code>.</p>
<p>To create <code>code-type</code> font, surround the word with
backticks, <code>code-type</code>.</p>
<p>Now that we’ve learned a couple of things, it might be useful to
implement them:</p>
<pre><code>## Introduction

This report uses the **tidyverse** package along with the *SAFI* dataset,
which has columns that include:</code></pre>
<p>Then we can create a list for the variables using <code>-</code>,
<code>+</code>, or <code>*</code> keys.</p>
<pre><code>## Introduction

This report uses the **tidyverse** package along with the *SAFI* dataset,
which has columns that include:

- village
- interview_date
- no_members
- years_liv
- respondent_wall_type
- rooms</code></pre>
<p>You can also create an ordered list using numbers:</p>
<pre><code>1. village
2. interview_date
3. no_members
4. years_liv
5. respondent_wall_type
6. rooms</code></pre>
<p>And nested items by tab-indenting:</p>
<pre><code>- village
  + Name of village
- interview_date
  + Date of interview
- no_members
  + How many family members lived in a house
- years_liv
  + How many years respondent has lived in village or neighbouring village
- respondent_wall_type
  + Type of wall of house
- rooms
  + Number of rooms in house</code></pre>
<p>For more Markdown syntax see <a href="https://www.markdownguide.org/basic-syntax" class="external-link">the following
reference guide</a>.</p>
<p>Now we can render the document into HTML by clicking the
<strong>Knit</strong> button in the top of the Source pane (top left),
or use the keyboard shortcut
<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>K</kbd> on Windows and Linux, and
<kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>K</kbd> on Mac. If you haven’t
saved the document yet, you will be prompted to do so when you
<strong>Knit</strong> for the first time.</p>
<figure><img src="fig/rmd-rmd_to_html.png" alt="The 'knitting' process: First, R Markdown is converted to Markdown, which is then converted (via pandoc) to .html, .pdf, .docx, etc." class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="writing-an-r-markdown-report">Writing an R Markdown report<a class="anchor" aria-label="anchor" href="#writing-an-r-markdown-report"></a>
</h2>
<hr class="half-width">
<p>Now we will add some R code from our previous data wrangling and
visualisation, which means we need to make sure
<strong>tidyverse</strong> is loaded. It is not enough to load
<strong>tidyverse</strong> from the console, we will need to load it
within our R Markdown document. The same applies to our data. To load
these, we will need to create a ‘code chunk’ at the top of our document
(below the YAML header).</p>
<p>A code chunk can be inserted by clicking Code &gt; Insert Chunk, or
by using the keyboard shortcuts
<kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>I</kbd> on Windows and Linux, and
<kbd>Cmd</kbd>+<kbd>Option</kbd>+<kbd>I</kbd> on Mac.</p>
<p>The syntax of a code chunk is:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">MARKDOWN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode markdown" tabindex="0"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="in">```{r chunk-name}</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="in">"Here is where you place the R code that you want to run."</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="in">```</span></span></code></pre>
</div>
<p>An R Markdown document knows that this text is not part of the report
from the <code>```</code> that begins and ends the chunk. It also knows
that the code inside of the chunk is R code from the <code>r</code>
inside of the curly braces (<code>{}</code>). After the <code>r</code>
you can add a name for the code chunk . Naming a chunk is optional, but
recommended. Each chunk name must be unique, and only contain
alphanumeric characters and <code>-</code>.</p>
<p>To load <strong>tidyverse</strong> and our
<code>SAFI_clean.csv</code> file, we will insert a chunk and call it
‘setup’. Since we don’t want this code or the output to show in our
knitted HTML document, we add an <code>include = FALSE</code> option
after the code chunk name (<code>{r setup, include = FALSE}</code>).</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">MARKDOWN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode markdown" tabindex="0"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="in">```{r setup, include = FALSE}</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="in">library(here)</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="in">interviews &lt;- read_csv(here("data/SAFI_clean.csv"), na = "NULL")</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="in">```</span></span></code></pre>
</div>
<div id="important-note" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="important-note" class="callout-inner">
<h3 class="callout-title">Important Note!</h3>
<div class="callout-content">
<p>The file paths you give in a .Rmd document, e.g. to load a .csv file,
are relative to the .Rmd document, <strong>not</strong> the project
root.</p>
<p>As suggested in the Starting with Data episode, we highly recommend
the use of the <code>here()</code> function to keep the file paths
consistent within your project.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="insert-table">Insert table<a class="anchor" aria-label="anchor" href="#insert-table"></a>
</h2>
<hr class="half-width">
<p>Next, we will re-create a table from the Data Wrangling episode which
shows the average household size grouped by <code>village</code> and
<code>memb_assoc</code>. We can do this by creating a new code chunk and
calling it ‘interview-tbl’. Or, you can come up with something more
creative (just remember to stick to the naming rules).</p>
<p>It isn’t necessary to <strong>Knit</strong> your document every time
you want to see the output. Instead you can run the code chunk with the
green triangle in the top right corner of the the chunk, or with the
keyboard shortcuts: <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>C</kbd> on
Windows and Linux, or <kbd>Cmd</kbd>+<kbd>Option</kbd>+<kbd>C</kbd> on
Mac.</p>
<p>To make sure the table is formatted nicely in our output document, we
will need to use the <code>kable()</code> function from the
<strong>knitr</strong> package. The <code>kable()</code> function takes
the output of your R code and knits it into a nice looking HTML table.
You can also specify different aspects of the table, e.g. the column
names, a caption, etc.</p>
<p>Run the code chunk to make sure you get the desired output.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">memb_assoc</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">village</span>, <span class="va">memb_assoc</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_no_membrs <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">no_membrs</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu">kable</span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"We can also add a caption."</span>, </span>
<span>               col.names <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Village"</span>, <span class="st">"Member Association"</span>, </span>
<span>                             <span class="st">"Mean Number of Members"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<table class="table">
<caption>We can also add a caption.</caption>
<thead><tr class="header">
<th align="left">Village</th>
<th align="left">Member Association</th>
<th align="right">Mean Number of Members</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Chirodzo</td>
<td align="left">no</td>
<td align="right">8.062500</td>
</tr>
<tr class="even">
<td align="left">Chirodzo</td>
<td align="left">yes</td>
<td align="right">7.818182</td>
</tr>
<tr class="odd">
<td align="left">God</td>
<td align="left">no</td>
<td align="right">7.133333</td>
</tr>
<tr class="even">
<td align="left">God</td>
<td align="left">yes</td>
<td align="right">8.000000</td>
</tr>
<tr class="odd">
<td align="left">Ruaca</td>
<td align="left">no</td>
<td align="right">7.178571</td>
</tr>
<tr class="even">
<td align="left">Ruaca</td>
<td align="left">yes</td>
<td align="right">9.500000</td>
</tr>
</tbody>
</table>
<p>Many different R packages can be used to generate tables. Some of the
more commonly used options are listed in the table below.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="19%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Creator(s)</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://condformat.sergioller.com/index.html" class="external-link">condformat</a></td>
<td><a href="https://cran.rstudio.com/web/packages/condformat/index.html" class="external-link">Oller
Moreno (2022)</a></td>
<td>Apply and visualize conditional formatting to data frames in R. It
renders a data frame with cells formatted according to criteria defined
by rules, using a tidy evaluation syntax.</td>
</tr>
<tr class="even">
<td><a href="https://rstudio.github.io/DT/" class="external-link">DT</a></td>
<td><a href="https://cran.r-project.org/web/packages/DT/index.html" class="external-link">Xie
et al. (2023)</a></td>
<td>Data objects in R can be rendered as HTML tables using the
JavaScript library ‘DataTables’ (typically via R Markdown or Shiny). The
‘DataTables’ library has been included in this R package.</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/renkun-ken/formattable" class="external-link">formattable</a></td>
<td><a href="https://cran.r-project.org/web/packages/formattable/index.html" class="external-link">Ren
and Russell (2021)</a></td>
<td>Provides functions to create formattable vectors and data frames.
‘Formattable’ vectors are printed with text formatting, and formattable
data frames are printed with multiple types of formatting in HTML to
improve the readability of data presented in tabular form rendered on
web pages.</td>
</tr>
<tr class="even">
<td><a href="https://davidgohel.github.io/flextable/" class="external-link">flextable</a></td>
<td><a href="https://cran.r-project.org/web/packages/flextable/index.html" class="external-link">Gohel
and Skintzos (2023)</a></td>
<td>Use a grammar for creating and customizing pretty tables. The
following formats are supported: ‘HTML’, ‘PDF’, ‘RTF’, ‘Microsoft Word’,
‘Microsoft PowerPoint’ and R ‘Grid Graphics’. ‘R Markdown’, ‘Quarto’,
and the package ‘officer’ can be used to produce the result files.</td>
</tr>
<tr class="odd">
<td><a href="https://gt.rstudio.com/" class="external-link">gt</a></td>
<td><a href="https://cloud.r-project.org/web/packages/gt/index.html" class="external-link">Iannone et
al. (2022)</a></td>
<td>Build display tables from tabular data with an easy-to-use set of
functions. With its progressive approach, we can construct display
tables with cohesive table parts. Table values can be formatted using
any of the included formatting functions.</td>
</tr>
<tr class="even">
<td><a href="https://hughjonesd.github.io/huxtable/" class="external-link">huxtable</a></td>
<td><a href="https://cran.r-project.org/web/packages/huxtable/index.html" class="external-link">Hugh-Jones
(2022)</a></td>
<td>Creates styled tables for data presentation. Export to HTML, LaTeX,
RTF, ‘Word’, ‘Excel’, and ‘PowerPoint’. Simple, modern interface to
manipulate borders, size, position, captions, colours, text styles and
number formatting.</td>
</tr>
<tr class="odd">
<td><a href="https://rapporter.github.io/pander/" class="external-link">pander</a></td>
<td><a href="https://cran.r-project.org/web/packages/pander/index.html" class="external-link">Daróczi
and Tsegelskyi (2022)</a></td>
<td>Contains some functions catching all messages, ‘stdout’ and other
useful information while evaluating R code and other helpers to return
user specified text elements (e.g., header, paragraph, table, image,
lists etc.) in ‘pandoc’ markdown or several types of R objects similarly
automatically transformed to markdown format.</td>
</tr>
<tr class="even">
<td><a href="https://pixiedust.github.io/pixiedust/" class="external-link">pixiedust</a></td>
<td><a href="https://cran.rstudio.com/web/packages/pixiedust/index.html" class="external-link">Nutter
and Kretch (2021)</a></td>
<td>‘pixiedust’ provides tidy data frames with a programming interface
intended to be similar to ’ggplot2’s system of layers with fine-tuned
control over each cell of the table.</td>
</tr>
<tr class="odd">
<td><a href="https://glin.github.io/reactable/" class="external-link">reactable</a></td>
<td><a href="https://cran.r-project.org/web/packages/reactable/index.html" class="external-link">Lin
et al. (2023)</a></td>
<td>Interactive data tables for R, based on the ‘React Table’ JavaScript
library. Provides an HTML widget that can be used in ‘R Markdown’ or
‘Quarto’ documents, ‘Shiny’ applications, or viewed from an R
console.</td>
</tr>
<tr class="even">
<td><a href="http://jrowen.github.io/rhandsontable/" class="external-link">rhandsontable</a></td>
<td><a href="https://cran.r-project.org/web/packages/rhandsontable/index.html" class="external-link">Owen
et al. (2021)</a></td>
<td>An R interface to the ‘Handsontable’ JavaScript library, which is a
minimalist Excel-like data grid editor.</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/cran/stargazer" class="external-link">stargazer</a></td>
<td><a href="https://cran.r-project.org/web/packages/stargazer/index.html" class="external-link">Hlavac
(2022)</a></td>
<td>Produces LaTeX code, HTML/CSS code and ASCII text for well-formatted
tables that hold regression analysis results from several models
side-by-side, as well as summary statistics.</td>
</tr>
<tr class="even">
<td><a href="https://github.com/dmurdoch/tables" class="external-link">tables</a></td>
<td><a href="https://cran.r-project.org/web/packages/tables/index.html" class="external-link">Murdoch
(2022)</a></td>
<td>Computes and displays complex tables of summary statistics. Output
may be in LaTeX, HTML, plain text, or an R matrix for further
processing.</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/spgarbet/tangram" class="external-link">tangram</a></td>
<td><a href="https://cran.r-project.org/web/packages/tangram/index.html" class="external-link">Garbett
et al. (2023)</a></td>
<td>Provides an extensible formula system to quickly and easily create
production quality tables. The processing steps are a formula parser,
statistical content generation from data defined by a formula, and
rendering into a table.</td>
</tr>
<tr class="even">
<td><a href="https://github.com/cran/xtable" class="external-link">xtable</a></td>
<td><a href="https://cran.r-project.org/web/packages/xtable/index.html" class="external-link">Dahl et
al. (2019)</a></td>
<td>Coerce data to LaTeX and HTML tables.</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/cardiomoon/ztable" class="external-link">ztable</a></td>
<td><a href="https://cran.r-project.org/web/packages/ztable/index.html" class="external-link">Moon
(2021)</a></td>
<td>Makes zebra-striped tables (tables with alternating row colors) in
LaTeX and HTML formats easily from a data.frame, matrix, lm, aov, anova,
glm, coxph, nls, fitdistr, mytable and cbind.mytable objects.</td>
</tr>
</tbody>
</table></section><section><h2 class="section-heading" id="customising-chunk-output">Customising chunk output<a class="anchor" aria-label="anchor" href="#customising-chunk-output"></a>
</h2>
<hr class="half-width">
<p>We mentioned using <code>include = FALSE</code> in a code chunk to
prevent the code and output from printing in the knitted document. There
are additional options available to customise how the code-chunks are
presented in the output document. The options are entered in the code
chunk after <code>chunk-name</code>and separated by commas,
e.g. <code>{r chunk-name, eval = FALSE, echo = TRUE}</code>.</p>
<table class="table">
<colgroup>
<col width="5%">
<col width="5%">
<col width="88%">
</colgroup>
<thead><tr class="header">
<th>Option</th>
<th>Options</th>
<th>Output</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>eval</code></td>
<td>
<code>TRUE</code> or <code>FALSE</code>
</td>
<td>Whether or not the code within the code chunk should be run.</td>
</tr>
<tr class="even">
<td><code>echo</code></td>
<td>
<code>TRUE</code> or <code>FALSE</code>
</td>
<td>Choose if you want to show your code chunk in the output document.
<code>echo = TRUE</code> will show the code chunk.</td>
</tr>
<tr class="odd">
<td><code>include</code></td>
<td>
<code>TRUE</code> or <code>FALSE</code>
</td>
<td>Choose if the output of a code chunk should be included in the
document. <code>FALSE</code> means that your code will run, but will not
show up in the document.</td>
</tr>
<tr class="even">
<td><code>warning</code></td>
<td>
<code>TRUE</code> or <code>FALSE</code>
</td>
<td>Whether or not you want your output document to display potential
warning messages produced by your code.</td>
</tr>
<tr class="odd">
<td><code>message</code></td>
<td>
<code>TRUE</code> or <code>FALSE</code>
</td>
<td>Whether or not you want your output document to display potential
messages produced by your code.</td>
</tr>
<tr class="even">
<td><code>fig.align</code></td>
<td>
<code>default</code>, <code>left</code>, <code>right</code>,
<code>center</code>
</td>
<td>Where the figure from your R code chunk should be output on the
page</td>
</tr>
</tbody>
</table>
<div id="tip" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip" class="callout-inner">
<h3 class="callout-title">Tip</h3>
<div class="callout-content">
<ul>
<li>The default settings for the above chunk options are all
<code>TRUE</code>.</li>
<li>The default settings can be modified per chunk, or with
<code>knitr::opts_chunk$set()</code>,</li>
<li>Entering <code>knitr::opts_chunk$set(echo = FALSE)</code> will
change the default of value of <code>echo</code> to <code>FALSE</code>
for <strong>every</strong> code chunk in the document.</li>
</ul>
</div>
</div>
</div>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Play around with the different options in the chunk with the code for
the table, and re-<strong>Knit</strong> to see what each option does to
the output.</p>
<p>What happens if you use <code>eval = FALSE</code> and
<code>echo = FALSE</code>? What is the difference between this and
<code>include = FALSE</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Solution to Exercise </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Create a chunk with <code>{r eval = FALSE, echo = FALSE}</code>, then
create another chunk with <code>{r include = FALSE}</code> to compare.
<code>eval = FALSE</code> and <code>echo = FALSE</code> will neither run
the code in the chunk, nor show the code in the knitted document. The
code chunk essentially doesn’t exist in the knitted document as it was
never run. Whereas <code>include = FALSE</code> will run the code and
store the output for later use.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="in-line-r-code">In-line R code<a class="anchor" aria-label="anchor" href="#in-line-r-code"></a>
</h2>
<hr class="half-width">
<p>Now we will use some in-line R code to present some descriptive
statistics. To use in-line R-code, we use the same backticks that we
used in the Markdown section, with an <code>r</code> to specify that we
are generating R-code. The difference between in-line code and a code
chunk is the number of backticks. In-line R code uses one backtick
(<code>r</code>), whereas code chunks use three backticks
(<code>r</code>).</p>
<p>For example, today’s date is <code>`r Sys.Date()`</code>, will be
rendered as: today’s date is 2024-09-20.<br>
The code will display today’s date in the output document (well,
technically the date the document was last knitted).</p>
<p>The best way to use in-line R code, is to minimise the amount of code
you need to produce the in-line output by preparing the output in code
chunks. Let’s say we’re interested in presenting the average household
size in a village.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a summary data frame with the mean household size by village</span></span>
<span><span class="va">mean_household</span> <span class="op">&lt;-</span> <span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">village</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_no_membrs <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">no_membrs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># and select the village we want to use</span></span>
<span><span class="va">mean_chirodzo</span> <span class="op">&lt;-</span> <span class="va">mean_household</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">village</span> <span class="op">==</span> <span class="st">"Chirodzo"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can make an informative statement on the means of each
village, and include the mean values as in-line R-code. For example:</p>
<p>The average household size in the village of Chirodzo is
<code>`r round(mean_chirodzo$mean_no_membrs, 2)`</code></p>
<p>becomes…</p>
<p>The average household size in the village of Chirodzo is 7.08.</p>
<p>Because we are using in-line R code instead of the actual values, we
have created a dynamic document that will automatically update if we
make changes to the dataset and/or code chunks.</p>
</section><section><h2 class="section-heading" id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h2>
<hr class="half-width">
<p>Finally, we will also include a plot, so our document is a little
more colourful and a little less boring. We will use the
<code>interview_plotting</code> data from the previous episode.</p>
<p>If you were unable to complete the previous lesson or did not save
the data, then you can create it in a new code chunk.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Not run, but can be used to load in data from previous lesson!</span></span>
<span><span class="va">interviews_plotting</span> <span class="op">&lt;-</span> <span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## pivot wider by items_owned</span></span>
<span>  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">items_owned</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## if there were no items listed, changing NA to no_listed_items</span></span>
<span>  <span class="fu">replace_na</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>items_owned <span class="op">=</span> <span class="st">"no_listed_items"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">items_owned</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">items_owned_logical</span>, </span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## pivot wider by months_lack_food</span></span>
<span>  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">months_lack_food</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>months_lack_food_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">months_lack_food</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">months_lack_food_logical</span>, </span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>months_lack_food_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## add some summary columns</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>number_months_lack_food <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">Jan</span><span class="op">:</span><span class="va">May</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>number_items <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">bicycle</span><span class="op">:</span><span class="va">car</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Create a new code chunk for the plot, and copy the code from any of
the plots we created in the previous episode to produce a plot in the
chunk. I recommend one of the colourful plots.</p>
<p>If you are feeling adventurous, you can also create a new plot with
the <code>interviews_plotting</code> data frame.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Solution to Exercise </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">village</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/06-rmarkdown-rendered-my-fancy-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>We can also create a caption with the chunk option
<code>fig.cap</code>.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">MARKDOWN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode markdown" tabindex="0"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="in">```{r chunk-name, fig.cap = "I made this plot while attending an</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="in">awesome Data Carpentries workshop where I learned a ton of cool stuff!"}</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="in">Code for plot</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="in">```</span></span></code></pre>
</div>
<p>…or, ideally, something more informative.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">respondent_wall_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">village</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Type of Wall in Home"</span>, y <span class="op">=</span> <span class="st">"Count"</span>, fill <span class="op">=</span> <span class="st">"Village Name"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="co"># add colour deficient friendly palette</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/06-rmarkdown-rendered-caption-plot-1.png" alt="I made this plot while attending an awesome Data Carpentries workshop where I learned a ton of cool stuff!" class="figure mx-auto d-block"><figcaption>
I made this plot while attending an awesome Data Carpentries workshop
where I learned a ton of cool stuff!
</figcaption></figure></section><section><h2 class="section-heading" id="other-output-options">Other output options<a class="anchor" aria-label="anchor" href="#other-output-options"></a>
</h2>
<hr class="half-width">
<p>You can convert R Markdown to a PDF or a Word document (among
others). Click the little triangle next to the <strong>Knit</strong>
button to get a drop-down menu. Or you could put
<code>pdf_document</code> or <code>word_document</code> in the initial
header of the file.</p>
<pre><code>---
title: "My Awesome Report"
author: "Emmet Brickowski"
date: ""
output: word_document
---</code></pre>
<div id="note-creating-pdf-documents" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note-creating-pdf-documents" class="callout-inner">
<h3 class="callout-title">Note: Creating PDF documents</h3>
<div class="callout-content">
<p>Creating .pdf documents may require installation of some extra
software. The R package <code>tinytex</code> provides some tools to help
make this process easier for R users. With <code>tinytex</code>
installed, run <code>tinytex::install_tinytex()</code> to install the
required software (you’ll only need to do this once) and then when you
<strong>Knit</strong> to pdf <code>tinytex</code> will automatically
detect and install any additional LaTeX packages that are needed to
produce the pdf document. Visit the <a href="https://yihui.org/tinytex/" class="external-link">tinytex website</a> for more
information.</p>
</div>
</div>
</div>
<div id="note-inserting-citations-into-an-r-markdown-file" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note-inserting-citations-into-an-r-markdown-file" class="callout-inner">
<h3 class="callout-title">Note: Inserting citations into an R Markdown file</h3>
<div class="callout-content">
<p>It is possible to insert citations into an R Markdown file using the
editor toolbar. The editor toolbar includes commonly seen formatting
buttons generally seen in text editors (e.g., bold and italic buttons).
The toolbar is accessible by using the settings dropdown menu (next to
the ‘Knit’ dropdown menu) to select ‘Use Visual Editor’, also accessible
through the shortcut ‘Crtl+Shift+F4’. From here, clicking ‘Insert’
allows ‘Citation’ to be selected (shortcut: ‘Crtl+Shift+F8’). For
example, searching ‘10.1007/978-3-319-24277-4’ in ‘From DOI’ and
inserting will provide the citation for <code>ggplot2</code> <span class="citation">[@wickham2016]</span>. This will also save the
citation(s) in ‘references.bib’ in the current working directory. Visit
the <a href="https://rstudio.github.io/visual-markdown-editing/" class="external-link">R
Studio website</a> for more information. Tip: obtaining citation
information from relevant packages can be done by using
<code>citation("package")</code>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h2>
<hr class="half-width">
<ul>
<li><a href="https://kbroman.org/knitr_knutshell" class="external-link">Knitr in a knutshell
tutorial</a></li>
<li>
<a href="https://www.amazon.com/exec/obidos/ASIN/1482203537/7210-20" class="external-link">Dynamic
Documents with R and knitr</a> (book)</li>
<li><a href="https://rmarkdown.rstudio.com" class="external-link">R Markdown
documentation</a></li>
<li><a href="https://github.com/rstudio/cheatsheets/blob/master/rmarkdown-2.0.pdf" class="external-link">R
Markdown cheat sheet</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/getting-started-with-r-markdown/" class="external-link">Getting
started with R Markdown</a></li>
<li><a href="https://commonmark.org/help/tutorial/" class="external-link">Markdown
tutorial</a></li>
<li>
<a href="https://bookdown.org/yihui/rmarkdown/" class="external-link">R Markdown: The
Definitive Guide</a> (book by Rstudio team)</li>
<li><a href="https://www.rstudio.com/resources/webinars/reproducible-reporting/" class="external-link">Reproducible
Reporting</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/the-ecosystem-of-r-markdown/" class="external-link">The
Ecosystem of R Markdown</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/introducing-bookdown/" class="external-link">Introducing
Bookdown</a></li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>R Markdown is a useful language for creating reproducible documents
combining text and executable R-code.</li>
<li>Specify chunk options to control formatting of the output
document</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-07-json"><p>Content from <a href="07-json.html">Processing JSON data (Optional)</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/07-json.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is JSON format?</li>
<li>How can I convert JSON to an R dataframe?</li>
<li>How can I convert an array of JSON record into a table?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe the JSON data format</li>
<li>Understand where JSON is typically used</li>
<li>Appreciate some advantages of using JSON over tabular data</li>
<li>Appreciate some disadvantages of processing JSON documents</li>
<li>Use the jsonLite package to read a JSON file</li>
<li>Display formatted JSON as dataframe</li>
<li>Select and display nested dataframe fields from a JSON document</li>
<li>Write tabular data from selected elements from a JSON document to a
csv file</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="the-json-data-format">The JSON data format<a class="anchor" aria-label="anchor" href="#the-json-data-format"></a>
</h2>
<hr class="half-width">
<p>The JSON data format was designed as a way of allowing different
machines or processes within machines to communicate with each other by
sending messages constructed in a well defined format. JSON is now the
preferred data format used by APIs (Application Programming
Interfaces).</p>
<p>The JSON format although somewhat verbose is not only Human readable
but it can also be mapped very easily to an R dataframe.</p>
<p>We are going to read a file of data formatted as JSON, convert it
into a dataframe in R then selectively create a csv file from the
extracted data.</p>
<p>The JSON file we are going to use is the <a href="data/SAFI.json">SAFI.json</a> file. This is the output file from
an electronic survey system called ODK. The JSON represents the answers
to a series of survey questions. The questions themselves have been
replaced with unique Keys, the values are the answers.</p>
<p>Because detailed surveys are by nature nested structures making it
possible to record different levels of detail or selectively ask a set
of specific questions based on the answer given to a previous question,
the structure of the answers for the survey can not only be complex and
convoluted, it could easily be different from one survey respondent’s
set of answers to another.</p>
<div class="section level3">
<h3 id="advantages-of-json">Advantages of JSON<a class="anchor" aria-label="anchor" href="#advantages-of-json"></a>
</h3>
<ul>
<li>Very popular data format for APIs (e.g. results from an Internet
search)</li>
<li>Human readable</li>
<li>Each record (or document as they are called) is self contained. The
equivalent of the column name and column values are in every
record.</li>
<li>Documents do not all have to have the same structure within the same
file</li>
<li>Document structures can be complex and nested</li>
</ul>
</div>
<div class="section level3">
<h3 id="disadvantages-of-json">Disadvantages of JSON<a class="anchor" aria-label="anchor" href="#disadvantages-of-json"></a>
</h3>
<ul>
<li>It is more verbose than the equivalent data in csv format</li>
<li>Can be more difficult to process and display than csv formatted
data</li>
</ul>
</div>
</section><section><h2 class="section-heading" id="use-the-json-package-to-read-a-json-file">Use the JSON package to read a JSON file<a class="anchor" aria-label="anchor" href="#use-the-json-package-to-read-a-json-file"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span></code></pre>
</div>
<p>As with reading in a CSV, you have a couple of options for how to
access the JSON file.</p>
<p>You can read the JSON file directly into R with
<code>read_json()</code> or the comparable <code>fromJSON()</code>
function, though this does not download the file.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json_data</span> <span class="op">&lt;-</span> <span class="fu">read_json</span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/datacarpentry/r-socialsci/main/episodes/data/SAFI.json"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>To download the file you can copy and paste the contents of the file
on <a href="https://github.com/datacarpentry/r-socialsci/blob/main/episodes/data/SAFI.json" class="external-link">GitHub</a>,
creating a <code>SAFI.json</code> file in your <code>data</code>
directory, or you can download the file with R.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/datacarpentry/r-socialsci/main/episodes/data/SAFI.json"</span>,</span>
<span>   <span class="st">"data/SAFI.json"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre>
</div>
<p>Once you have the data downloaded, you can read it into R with
<code>read_json()</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json_data</span> <span class="op">&lt;-</span> <span class="fu">read_json</span><span class="op">(</span><span class="st">"data/SAFI.json"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can see that a new object called json_data has appeared in our
Environment. It is described as a Large list (131 elements). In this
current form, our data is messy. You can have a glimpse of it with the
<code>head()</code> or <code>view()</code> functions. It will look not
much more structured than if you were to open the JSON file with a text
editor.</p>
<p>This is because, by default, the <code>read_json()</code> function’s
parameter <code>simplifyVector</code>, which specifies whether or not to
simplify vectors is set to FALSE. This means that the default setting
does not simplify nested lists into vectors and data frames. However, we
can set this to TRUE, and our data will be read directly as a
dataframe:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json_data</span> <span class="op">&lt;-</span> <span class="fu">read_json</span><span class="op">(</span><span class="st">"data/SAFI.json"</span>, simplifyVector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can see we have this json data in a dataframe format. For
consistency with the rest of the lesson, let’s coerce it to be a tibble
and use <code>glimpse</code> to take a peek inside (these functions were
loaded by <code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>):</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json_data</span> <span class="op">&lt;-</span> <span class="va">json_data</span> <span class="op">%&gt;%</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">json_data</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 131
Columns: 74
$ C06_rooms                      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 3, 1, 5, 1, 3, 1, …
$ B19_grand_liv                  &lt;chr&gt; "no", "yes", "no", "no", "yes", "no", "…
$ A08_ward                       &lt;chr&gt; "ward2", "ward2", "ward2", "ward2", "wa…
$ E01_water_use                  &lt;chr&gt; "no", "yes", "no", "no", "no", "no", "y…
$ B18_sp_parents_liv             &lt;chr&gt; "yes", "yes", "no", "no", "no", "no", "…
$ B16_years_liv                  &lt;int&gt; 4, 9, 15, 6, 40, 3, 38, 70, 6, 23, 20, …
$ E_yes_group_count              &lt;chr&gt; NA, "3", NA, NA, NA, NA, "4", "2", "3",…
$ F_liv                          &lt;list&gt; [&lt;data.frame[1 x 2]&gt;], [&lt;data.frame[3 …
$ `_note2`                       &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ instanceID                     &lt;chr&gt; "uuid:ec241f2c-0609-46ed-b5e8-fe575f6ce…
$ B20_sp_grand_liv               &lt;chr&gt; "yes", "yes", "no", "no", "no", "no", "…
$ F10_liv_owned_other            &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ `_note1`                       &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ F12_poultry                    &lt;chr&gt; "yes", "yes", "yes", "yes", "yes", "no"…
$ D_plots_count                  &lt;chr&gt; "2", "3", "1", "3", "2", "1", "4", "2",…
$ C02_respondent_wall_type_other &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ C02_respondent_wall_type       &lt;chr&gt; "muddaub", "muddaub", "burntbricks", "b…
$ C05_buildings_in_compound      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 2, 2, 1, 2, 2, 1, …
$ `_remitters`                   &lt;list&gt; [&lt;data.frame[0 x 0]&gt;], [&lt;data.frame[0 …
$ E18_months_no_water            &lt;list&gt; &lt;NULL&gt;, &lt;"Aug", "Sept"&gt;, &lt;NULL&gt;, &lt;NULL…
$ F07_use_income                 &lt;chr&gt; NA, "AlimentaÃ§Ã£o e pagamento de educa…
$ G01_no_meals                   &lt;int&gt; 2, 2, 2, 2, 2, 2, 3, 2, 3, 3, 2, 3, 2, …
$ E17_no_enough_water            &lt;chr&gt; NA, "yes", NA, NA, NA, NA, "yes", "yes"…
$ F04_need_money                 &lt;chr&gt; NA, "no", NA, NA, NA, NA, "no", "no", "…
$ A05_end                        &lt;chr&gt; "2017-04-02T17:29:08.000Z", "2017-04-02…
$ C04_window_type                &lt;chr&gt; "no", "no", "yes", "no", "no", "no", "n…
$ E21_other_meth                 &lt;chr&gt; NA, "no", NA, NA, NA, NA, "no", "no", "…
$ D_no_plots                     &lt;int&gt; 2, 3, 1, 3, 2, 1, 4, 2, 3, 2, 2, 2, 4, …
$ F05_money_source               &lt;list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;…
$ A07_district                   &lt;chr&gt; "district1", "district1", "district1", …
$ C03_respondent_floor_type      &lt;chr&gt; "earth", "earth", "cement", "earth", "e…
$ E_yes_group                    &lt;list&gt; [&lt;data.frame[0 x 0]&gt;], [&lt;data.frame[3 …
$ A01_interview_date             &lt;chr&gt; "2016-11-17", "2016-11-17", "2016-11-17…
$ B11_remittance_money           &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no…
$ A04_start                      &lt;chr&gt; "2017-03-23T09:49:57.000Z", "2017-04-02…
$ D_plots                        &lt;list&gt; [&lt;data.frame[2 x 8]&gt;], [&lt;data.frame[3 …
$ F_items                        &lt;list&gt; [&lt;data.frame[3 x 3]&gt;], [&lt;data.frame[2 …
$ F_liv_count                    &lt;chr&gt; "1", "3", "1", "2", "4", "1", "1", "2",…
$ F10_liv_owned                  &lt;list&gt; "poultry", &lt;"oxen", "cows", "goats"&gt;, …
$ B_no_membrs                    &lt;int&gt; 3, 7, 10, 7, 7, 3, 6, 12, 8, 12, 6, 7, …
$ F13_du_look_aftr_cows          &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no…
$ E26_affect_conflicts           &lt;chr&gt; NA, "once", NA, NA, NA, NA, "never", "n…
$ F14_items_owned                &lt;list&gt; &lt;"bicycle", "television", "solar_panel…
$ F06_crops_contr                &lt;chr&gt; NA, "more_half", NA, NA, NA, NA, "more_…
$ B17_parents_liv                &lt;chr&gt; "no", "yes", "no", "no", "yes", "no", "…
$ G02_months_lack_food           &lt;list&gt; "Jan", &lt;"Jan", "Sept", "Oct", "Nov", "…
$ A11_years_farm                 &lt;dbl&gt; 11, 2, 40, 6, 18, 3, 20, 16, 16, 22, 6,…
$ F09_du_labour                  &lt;chr&gt; "no", "no", "yes", "yes", "no", "yes", …
$ E_no_group_count               &lt;chr&gt; "2", NA, "1", "3", "2", "1", NA, NA, NA…
$ E22_res_change                 &lt;list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;…
$ E24_resp_assoc                 &lt;chr&gt; NA, "no", NA, NA, NA, NA, NA, "yes", NA…
$ A03_quest_no                   &lt;chr&gt; "01", "01", "03", "04", "05", "6", "7",…
$ `_members`                     &lt;list&gt; [&lt;data.frame[3 x 12]&gt;], [&lt;data.frame[7…
$ A06_province                   &lt;chr&gt; "province1", "province1", "province1", …
$ `gps:Accuracy`                 &lt;dbl&gt; 14, 19, 13, 5, 10, 12, 11, 9, 11, 14, 1…
$ E20_exper_other                &lt;chr&gt; NA, "yes", NA, NA, NA, NA, "yes", "yes"…
$ A09_village                    &lt;chr&gt; "village2", "village2", "village2", "vi…
$ C01_respondent_roof_type       &lt;chr&gt; "grass", "grass", "mabatisloping", "mab…
$ `gps:Altitude`                 &lt;dbl&gt; 698, 690, 674, 679, 689, 692, 709, 700,…
$ `gps:Longitude`                &lt;dbl&gt; 33.48346, 33.48342, 33.48345, 33.48342,…
$ E23_memb_assoc                 &lt;chr&gt; NA, "yes", NA, NA, NA, NA, "no", "yes",…
$ E19_period_use                 &lt;dbl&gt; NA, 2, NA, NA, NA, NA, 10, 10, 6, 22, N…
$ E25_fees_water                 &lt;chr&gt; NA, "no", NA, NA, NA, NA, "no", "no", "…
$ C07_other_buildings            &lt;chr&gt; "no", "no", "no", "no", "no", "no", "ye…
$ observation                    &lt;chr&gt; "None", "Estes primeiros inquÃ©ritos na…
$ `_note`                        &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ A12_agr_assoc                  &lt;chr&gt; "no", "yes", "no", "no", "no", "no", "n…
$ G03_no_food_mitigation         &lt;list&gt; &lt;"na", "rely_less_food", "reduce_meals…
$ F05_money_source_other         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ `gps:Latitude`                 &lt;dbl&gt; -19.11226, -19.11248, -19.11211, -19.11…
$ E_no_group                     &lt;list&gt; [&lt;data.frame[2 x 6]&gt;], [&lt;data.frame[0 …
$ F14_items_owned_other          &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ F08_emply_lab                  &lt;chr&gt; "no", "yes", "no", "no", "no", "no", "n…
$ `_members_count`               &lt;chr&gt; "3", "7", "10", "7", "7", "3", "6", "12…</code></pre>
</div>
<p>Looking good, but you might notice that actually we have a variable,
<em>F_liv</em> that is a list of dataframes! It is very important to
know what you are expecting from your data to be able to look for things
like this. For example, if you are getting your JSON from an API, have a
look at the API documentation, so you know what to look for.</p>
<p>Often when we have a very large number of columns, it can become
difficult to determine all the variables which may require some special
attention, like lists. Fortunately, we can use special verbs like
<code>where</code> to quickly select all the list columns.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.list</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 131
Columns: 14
$ F_liv                  &lt;list&gt; [&lt;data.frame[1 x 2]&gt;], [&lt;data.frame[3 x 2]&gt;], …
$ `_remitters`           &lt;list&gt; [&lt;data.frame[0 x 0]&gt;], [&lt;data.frame[0 x 0]&gt;], …
$ E18_months_no_water    &lt;list&gt; &lt;NULL&gt;, &lt;"Aug", "Sept"&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL…
$ F05_money_source       &lt;list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;…
$ E_yes_group            &lt;list&gt; [&lt;data.frame[0 x 0]&gt;], [&lt;data.frame[3 x 14]&gt;],…
$ D_plots                &lt;list&gt; [&lt;data.frame[2 x 8]&gt;], [&lt;data.frame[3 x 8]&gt;], …
$ F_items                &lt;list&gt; [&lt;data.frame[3 x 3]&gt;], [&lt;data.frame[2 x 3]&gt;], …
$ F10_liv_owned          &lt;list&gt; "poultry", &lt;"oxen", "cows", "goats"&gt;, "none", …
$ F14_items_owned        &lt;list&gt; &lt;"bicycle", "television", "solar_panel", "tabl…
$ G02_months_lack_food   &lt;list&gt; "Jan", &lt;"Jan", "Sept", "Oct", "Nov", "Dec"&gt;, &lt;…
$ E22_res_change         &lt;list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;…
$ `_members`             &lt;list&gt; [&lt;data.frame[3 x 12]&gt;], [&lt;data.frame[7 x 12]&gt;]…
$ G03_no_food_mitigation &lt;list&gt; &lt;"na", "rely_less_food", "reduce_meals", "day_…
$ E_no_group             &lt;list&gt; [&lt;data.frame[2 x 6]&gt;], [&lt;data.frame[0 x 0]&gt;], …</code></pre>
</div>
<p>So what can we do about <em>F_liv</em>, the column of dataframes?
Well first things first, we can access each one. For example to access
the dataframe in the first row, we can use the bracket (<code>[</code>)
subsetting. Here we use single bracket, but you could also use double
bracket (<code>[[</code>). The <code>[[</code> form allows only a single
element to be selected using integer or character indices, whereas
<code>[</code> allows indexing by vectors.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json_data</span><span class="op">$</span><span class="va">F_liv</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
  F11_no_owned F_curr_liv
1            1    poultry</code></pre>
</div>
<p>We can also choose to view the nested dataframes at all the rows of
our main dataframe where a particular condition is met (for example
where the value for the variable <em>C06_rooms</em> is equal to 4):</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json_data</span><span class="op">$</span><span class="va">F_liv</span><span class="op">[</span><span class="fu">which</span><span class="op">(</span><span class="va">json_data</span><span class="op">$</span><span class="va">C06_rooms</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
  F11_no_owned F_curr_liv
1            3       oxen
2            2       cows
3            5      goats

[[2]]
  F11_no_owned F_curr_liv
1            4       oxen
2            5       cows
3            3      goats

[[3]]
data frame with 0 columns and 0 rows

[[4]]
  F11_no_owned F_curr_liv
1            4       oxen
2            4       cows
3            4      goats
4            1      sheep

[[5]]
  F11_no_owned F_curr_liv
1            2       cows</code></pre>
</div>
</section><section><h2 class="section-heading" id="write-the-json-file-to-csv">Write the JSON file to csv<a class="anchor" aria-label="anchor" href="#write-the-json-file-to-csv"></a>
</h2>
<hr class="half-width">
<p>If we try to write our json_data dataframe to a csv as we would
usually in a regular dataframe, we won’t get the desired result. Using
the <code>write_csv</code> function from the <a href="https://readr.tidyverse.org" class="external-link">readr</a>
package won’t give you an error for list columns, but you’ll only see
missing (i.e. <code>NA</code>) values in these columns. Let’s try it out
to confirm:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv</span><span class="op">(</span><span class="va">json_data</span>, <span class="st">"json_data_with_list_columns.csv"</span><span class="op">)</span></span>
<span><span class="fu">read_csv</span><span class="op">(</span><span class="st">"json_data_with_list_columns.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>To write out as a csv while maintaining the data within the list
columns, we will need to “flatten” these columns. One way to do this is
to convert these list columns into character types. (However, we don’t
want to change the data types for any of the other columns). Here’s one
way to do this using tidyverse. This command only applies the
<code>as.character</code> command to those columns ‘where’
<code>is.list</code> is <code>TRUE</code>.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flattened_json_data</span> <span class="op">&lt;-</span> <span class="va">json_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.list</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">flattened_json_data</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 131 × 74
   C06_rooms B19_grand_liv A08_ward E01_water_use B18_sp_parents_liv
       &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;
 1         1 no            ward2    no            yes
 2         1 yes           ward2    yes           yes
 3         1 no            ward2    no            no
 4         1 no            ward2    no            no
 5         1 yes           ward2    no            no
 6         1 no            ward2    no            no
 7         1 yes           ward2    yes           no
 8         3 yes           ward1    yes           yes
 9         1 yes           ward2    yes           no
10         5 no            ward2    yes           no
# ℹ 121 more rows
# ℹ 69 more variables: B16_years_liv &lt;int&gt;, E_yes_group_count &lt;chr&gt;,
#   F_liv &lt;chr&gt;, `_note2` &lt;lgl&gt;, instanceID &lt;chr&gt;, B20_sp_grand_liv &lt;chr&gt;,
#   F10_liv_owned_other &lt;lgl&gt;, `_note1` &lt;lgl&gt;, F12_poultry &lt;chr&gt;,
#   D_plots_count &lt;chr&gt;, C02_respondent_wall_type_other &lt;lgl&gt;,
#   C02_respondent_wall_type &lt;chr&gt;, C05_buildings_in_compound &lt;int&gt;,
#   `_remitters` &lt;chr&gt;, E18_months_no_water &lt;chr&gt;, F07_use_income &lt;chr&gt;, …</code></pre>
</div>
<p>Now you can write this to a csv file:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv</span><span class="op">(</span><span class="va">flattened_json_data</span>, <span class="st">"data_output/json_data_with_flattened_list_columns.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>Note: this means that when you read this csv back into R, the column
of the nested dataframes will now be read in as a character vector.
Converting it back to list to extract elements might be complicated, so
it is probably better to keep storing these data in a JSON format if you
will have to do this.</p>
<p>You can also write out the individual nested dataframes to a csv. For
example:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv</span><span class="op">(</span><span class="va">json_data</span><span class="op">$</span><span class="va">F_liv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"data_output/F_liv_row1.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>JSON is a popular data format for transferring data used by a great
many Web based APIs</li>
<li>The complex structure of a JSON document means that it cannot easily
be ‘flattened’ into tabular data</li>
<li>We can use R code to extract values of interest and place them in a
csv file</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-08-text-as-data"><p>Content from <a href="08-text-as-data.html">Text as data (Optional)</a></p>
<hr>
<p>Last updated on 2024-09-20 |

        <a href="https://github.com/marionwalton/media-test/edit/main/episodes/08-text-as-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the most important concepts for automating text
analysis?</li>
<li>How can I prepare text data for analysis?</li>
<li>How can I visualise frequency, collocation and concordance for a
corpus of textual data?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Introduce basic concepts needed to use the
<strong><code>quanteda</code></strong> package for discourse analysis:
corpus, tokens, dfm,and frequency.</li>
<li>Prepare text for analysis with the
<strong><code>quanteda</code></strong> functions <code>corpus</code>,
<code>tokens</code>, <code>dfm</code>, and <code>dfm_remove</code>.</li>
<li>Investigate the most frequent features in a dfm using the
<strong><code>quanteda</code></strong> function
<code>textstat_frequency</code>.</li>
<li>Plot frequencies using <strong><code>ggplot</code></strong>
</li>
<li>Select and modify a list of stopwords to remove unwanted words from
a dataset.</li>
<li>Visualise frequencies as a wordcloud using the
<strong><code>quanteda</code></strong> function
<code>textplot_wordcloud</code>.</li>
<li>Identify the strengths and weaknesses of these approaches to
visualising text data.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="using-quanteda-for-text-analysis">Using <strong><code>quanteda</code></strong> for text analysis<a class="anchor" aria-label="anchor" href="#using-quanteda-for-text-analysis"></a>
</h2>
<hr class="half-width">
<p>Before conducting automated text analysis, we will need to install
and load a suitable package. For this tutorial we will be using the
<strong><code>quanteda</code></strong> package which offers many useful
text analysis functions.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("quanteda")</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">quanteda</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<hr class="half-width">
<p>We will start by exploring the text from some historical speeches by
Nelson Mandela. You can download the required data <a href="data/speeches.tsv">from this link</a></p>
</section><section><h2 class="section-heading" id="using-automated-text-analysis-for-media-research">Using automated text analysis for media research<a class="anchor" aria-label="anchor" href="#using-automated-text-analysis-for-media-research"></a>
</h2>
<hr class="half-width">
<p>Classic approaches to media research can be expanded and enhanced by
using computational approaches such as automated text analysis.
Nonetheless it is important for researchers to know where these new
tools originate and what they assume about language. This tutorial is
intended to provide a foundation for media researchers who would like to
use computational tools for discourse analysis on collections of textual
data such as social media posts, web pages, text output from machine
vision services, or interview transcripts. These techniques have their
roots in both computational linguistics and corpus linguistics.</p>
<p>Computational linguistics and Corpus Linguistics are two related
areas which provide different approaches, concepts and tools for
analysing textual data.</p>
<p>Media scholars have used corpus linguistics together with discourse
analysis to explore dominant discourses, and to investigate the social
implications of certain linguistic choices. Computational linguistics
has been used to automate some aspects of content analysis, such as
sentiment analysis (which identifies positive and negative sentiments in
text) or to label texts or automatically identify topics . In all these
cases, researchers need to manage textual data and to prepare it for
analysis by sorting, categorising and summarising it.</p>
<p>Computational linguistics is a broad inter-disciplinary area of study
where software and algorithms are developed to analyse and synthesise
language and speech for applications such as machine translation, speech
recognition, machine learning and deep learning (“AI”). Corpus
linguistics has developed methods to study trends and patterns in
language use and sociolinguistic variation by analysing large
collections of electronically stored, naturally occurring texts. Both of
these areas are also related to Natural Language Processing (NLP) which
is a subfield of computer science.</p>
<p>While Computational Linguistics has a strongly quantitative focus,
Corpus Linguistics can also include qualitative analysis (such as
examining concordance lines). Corpus linguistics involves much
qualitative work interpreting text, and so can be used to extend the
scope of Critical Discourse Analysis (CDA) and other smaller-scale media
studies approaches to analysing linguistic discourse.</p>
<p>For more about these approaches, see these additional readings:</p>
<p>Baker, P. et al. (2008) A useful methodological synergy? Combining
critical discourse analysis and corpus linguistics to examine discourses
of refugees and asylum seekers in the UK press. Discourse &amp; society.
[19 (3), 273–306.</p>
<p>Baker, P. 2006. Using Corpora in Discourse Analysis. Continuum:
London.</p>
<p>Van Atteveldt, W. &amp; T. Peng, (2018) When Communication Meets
Computation: Opportunities, Challenges, and Pitfalls in Computational
Communication Science, Communication Methods and Measures, 12:2-3,
81-92, DOI: 10.1080/19312458.2018.1458084</p>
<p>Theocharis, Y. &amp; A. Jungherr (2020) Computational Social Science
and the Study of Political Communication, Political Communication, DOI:
10.1080/10584609.2020.1833121</p>
</section><section><h2 class="section-heading" id="what-is-a-corpus">What is a Corpus?<a class="anchor" aria-label="anchor" href="#what-is-a-corpus"></a>
</h2>
<hr class="half-width">
<p>A <em>corpus</em> is a set of documents which stores large quantities
of real-life text. The plural form of the word is <em>corpora</em>.</p>
<p>You can find a set of South African language corpora on the <a href="https://corpus.sadilar.org/corpusportal/explore/corpus" class="external-link">SADILAR
corpus portal</a> website.</p>
<p>In this tutorial you can think of the corpus as your back-up or raw
data which needs to be kept unchanged by the analysis. The individual
documents which make up the corpus can be labelled and stored separately
from one another in the corpus format.</p>
</section><section><h2 class="section-heading" id="using-a-document-term-matrix">Using a Document-Term Matrix<a class="anchor" aria-label="anchor" href="#using-a-document-term-matrix"></a>
</h2>
<hr class="half-width">
<p>Computers work by using numbers, and so corpora are analysed by
generating a numerical representations of text.</p>
<p>A popular representation of text in CL is the <em>Document-Term
Matrix</em> or <em>DTM</em> (also known as Term-Document Matrix (TDM) or
Document-Feature Matrix (DFM).</p>
<p>A DTM represents a corpus as a large table (known as a matrix) which
organises all the words (terms) in the corpus according to how often
they occur in each of the documents included in the corpus.</p>
<p>We will start with a small example of a document-term matrix, using
this famous quotation from Nelson Mandela’s 1964 speech during the
Rivonia Trial:</p>
<blockquote>
<p>“I have cherished the ideal of a democratic and free society in which
all persons will live together in harmony and with equal opportunities.
It is an idea for which I hope to live for and to see realized. But, my
Lord, if it needs be, it is an ideal for which I am prepared to
die.”</p>
</blockquote>
<p>Once we understand how a short paragraph like this is represented
numerically as a DFM, we will use a larger DFM to compare Mandela’s
linguistic choices across different speeches made in 1964 and in
1994.</p>
<p>In <strong>quanteda</strong> the function to create a DTM is
<code>dfm()</code>, as it can be used for textual features other than
individual words or tokens (e.g. emojis or punctuation marks).</p>
<p>In a DTM, each document is allocated a separate row. (In this case we
are treating each sentence as a separate row.) Each word in the document
has a separate column. (As a result a DTM can be extremely wide.) Each
cell has a number showing how often a particular word appears in a
particular document.</p>
<p>We start by creating a list of the individual words in the sentences,
which in <strong>quanteda</strong> uses the <code>tokens()</code>
function. Our second step is to convert these words into a DTM using
<code>dfm()</code>. For the purposes of this example, we will treat each
sentence as a separate “text”.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">texts</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="st">"I have cherished the ideal of a democratic and free society</span></span>
<span><span class="st">      in which all persons will live together in harmony and with equal</span></span>
<span><span class="st">      opportunities"</span>, </span>
<span>      <span class="st">"It is an idea for which I hope to live for and to see realized"</span>, </span>
<span>      <span class="st">"But my Lord if it needs be it is an ideal for which I am prepared </span></span>
<span><span class="st">      to die"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">tokens</span><span class="op">(</span><span class="va">texts</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s take the DTM created by the dfm() function and look more
closely at its matrix structure.</p>
<p>Since it’s a very wide matrix with 40 columns, we will focus on the
first 10 words, or features.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Document-feature matrix of: 3 documents, 40 features (56.67% sparse) and 0 docvars.
       features
docs    i have cherished the ideal of a democratic and free
  text1 1    1         1   1     1  1 1          1   2    1
  text2 1    0         0   0     0  0 0          0   1    0
  text3 1    0         0   0     1  0 0          0   0    0
[ reached max_nfeat ... 30 more features ]</code></pre>
</div>
<p>The example matrix above shows the losses and the gains when we
represent the closing sentences of Mandela’s four hour long speech from
the dock as a DTM.</p>
<p>We lose the original word order of the conclusion to the speech, its
poetic use of repetition and the impact of the final statement.</p>
<p>At the same time, we gain other insights. Since we represent the
speech in a numeric matrix format Mandela’s linguistic choices are
quantified and we can see certain lexical patterns. This draws attention
to some rhetorical strategies, such as the repetition of the first
person pronoun “I” and the repeated words “ideal” and “live”, which lead
up to the shock of the final emphatic “die”.</p>
<p>Furthermore, by converting the whole speech into the quantitative DTM
format, we can more easily use computational methods to compare
Mandela’s 1964 speech to other famous speeches, such as his speech in
1994, or to speeches made by other political leaders and statesmen.</p>
</section><section><h2 class="section-heading" id="creating-a-corpus">Creating a corpus<a class="anchor" aria-label="anchor" href="#creating-a-corpus"></a>
</h2>
<hr class="half-width">
<p>We need to load the full text of the speech from a collection of
speeches (<code>speeches.tsv</code>) and create a reference corpus to
investigate these linguistic patterns.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load file with text of political speeches</span></span>
<span><span class="va">speeches</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>,<span class="st">"speeches.tsv"</span><span class="op">)</span>,</span>
<span>  na<span class="op">=</span> <span class="st">""</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 2 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (6): first_name, president, delivery, type, party, text
date (1): date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<p>Our dataframe includes a column with the full text of the speeches,
as well as various other metadata for the speeches.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colnames</span><span class="op">(</span><span class="va">speeches</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "first_name" "president"  "date"       "delivery"   "type"
[6] "party"      "text"      </code></pre>
</div>
<p>Now that we have loaded the collection we create a unique “docid”
column for each speach. Using<code>mutate()</code> we combine the year
of the speech with the name of the speaker, and the mode of delivery.
Then we select only the Rivonia speech using <code>filter()</code>.</p>
<p>Now we can use the <code>corpus()</code> function to convert the
dataframe to a corpus object.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select only the Rivonia speech and convert to a DTM</span></span>
<span></span>
<span><span class="va">d_corpus</span> <span class="op">&lt;-</span> <span class="va">speeches</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>doc_id<span class="op">=</span><span class="fu">paste</span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, <span class="va">president</span>, <span class="va">delivery</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="st">"1964"</span> <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">corpus</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="tokens---preparing-for-analysis">Tokens - preparing for analysis<a class="anchor" aria-label="anchor" href="#tokens---preparing-for-analysis"></a>
</h2>
<hr class="half-width">
<p>Tokens are usually the words in a document. (They can also be
sentences.) We will now prepare the text for analysis by deciding what
tokens are important for us to address the research question.</p>
<p>In many cases, we will not want to keep all of the tokens in a text.
For example, we might convert all words to lowercase, remove punctuation
and numbers, and stem words to reduce the size of the eventual matrix.
Of course, in cases where numbers or punctuataion are important to our
analysis, we would keep them intact!</p>
<p>In this case we will remove all punctuation and numbers.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tokenize, remove punctuation and number, and convert to a DTM</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d_corpus</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tokens</span><span class="op">(</span>remove_punct <span class="op">=</span> <span class="cn">T</span>, remove_numbers <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="starting-analysis---the-dtm">Starting Analysis - the DTM<a class="anchor" aria-label="anchor" href="#starting-analysis---the-dtm"></a>
</h2>
<hr class="half-width">
<p>Once the speech is converted to a DTM with the <code>dtm()</code>
function, we can start exploring its linguistic patterns.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Document-feature matrix of: 1 document, 2,119 features (0.00% sparse) and 6 docvars.
                     features
docs                    i am the first accused hold   a bachelor's degree  in
  1964 Mandela speech 179 12 751     9       1    2 171          1      1 264
[ reached max_nfeat ... 2,109 more features ]</code></pre>
</div>
<p>The <code>head()</code> function tells us that the resulting DFM has
2154 tokens. It is a sparse matrix, (0.00% sparse). In other words, very
few of the 2154 words are ever repeated.</p>
<p>The function <code>topfeatures()</code> highlights the most commonly
used words in the speech. Unsurprisingly, these are common words in
English such as “I”, “the”, “a” and “in”.</p>
<p>We will likely need to remove these words - unless we are
specifically interested in Mandela’s use of pronouns. But first let us
see what the frequency distribution looks like with them in the
text.</p>
</section><section><h2 class="section-heading" id="charting-frequencies-with-quanteda">Charting frequencies with
<strong><code>quanteda</code></strong>
<a class="anchor" aria-label="anchor" href="#charting-frequencies-with-quanteda"></a>
</h2>
<hr class="half-width">
<p>Using the <code>textstat_frequency()</code> function and
<code>ggplot()</code> we can chart the most frequently used 60 words
(features) from Mandela’s speech:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">topfeatures</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> the   of   to  and   in    i    a that  was this
 751  461  387  339  264  179  171  152  140  107 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tstat_freq_d</span> <span class="op">&lt;-</span> <span class="fu">textstat_frequency</span><span class="op">(</span><span class="va">d</span>, n <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_freq</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">tstat_freq_d</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">frequency</span>, y <span class="op">=</span> <span class="fu">reorder</span><span class="op">(</span><span class="va">feature</span>, <span class="va">frequency</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Frequency"</span>, y <span class="op">=</span> <span class="st">"Feature"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_freq</span></span></code></pre>
</div>
<figure><img src="fig/08-text-as-data-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="grammaticalfunction-words">Grammatical/Function words<a class="anchor" aria-label="anchor" href="#grammaticalfunction-words"></a>
</h2>
<hr class="half-width">
<p>The chart shows us that the most commonly used words in the speech as
a whole are similar to the common English words we saw repeated in the
final sentences.These words are known as grammatical or function words
and are the most commonly used in a language. They seldom change over
short periods of time.</p>
<p>For this reason, grammatical and function words are on lists of words
to be excluded from frequency counts. These lists are known as “stop
words”</p>
</section><section><h2 class="section-heading" id="lexical-words">Lexical words<a class="anchor" aria-label="anchor" href="#lexical-words"></a>
</h2>
<hr class="half-width">
<p>By contrast, the frequencies of the lexical words in Mandela’s speech
(“African”, “ANC”, “Africans”, “people”, “political”, “umkhonto”,
“Africa”, “white”, “South”,“violence”,
“government”,“policy”,“against”,“communist”) give far more clues if
we’re interested in what this specific text or corpus is about.</p>
</section><section><h2 class="section-heading" id="defining-stopwords">Defining stopwords<a class="anchor" aria-label="anchor" href="#defining-stopwords"></a>
</h2>
<hr class="half-width">
<p>We can start identifying these important lexical words by excluding
common English words from our analysis:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## exclude common english words</span></span>
<span><span class="va">mystopwords</span> <span class="op">&lt;-</span> <span class="fu">stopwords</span><span class="op">(</span><span class="st">"english"</span>,</span>
<span>                         source<span class="op">=</span><span class="st">"snowball"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">mystopwords</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:175] "i" "me" "my" "myself" "we" "our" "ours" "ourselves" "you" ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mystopwords</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  [1] "i"          "me"         "my"         "myself"     "we"
  [6] "our"        "ours"       "ourselves"  "you"        "your"
 [11] "yours"      "yourself"   "yourselves" "he"         "him"
 [16] "his"        "himself"    "she"        "her"        "hers"
 [21] "herself"    "it"         "its"        "itself"     "they"
 [26] "them"       "their"      "theirs"     "themselves" "what"
 [31] "which"      "who"        "whom"       "this"       "that"
 [36] "these"      "those"      "am"         "is"         "are"
 [41] "was"        "were"       "be"         "been"       "being"
 [46] "have"       "has"        "had"        "having"     "do"
 [51] "does"       "did"        "doing"      "would"      "should"
 [56] "could"      "ought"      "i'm"        "you're"     "he's"
 [61] "she's"      "it's"       "we're"      "they're"    "i've"
 [66] "you've"     "we've"      "they've"    "i'd"        "you'd"
 [71] "he'd"       "she'd"      "we'd"       "they'd"     "i'll"
 [76] "you'll"     "he'll"      "she'll"     "we'll"      "they'll"
 [81] "isn't"      "aren't"     "wasn't"     "weren't"    "hasn't"
 [86] "haven't"    "hadn't"     "doesn't"    "don't"      "didn't"
 [91] "won't"      "wouldn't"   "shan't"     "shouldn't"  "can't"
 [96] "cannot"     "couldn't"   "mustn't"    "let's"      "that's"
[101] "who's"      "what's"     "here's"     "there's"    "when's"
[106] "where's"    "why's"      "how's"      "a"          "an"
[111] "the"        "and"        "but"        "if"         "or"
[116] "because"    "as"         "until"      "while"      "of"
[121] "at"         "by"         "for"        "with"       "about"
[126] "against"    "between"    "into"       "through"    "during"
[131] "before"     "after"      "above"      "below"      "to"
[136] "from"       "up"         "down"       "in"         "out"
[141] "on"         "off"        "over"       "under"      "again"
[146] "further"    "then"       "once"       "here"       "there"
[151] "when"       "where"      "why"        "how"        "all"
[156] "any"        "both"       "each"       "few"        "more"
[161] "most"       "other"      "some"       "such"       "no"
[166] "nor"        "not"        "only"       "own"        "same"
[171] "so"         "than"       "too"        "very"       "will"      </code></pre>
</div>
<p>It’s always a good idea to look carefully at what stopwords are being
removed. In this case, notice that pronoouns (e.g. “us” and “them”) as
well as negative terms (“not” or “no”) are on the stoplist. These could
be important for understanding discourse around collective identity, and
so we may want to come back to add or remove words from the list at a
later stage.</p>
</section><section><h2 class="section-heading" id="removing-stopwords">Removing stopwords<a class="anchor" aria-label="anchor" href="#removing-stopwords"></a>
</h2>
<hr class="half-width">
<p>After removing stopwords from the DTM using the function
<code>dfm_remove()</code> we can chart frequencies for the most common
lexical words used in the Rivonia speech.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm_remove</span><span class="op">(</span><span class="va">mystopwords</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tstat_freq_d</span> <span class="op">&lt;-</span> <span class="fu">textstat_frequency</span><span class="op">(</span><span class="va">d</span>, n <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_freq</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">tstat_freq_d</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">frequency</span>, y <span class="op">=</span> <span class="fu">reorder</span><span class="op">(</span><span class="va">feature</span>, <span class="va">frequency</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Frequency"</span>, y <span class="op">=</span> <span class="st">"Feature"</span><span class="op">)</span></span>
<span><span class="va">feature_freq</span></span></code></pre>
</div>
<figure><img src="fig/08-text-as-data-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Once the grammatical/function words have been excluded with the
stopword list, the frequency chart shows more clearly what the speech
was about.</p>
<p>Before we start to make sense of these word frequencies in Mandela’s
speech, we should pause briefly and reflect on an important concept in
computational analysis of text, namely <strong>frequency</strong>.</p>
</section><div class="section level1">
<h1 id="using-word-frequencies-to-analyse-text">Using Word Frequencies to Analyse Text<a class="anchor" aria-label="anchor" href="#using-word-frequencies-to-analyse-text"></a>
</h1>
<p>Frequency is a key concept underpinning the analysis of text and
corpora. As a purely quantitative measure, media researchers need to use
word frequencies with a sensitivity to the word-distribution patterns in
human languages, and the importance of context for meaning</p>
<p>Word frequency lists are an important starting point and can help
direct an investigation. We combine them with measures of dispersion,
which are used to reveal trends across texts. For example, certain
linguistic patterns may occur more often at the beginning or ends of
texts.</p>
<p>At the same time, frequencies can be reductive and generalising. If
we’re interested in meaning it’s important not to oversimplify. Focusing
only on general patterns and individual word distributions without
paying attention to context can obscure what is going on in a text.</p>
<div class="section level2">
<h2 id="why-is-frequency-important">Why is frequency important?<a class="anchor" aria-label="anchor" href="#why-is-frequency-important"></a>
</h2>
<p>Language is not a random affair - it is <em>rule based</em>. Words
are likely to occur predictably in relationship to other words.</p>
<p>At the same time, human beings use language creatively and people can
make many choices about how they want to use language. Language has
<em>rule-generating</em> qualities which is why it changes over time and
varies depending on the context where it is used.</p>
</div>
<div class="section level2">
<h2 id="the-relationship-between-frequency-and-ideology">The relationship between frequency and ideology<a class="anchor" aria-label="anchor" href="#the-relationship-between-frequency-and-ideology"></a>
</h2>
<p>Media studies builds on the insights of discourse analysis and corpus
linguistics, which have sensitised researchers to the ideological
implications of the words people choose to use.</p>
<blockquote>
<p>“If people speak or write in an unexpected way, or make one
linguistic choice over another, more obvious one, then that reveals
something about their intentions, whether conscious or not.”
(Baker:48)</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="wordclouds-and-visualisation">Wordclouds and visualisation<a class="anchor" aria-label="anchor" href="#wordclouds-and-visualisation"></a>
</h2>
<p>Wordclouds are a popular visualisation format for frequencies because
they allow us to focus on meanings.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">topfeatures</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  african       anc  africans    people political  umkhonto    africa     white
       71        57        55        48        43        38        35        35
    south  violence
       34        33 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">textplot_wordcloud</span><span class="op">(</span><span class="va">d</span>, max_words<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/08-text-as-data-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We notice the duplication of related words, such as “africa”,
“african” or “africans”. It is possible to combine these by using by
using the <code>tokens_wordstem()</code> function, which will reduce all
words to their stems.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">topfeatures</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  african       anc  africans    people political  umkhonto    africa     white
       71        57        55        48        43        38        35        35
    south  violence
       34        33 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d_corpus</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tokens</span><span class="op">(</span>remove_punct <span class="op">=</span> <span class="cn">T</span>, remove_numbers <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tokens_wordstem</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm</span><span class="op">(</span><span class="op">)</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm_remove</span><span class="op">(</span><span class="va">mystopwords</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">textplot_wordcloud</span><span class="op">(</span><span class="va">d</span>, max_words<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/08-text-as-data-rendered-unnamed-chunk-13-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>How would you go about using quanteda functions to study linguistic
choices in the inaugural speech given by Mandela when he became
President on 10 May 1994?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">speeches</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>doc_id<span class="op">=</span><span class="fu">paste</span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, <span class="va">president</span>, <span class="va">delivery</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="st">"1994"</span> <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">corpus</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tokens</span><span class="op">(</span>remove_punct<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm</span><span class="op">(</span><span class="op">)</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm_remove</span><span class="op">(</span><span class="va">mystopwords</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">topfeatures</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     us   world  people country   peace   human   south     let freedom   never
      9       8       8       6       6       5       5       5       4       4 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">textplot_wordcloud</span><span class="op">(</span><span class="va">d</span>, max_words<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/08-text-as-data-rendered-unnamed-chunk-14-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>The most frequent word in the 1994 speech is “us”. Edit the stopword
list to check for frequency of other pronouns which may be used to
construct a group identity.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## edit the list of stopwords</span></span>
<span><span class="va">mystopwords</span> <span class="op">&lt;-</span> <span class="va">mystopwords</span><span class="op">[</span><span class="op">!</span> <span class="va">mystopwords</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">'we'</span>, <span class="st">'they'</span>, <span class="st">'i'</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d_corpus</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tokens</span><span class="op">(</span>remove_punct <span class="op">=</span> <span class="cn">T</span>, remove_numbers <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dfm_remove</span><span class="op">(</span><span class="va">mystopwords</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">textplot_wordcloud</span><span class="op">(</span><span class="va">d</span>, max_words<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/08-text-as-data-rendered-unnamed-chunk-15-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>What are the pros and cons of using ggplot and textplot_wordcloud to
represent textual data?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p><strong>Using a wordcloud</strong></p>
<p>Pro: The wordcloud allows quick exploration of the meaning of a
speech.</p>
<p>Con: Wordclouds can give undue emphasis to long words.</p>
<p><strong>Using a ggplot feature-frequency chart</strong></p>
<p>Pro: The frequency plot using ggplot allows for precise comparisons
and shows the exact frequency for each word.</p>
<p>Con: As a visualisation a frequency plot is not as intuitively read
for meaning.</p>
<p><strong>Using any visualisation of simple frequencies</strong></p>
<p>Wordclouds and frequency plots both rely on simple frequency counts,
which don’t handle negatives well e.g. (“not violent” vs “violent”) and
also split up multi-word concepts like “south africa”.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the <strong><code>quanteda</code></strong> package to analyse
text data.</li>
<li>Use <code>corpus()</code>, <code>tokens()</code>,<code>dfm()</code>,
<code>dfm_remove()</code> and stopword lists to prepare text for
analysis.</li>
<li>Use <code>textstat_frequency</code> to investigate the most
frequently used tokens or features in a dfm.</li>
<li>Plot frequencies using <strong><code>ggplot</code></strong> and the
<strong><code>quanteda</code></strong> function
<code>textplot_wordcloud</code>.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/marionwalton/media-test/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/marionwalton/media-test/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/marionwalton/media-test/" class="external-link">Source</a></p>
				<p><a href="https://github.com/marionwalton/media-test/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:marion.walton@uct.ac.za">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.7" class="external-link">sandpaper (0.16.7)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://marionwalton.github.io/media-test/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "media, software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://marionwalton.github.io/media-test/aio.html",
  "identifier": "https://marionwalton.github.io/media-test/aio.html",
  "dateCreated": "2024-08-23",
  "dateModified": "2024-09-20",
  "datePublished": "2024-09-20"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

